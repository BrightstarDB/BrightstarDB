<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN"
  "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">


<html xmlns="http://www.w3.org/1999/xhtml">
  <head>
    <meta http-equiv="Content-Type" content="text/html; charset=utf-8" />
    
    <title>Developing With BrightstarDB &mdash; BrightstarDB 1.3pre1 documentation</title>
    
    <link rel="stylesheet" href="_static/default.css" type="text/css" />
    <link rel="stylesheet" href="_static/pygments.css" type="text/css" />
    
    <script type="text/javascript">
      var DOCUMENTATION_OPTIONS = {
        URL_ROOT:    './',
        VERSION:     '1.3pre1',
        COLLAPSE_INDEX: false,
        FILE_SUFFIX: '.html',
        HAS_SOURCE:  true
      };
    </script>
    <script type="text/javascript" src="_static/jquery.js"></script>
    <script type="text/javascript" src="_static/underscore.js"></script>
    <script type="text/javascript" src="_static/doctools.js"></script>
    <link rel="top" title="BrightstarDB 1.3pre1 documentation" href="index.html" />
    <link rel="next" title="BrightstarDB Configuration Options" href="Running_BrightstarDB.html" />
    <link rel="prev" title="Supported RDF Syntaxes" href="Supported_RDF_Syntaxes.html" /> 
  </head>
  <body>
    <div class="related">
      <h3>Navigation</h3>
      <ul>
        <li class="right" style="margin-right: 10px">
          <a href="genindex.html" title="General Index"
             accesskey="I">index</a></li>
        <li class="right" >
          <a href="Running_BrightstarDB.html" title="BrightstarDB Configuration Options"
             accesskey="N">next</a> |</li>
        <li class="right" >
          <a href="Supported_RDF_Syntaxes.html" title="Supported RDF Syntaxes"
             accesskey="P">previous</a> |</li>
        <li><a href="index.html">BrightstarDB 1.3pre1 documentation</a> &raquo;</li> 
      </ul>
    </div>  

    <div class="document">
      <div class="documentwrapper">
        <div class="bodywrapper">
          <div class="body">
            
  <div class="section" id="developing-with-brightstardb">
<span id="developing-with-brightstardb2"></span><h1>Developing With BrightstarDB<a class="headerlink" href="#developing-with-brightstardb" title="Permalink to this headline">¶</a></h1>
<p>This section takes you through all of the basic principles of working with the BrightstarDB
APIs.</p>
<p>BrightstarDB provides three different levels of API:</p>
<blockquote>
<div><ol class="arabic simple">
<li>At the highest level the <a class="reference internal" href="#entity-framework"><em>Entity Framework</em></a> allows you to define
your application data model in code. You can then use LINQ to query the data and simple
operations on your application data entities to create, update and delete objects.</li>
<li>The <a class="reference internal" href="#data-object-layer"><em>Data Object Layer</em></a> provides a simple abstract API for
dealing with RDF resources, you can retrieve a resource and all its properties with a single
call. This layer provides no direct query functionality, but it can be combined with the
SPARQL query functionality provided by the RDF Client API. This layer also has a separate
abstraction for use with <a class="reference internal" href="#dynamic-api"><em>Dynamic Objects</em></a>.</li>
<li>The <a class="reference internal" href="#rdf-client-api"><em>RDF Client API</em></a> provides the lowest level interface to
BrightstarDB allowing you to add or remove RDF triples and to execute SPARQL queries.</li>
</ol>
</div></blockquote>
<p>If you are new to BrightstarDB and to RDF, we recommend you start with the Entity Framework
and take a walk through our <a class="reference internal" href="#id1"><em>Developer Quick Start</em></a>. If
you are already comfortable with RDF and SPARQL you may wish to start with the lower level APIs.</p>
<p>If you are the kind of person that just likes to dive straight into sample code, please take a
moment to read about Running the BrightstarDB Samples first.</p>
<div class="section" id="developer-quick-start">
<span id="id1"></span><h2>Developer Quick Start<a class="headerlink" href="#developer-quick-start" title="Permalink to this headline">¶</a></h2>
<p>BrightstarDB is about giving developers a really powerful, quick and clean experience in
defining and realizing persistent object systems on .NET. To achieve this BrightstarDB can use
a set of interface definitions with simple annotations to generate a full LINQ capable object
model that stores object state in a BrightstarDB instance. In this quick introduction we will
show how to create a new data model in Visual Studio, create a new BrightstarDB store and
populate it with data.</p>
<div class="admonition note">
<p class="first admonition-title">Note</p>
<p class="last">The source code for this example can be found in
[INSTALLDIR]\Samples\Embedded\EntityFramework\EntityFrameworkSamples.sln</p>
</div>
<div class="section" id="create-new-project">
<h3>Create New Project<a class="headerlink" href="#create-new-project" title="Permalink to this headline">¶</a></h3>
<p>Create a new project in Visual Studio. For this example we chose a command line application.
After creating the project ensure the build target is set to &nbsp;&#8217;.NET Framework 4&#8217; and that the
Platform Target is set to &#8216;Any CPU&#8217;</p>
<p>In the solution explorer right click and add a new item. Choose the &#8216;Brightstar Entity
Context&#8217; from the list.</p>
<img alt="_images/getting-started-add-entity-context.png" src="_images/getting-started-add-entity-context.png" />
<p>The project will now show a new component has been added called &#8220;MyEntityContext.tt&#8221;. On the
project references right click and add references. Browse to the [INSTALLDIR]\SDK\net40 folder
and include all the &#8221;.dll&#8221; files that are there.</p>
</div>
<div class="section" id="create-the-model">
<h3>Create the Model<a class="headerlink" href="#create-the-model" title="Permalink to this headline">¶</a></h3>
<p>In this sample we will create a data model that contains actors and films. An actor has a name
and a date of birth. An actor can star in many films and each film has many actors. Films also
have name property.</p>
<p>The BrightstarDB Entity Framework requires you to define the data model as a set of .NET
interface definitions. &nbsp;You can either write these interfaces entirely by hand or you can use
the Brightstar Entity Definition item template. Again, right-click on the solution item in the
project explorer window and add a new item, this time from the displayed list choose
Brightstar Entity Definition and change the name of the file to IActor.cs.</p>
<p>Add the following code to that file:</p>
<div class="highlight-python"><pre>[Entity]
public interface IActor
{
  string Name { get; set; }
  DateTime DateOfBirth { get; set; }
  ICollection&lt;IFilm&gt; Films { get; set; }
}</pre>
</div>
<p>Then add another Brightstar Entity Definition named IFilm.cs and include the following code:</p>
<div class="highlight-python"><pre>[Entity]
public interface IFilm
{
string Name { get; }
[InverseProperty("Films")]
ICollection&lt;IActor&gt; Actors { get; }
}</pre>
</div>
</div>
<div class="section" id="generating-the-context-and-classes">
<h3>Generating the Context and Classes<a class="headerlink" href="#generating-the-context-and-classes" title="Permalink to this headline">¶</a></h3>
<p>A context is a manager for objects in a store. It provides an entry point for running LINQ
queries and creating new objects. The context and implementing classes are automatically
generated from the interface definitions. To create a context, right click on the
MyEntityContext.tt file and select &#8220;Run custom tool&#8221;. This updates the MyEntityContext.cs to
contain the context class and also classes that implement the specified interfaces.</p>
<div class="admonition note">
<p class="first admonition-title">Note</p>
<p class="last">The context is not automatically rebuilt on every build. After making a change to the
interface definitions it is necessary to run the custom tool again.</p>
</div>
</div>
<div class="section" id="using-the-context">
<h3>Using the Context<a class="headerlink" href="#using-the-context" title="Permalink to this headline">¶</a></h3>
<p>The context can be used inside any .NET application or web service. The commented code below
shows how to initialize a context and then use that context to create and persist data. It
concludes by showing how to query the database using LINQ:</p>
<div class="highlight-python"><pre>using System;
using System.Collections.Generic;
using System.Linq;
using System.Text;
using BrightstarDB.Client;


namespace GettingStarted
{
    class Program
    {
        static void Main(string[] args)
        {

            // define a connection string
            const string connectionString = "type=http;endpoint=http://localhost:8090/brightstar;storeName=Films";


            // if the store does not exist it will be automatically
            // created when a context is created
            var ctx = new MyEntityContext(connectionString);


            // create some films
            var bladeRunner = ctx.Films.Create();
            bladeRunner.Name = "BladeRunner";


            var starWars = ctx.Films.Create();
            starWars.Name = "Star Wars";


            // create some actors and connect them to films
            var ford = ctx.Actors.Create();
            ford.Name = "Harrison Ford";
            ford.DateOfBirth = new DateTime(1942, 7, 13);
            ford.Films.Add(starWars);
            ford.Films.Add(bladeRunner);


            var hamill = ctx.Actors.Create();
            hamill.Name = "Mark Hamill";
            hamill.DateOfBirth = new DateTime(1951, 9, 25);
            hamill.Films.Add(starWars);


            // save the data
            ctx.SaveChanges();


            // open a new context, not required
            ctx = new MyEntityContext(store);


            // find an actor via LINQ
            ford = ctx.Actors.Where(a =&gt; a.Name.Equals("Harrison Ford")).FirstOrDefault();
            var dob = ford.DateOfBirth;


            // list his films
            var films = ford.Films;


            // get star wars
            var sw = films.Where(f =&gt; f.Name.Equals("Star Wars")).FirstOrDefault();


            // list actors in star wars
            foreach (var actor in sw.Actors)
            {
                var actorName = actor.Name;
                Console.WriteLine(actorName);
            }

            Console.ReadLine();
        }
    }
}</pre>
</div>
</div>
<div class="section" id="optimistic-locking">
<h3>Optimistic Locking<a class="headerlink" href="#optimistic-locking" title="Permalink to this headline">¶</a></h3>
<p>Optimistic Locking is a way of handling concurrency control, meaning that multiple
transactions can complete without affecting each other. If Optimistic Locking is turned on,
then when a transaction tries to save data to the store, it first checks that the underlying
data has not been modified by a different transaction. If it finds that the data has been
modified, then the transaction will fail to complete.</p>
<p>BrightstarDB has the option to turn on optimistic locking when connecting to the store. This
is done by setting the enableOptimisticLocking flag when opening a context such as below:</p>
<div class="highlight-python"><pre>ctx = new MyEntityContext(connectionString, true);
var newFilm = ctx.Films.Create();
ctx.SaveChanges();


var newFilmId = newFilm.Id;


//use optimistic locking when creating a new context
var ctx1 = new MyEntityContext(connectionString, true);
var ctx2 = new MyEntityContext(connectionString, true);


//create a film in the first context
var film1 = ctx1.Films.Where(f =&gt; f.Id.Equals(newFilmId)).FirstOrDefault();
Console.WriteLine("First context has film with ID '{0}'", film1.Id);
//create a film in the second context
var film2 = ctx2.Films.Where(f =&gt; f.Id.Equals(newFilmId)).FirstOrDefault();
Console.WriteLine("Second context has film with ID '{0}'", film2.Id);


//attempt to change the data from both contexts
film1.Name = "Raiders of the Lost Ark";
film2.Name = "American Graffiti";


//save the data to the store
try
{
  ctx1.SaveChanges();
  Console.WriteLine("Successfully updated the film to '{0}' in the store", film1.Name);
  ctx2.SaveChanges();
}
catch (Exception ex)
{
Console.WriteLine("Unable to save data to the store, as the underlying data has been modified.");
}

Console.ReadLine();</pre>
</div>
<div class="admonition note">
<p class="first admonition-title">Note</p>
<p class="last">Optimistic Locking can also be enabled in the configuration using the
BrightstarDB.EnableOptimisticLocking application setting</p>
</div>
</div>
<div class="section" id="server-side-caching">
<h3>Server Side Caching<a class="headerlink" href="#server-side-caching" title="Permalink to this headline">¶</a></h3>
<p>When enabled, query results are stored on disk until an update is made. If the same query is
executed, the cached result is returned. Cached results are stored in the Windows temporary
folder, and deleted when an update is made to the store.</p>
<p>Server side caching is enabled by default, but can be disabled by adding the appSetting below
to the application configuration file:</p>
<div class="highlight-python"><pre>&lt;add key="BrightstarDB.EnableServerSideCaching" value="false" /&gt;</pre>
</div>
<div class="admonition note">
<p class="first admonition-title">Note</p>
<p class="last">Server side caching is not supported on BrightstarDB for Windows Phone 7.</p>
</div>
</div>
<div class="section" id="what-next">
<h3>What Next?<a class="headerlink" href="#what-next" title="Permalink to this headline">¶</a></h3>
<p>While this is just a short introduction it has covered a lot of how BrightstarDB works. The
following sections provide some more conceptual details on how the store works, more details
on the Entity Framework and how to work with BrightstarDB as a triple store.</p>
</div>
</div>
<div class="section" id="connection-strings">
<span id="id2"></span><h2>Connection Strings<a class="headerlink" href="#connection-strings" title="Permalink to this headline">¶</a></h2>
<p>BrightstarDB makes use of connection strings for accessing both embedded and remote
BrightstarDB instances. The following section describes the different connection string
properties.</p>
<p><strong>Type</strong> : allowed values <strong>embedded</strong>, <strong>http</strong>, <strong>tcp</strong>, and <strong>namedpipe</strong>. This indicates
the type of connection to create.</p>
<p><strong>StoresDirectory</strong> : value is a file system path to the directory containing all BrightstarDB
data. Only valid for use with <strong>Type</strong> set to <strong>embedded</strong>.</p>
<p><strong>Endpoint</strong> : a URI that points to the service endpoint for the specified remote service.
Valid for <strong>http</strong>, <strong>tcp</strong>, and <strong>namedpipe</strong></p>
<p><strong>StoreName</strong> : The name of a specific store to connect to.</p>
<p>The following are examples of connection strings. Property value pairs are separated by &#8216;;&#8217;
and property names are case insensitive.:</p>
<div class="highlight-python"><div class="highlight"><pre><span class="s">&quot;type=http;endpoint=http://localhost:8090/brightstar;storename=test&quot;</span>

<span class="s">&quot;type=tcp;endpoint=net.tcp://localhost:8095/brightstar;storename=test&quot;</span>

<span class="s">&quot;type=namedpipe;endpoint=net.pipe://localhost/brightstar;storename=test&quot;</span>

<span class="s">&quot;type=embedded;storesdirectory=c:</span><span class="se">\\</span><span class="s">brightstar;storename=test&quot;</span>
</pre></div>
</div>
</div>
<div class="section" id="store-persistence-types">
<span id="id3"></span><h2>Store Persistence Types<a class="headerlink" href="#store-persistence-types" title="Permalink to this headline">¶</a></h2>
<p>BrightstarDB supports two different file formats for storing its index information. The main
difference between the two formats is the way in which modified pages of the index are written
to the index file.</p>
<div class="section" id="append-only">
<h3>Append-Only<a class="headerlink" href="#append-only" title="Permalink to this headline">¶</a></h3>
<p>The Append-Only format means that BrightstarDB will write modified pages to the end of the
index file. This approach has a number of benefits:</p>
<blockquote>
<div><ol class="arabic simple">
<li>Writers never block readers, so any number of read operations (typically SPARQL queries)
can be executed in parallel with updates to the index. Each reader accesses the store in the
state that it was when their operation began.</li>
<li>Reads can access any previous state of the store. This is because the full history of
updates to pages is maintained by the store.</li>
<li>Writes are faster - because they only append to the end of the file rather than needing
to seek to a location within the file to be updated.</li>
</ol>
</div></blockquote>
<p>The down-side of this format is that the index file will grow not only as more data is added
but also with every update operation applied to the store. BrightstarDB does provide a way to
truncate a store to just its latest state, removing all the previous historical page states so
this operation executed periodically can help to keep the file size under control.</p>
<p>In general the Append-Only format is recommended for most systems as long as disk space is not
constrained.</p>
</div>
<div class="section" id="rewritable">
<h3>Rewritable<a class="headerlink" href="#rewritable" title="Permalink to this headline">¶</a></h3>
<p>The Rewriteable store format manages an active and a shadow copy of each page in the index.
Writes are directed to the shadow copy while readers can access the current committed state of
the store by reading from the active copy. On a commit, the shadow copy becomes the active and
vice-versa. This approach keeps file size under control as changes to an index page are always
written to one of the two copies of the page. However this format has some disadvantages
compared to the append-only store.</p>
<blockquote>
<div><ol class="arabic simple">
<li>Readers that take a long time to complete can get blocked by writers. In general if a
reader completes in the time taken for a write to complete, the two operations can execute
in parallel, however in the case that a reader requires access to the store across two
successive reads, there is the potential that index pages could be modified. To avoid
inconsistent results due to dirty reads, when a reader detects this it will automatically
retry its current operation. This means that in stores where there are frequent, small
updates readers can potentially be blocked for a long time as new writes keep forcing the
read operation to be retried.</li>
<li>Write operations can be a bit slower - this is because pages are written to a fixed
location within the index file, requiring a disk seek before each page write.</li>
</ol>
</div></blockquote>
<p>In general the Rewritable store format is recommended for embedded applications; for mobile
devices that have space constraints to consider; or for server applications that are only
required to support infrequent and/or large updates.</p>
</div>
<div class="section" id="specifying-the-store-persistence-type">
<h3>Specifying the Store Persistence Type<a class="headerlink" href="#specifying-the-store-persistence-type" title="Permalink to this headline">¶</a></h3>
<p>The persistence type to use for a store must be specified when the store is created and cannot
be changed after the store has been created. The default persistence type is configured in the
application configuration file for the application (or the web.config for web applications).
To configure the default, you must add an entry to the appSetting section of the application
configuration file with the key <tt class="docutils literal"><span class="pre">BrightstarDB.PersistenceType</span></tt> and the value <tt class="docutils literal"><span class="pre">appendonly</span></tt>
for an Append-Only store or <tt class="docutils literal"><span class="pre">rewrite</span></tt> for a Rewriteable store (in both cases the values are
case-insensitive).</p>
<p>It is also possible to override the default persistence type at runtime by calling the
appropriate <tt class="docutils literal"><span class="pre">CreateStore()</span></tt> operation on the BrighstarDB service client API. If no default value
is defined in the application configuration file and no override value is passed to the
<tt class="docutils literal"><span class="pre">CreateStore()</span></tt> method, the default persistence type used by BrightstarDB is the Append-Only
persistence type.</p>
</div>
</div>
<div class="section" id="running-the-brightstardb-samples">
<span id="running-the-brightstardb-sampl"></span><h2>Running The BrightstarDB Samples<a class="headerlink" href="#running-the-brightstardb-samples" title="Permalink to this headline">¶</a></h2>
<p>All samples can be found in [INSTALLDIR]\Samples. Some samples are written to run against
a local BrightstarDB service. These samples only need editing if you want to run them
against BrightstarDB running on a different machine or running on a non-default port.
This is achieved by altering the BrightstarDB.ConnectionString property in the web.config
file of the sample.</p>
</div>
<div class="section" id="entity-framework">
<span id="id4"></span><h2>Entity Framework<a class="headerlink" href="#entity-framework" title="Permalink to this headline">¶</a></h2>
<p>The BrightstarDB Entity Framework is the main way of working with BrightstarDB instances. For
those of you wanting to work with the underlying RDF directly please see the section on
<a class="reference internal" href="#rdf-client-api"><em>RDF Client API</em></a>. BrightstarDB allows developers to define a data model
using .NET interface definitions. BrightstarDB tools introspect these definitions to create
concrete classes that can be used to create, and update persistent data. If you haven&#8217;t read
the <a class="reference internal" href="Getting_Started.html#getting-started"><em>Getting Started</em></a> section then we recommend that you do. The sample
provided there covers most of what is required for creating most data models. The following
sections in the developer guide provide more in-depth explanation of how things work along
with more complex examples.</p>
<div class="section" id="basics">
<span id="id5"></span><h3>Basics<a class="headerlink" href="#basics" title="Permalink to this headline">¶</a></h3>
<p>The BrightstarDB Entity Framework tooling is very simple to use. This guide shows how to get
going, the rest of this section provides more in-depth information.</p>
<p>The process of using the Entity Framework is to:</p>
<blockquote>
<div><ol class="arabic simple">
<li>Include the BrightstarDB Entity Context item into a project.</li>
<li>Define the interfaces for the data objects that should be persistent.</li>
<li>Run the custom tool on the Entity Context text template file.</li>
<li>Use the generated context to create, query or get and modify objects.</li>
</ol>
</div></blockquote>
<p><strong>Including the BrightstarDB Entity Context</strong></p>
<p>The <strong>Brightstar Entity Context</strong> is a text template that when run introspects the other
code elements in the project and generates a number of classes and a context in a single file
that can be found under the context file in Visual Studio. To add a new
BrightstarEntityContext add a new item to the project. Locate the item in the list called
Brightstar Entity Context, rename it if required, and add to the current project.</p>
<img alt="_images/getting-started-add-entity-context.png" src="_images/getting-started-add-entity-context.png" />
<p><strong>Define Interfaces</strong></p>
<p>Interfaces are used to define a data model contract. Only interfaces marked with the <tt class="docutils literal"><span class="pre">Entity</span></tt>
attribute will be processed by the text template. The following interfaces define a model that
captures the idea of people working for an company.:</p>
<div class="highlight-python"><pre>[Entity]
public interface IPerson
{
    string Name { get; set; }
    DateTime DateOfBirth { get; set; }
    string CV { get; set; }
    ICompany Employer { get; set; }
}

[Entity]
public interface ICompany
{
    string Name { get; set; }
    [InverseProperty("Employer")]
    ICollection&lt;IPerson&gt; Employees { get; }
}</pre>
</div>
<p><strong>Including a Brightstar Entity Definition Item</strong></p>
<p>One quick way to include the outline of a BrightstarDB entity in a project is to right click
on the project in the solution explorer and click <strong>Add New Item</strong>. Then select the
<strong>Brightstar Entity Definition</strong> from the list and update the name.</p>
<img alt="_images/ef-include-entity-def.png" src="_images/ef-include-entity-def.png" />
<p>This will add the following code file into the project.:</p>
<div class="highlight-python"><pre>[Entity]
public interface IMyEntity1
{
    /// &lt;summary&gt;
    /// Get the persistent identifier for this entity
    /// &lt;/summary&gt;
    string Id { get; }


    // TODO: Add other property references here
}</pre>
</div>
<p><strong>Run the MyEntityContext.tt Custom Tool</strong></p>
<p>To ensure that the generated classes are up to date right click on the .tt file in the
solution explorer and select <strong>Run Custom Tool</strong>. This will ensure that the all the
annotated interfaces are turned into concrete classes.</p>
<div class="admonition note">
<p class="first admonition-title">Note</p>
<p class="last">The custom tool is not run automatically on every rebuild so after changing an interface
remember to run it.</p>
</div>
<p><strong>Using a Context</strong></p>
<p>A context can be thought of as a connection to a BrightstarDB instance. It provides access to
the collections of domain objects defined by the interfaces. It also tracks all changes to
objects and is responsible for executing queries and committing transactions.</p>
<p>A context can be opened with a connection string. If the store named does not exist it will be
created. See the <a class="reference internal" href="#connection-strings"><em>connection strings</em></a> section for more information
on allowed configurations. The following code opens a new context connecting to an embedded
store:</p>
<div class="highlight-python"><pre>var dataContext = new MyEntityContext("Type=embedded;StoresDirectory=c:\\brightstardb;StoreName=test");</pre>
</div>
<p>The context exposes a collection for each entity type defined. For the types we defined above
the following collections are exposed on a context:</p>
<div class="highlight-python"><pre>var people = dataContext.Persons;
var companies = dataContext.Companies;</pre>
</div>
<p>Each of these collections are in fact IQueryable and as such support LINQ queries over the
model. To get an entity by a given property the following can be used:</p>
<div class="highlight-python"><pre>var brightstardb = dataContext.Companies.Where(
                       c =&gt; c.Name.Equals("BrightstarDB")).FirstOrDefault();</pre>
</div>
<p>Once an entity has been retrieved it can be modified or related entities can be fetched:</p>
<div class="highlight-python"><pre>// fetching employees
var employeesOfBrightstarDB = brightstardb.Employees;

// update the company
brightstardb.Name = "BrightstarDB";</pre>
</div>
<p>New entities can be created either via the main collection or by using the <tt class="docutils literal"><span class="pre">new</span></tt> keyword
and attaching the object to the context:</p>
<div class="highlight-python"><pre>// creating a new entity via the context collection
var bob = dataContext.Persons.Create();
bob.Name = "bob";


// or created using new and attached to the context
var bob = new Person() { Name = "Bob" };
dataContext.Persons.Add(bob);</pre>
</div>
<p>Once a new object has been created it can be used in relationships with other objects. The
following adds a new person to the collection of employees. The same relationship could also
have been created by setting the <tt class="docutils literal"><span class="pre">Employer</span></tt> property on the person:</p>
<div class="highlight-python"><pre>// Adding a new relationship between entities
var bob = dataContext.Persons.Create();
bob.Name = "bob";
brightstardb.Employees.Add(bob);


// The relationship can also be defined from the 'other side'.
var bob = dataContext.Persons.Create();
bob.Name = "bob";
bob.Employer = brightstardb;</pre>
</div>
<p>Saving the changes that have occurred is easily done by calling a method on the context:</p>
<div class="highlight-python"><div class="highlight"><pre><span class="n">dataContext</span><span class="o">.</span><span class="n">SaveChanges</span><span class="p">();</span>
</pre></div>
</div>
</div>
<div class="section" id="annotations">
<span id="annotations-guide"></span><h3>Annotations<a class="headerlink" href="#annotations" title="Permalink to this headline">¶</a></h3>
<p>The BrightstarDB entity framework relies on a few annotation types in order to accurately
express a data model. This section describes the different annotations and how they should be
used. The only required attribute annotation is Entity. All other attributes give different
levels of control over how the object model is mapped to RDF.</p>
<div class="section" id="typeidentifierprefix-attribute">
<h4>TypeIdentifierPrefix Attribute<a class="headerlink" href="#typeidentifierprefix-attribute" title="Permalink to this headline">¶</a></h4>
<p>BrightstarDB makes use of URIs to identify class types and property types. These URI values
can be added on each property but to improve clarity and avoid mistakes it is possible to
configure a base URI that is then used by all attributes. It is also possible to define models
that do not have this attribute set.</p>
<p>The type identifier prefix can be set in the AssemblyInfo.cs file. The example below shows how
to set this configuration property:</p>
<div class="highlight-python"><pre>[assembly: TypeIdentifierPrefix("http://www.mydomain.com/types/")]</pre>
</div>
</div>
<div class="section" id="entity-attribute">
<h4>Entity Attribute<a class="headerlink" href="#entity-attribute" title="Permalink to this headline">¶</a></h4>
<p>The entity attribute is used to indicate that the annotated interface should be included in
the generated model. Optionally, a full URI or a URI postfix can be supplied that defines the
identity of the class. The following examples show how to use the attribute. The example with
just the value &#8216;Person&#8217; uses a default prefix if one is not specified as described above:</p>
<div class="highlight-python"><pre>// example 1.
[Entity]
public interface IPerson { ... }

// example 2.
[Entity("Person")]
public interface IPerson { ... }

// example 3.
[Entity("http://xmlns.com/foaf/0.1/Person")]
public interface IPerson { ... }</pre>
</div>
<p>Example 3. above can be used to map .NET models onto existing RDF vocabularies. This allows
the model to create data in a given vocabulary but it also allows models to be mapped onto
existing RDF data.</p>
</div>
<div class="section" id="identity-property">
<h4>Identity Property<a class="headerlink" href="#identity-property" title="Permalink to this headline">¶</a></h4>
<p>The Identity property can be used to get and set the underlying identity of an Entity.
The following example shows how this is defined:</p>
<div class="highlight-python"><pre>// example 1.
[Entity("Person")]
public interface IPerson {
  string Id { get; }
}</pre>
</div>
<p>No annotation is required. It is also acceptable for the property to be called <tt class="docutils literal"><span class="pre">ID</span></tt>, <tt class="docutils literal"><span class="pre">{Type}Id</span></tt> or
<tt class="docutils literal"><span class="pre">{Type}ID</span></tt> where <tt class="docutils literal"><span class="pre">{Type}</span></tt> is the name of the type. E.g: <tt class="docutils literal"><span class="pre">PersonId</span></tt> or <tt class="docutils literal"><span class="pre">PersonID</span></tt>.</p>
</div>
<div class="section" id="identifier-attribute">
<h4>Identifier Attribute<a class="headerlink" href="#identifier-attribute" title="Permalink to this headline">¶</a></h4>
<p>Id property values are URIs, but in some cases it is necessary to work with simpler string
values such as GUIDs or numeric values. To do this the Id property can be decorated with the
identifier attribute. The identifier attribute requires a string property that is the
identifier prefix - this can be specified either as a URI string or as {prefix}:{rest of URI}
where {prefix} is a namespace prefix defined by the Namespace Declaration Attribute (see below):</p>
<div class="highlight-python"><pre>// example 1.
[Entity("Person")]
public interface IPerson {
  [Identifier("http://www.mydomain.com/people/")]
  string Id { get; }
}

// example 2.
[Entity]
public interface ISkill {
  [Identifier("ex:skills#")]
  string Id {get;}
}
// NOTE: For the above to work there must be an assembly attribute declared like this:
[assembly:NamespaceDeclaration("ex", "http://example.org/")]</pre>
</div>
</div>
<div class="section" id="property-inclusion">
<h4>Property Inclusion<a class="headerlink" href="#property-inclusion" title="Permalink to this headline">¶</a></h4>
<p>Any .NET property with a getter or setter is automatically included in the generated type, no
attribute annotation is required for this:</p>
<div class="highlight-python"><pre>// example 1.
[Entity("Person")]
public interface IPerson {
  string Id { get; }
  string Name { get; set; }
}</pre>
</div>
</div>
<div class="section" id="inverse-property-attribute">
<h4>Inverse Property Attribute<a class="headerlink" href="#inverse-property-attribute" title="Permalink to this headline">¶</a></h4>
<p>When two types reference each other via different properties that in fact reflect different
sides of the same association then it is necessary to declare this explicitly. This can be
done with the InverseProperty attribute. This attribute requires the name of the .NET property
on the referencing type to be specified:</p>
<div class="highlight-python"><pre>// example 1.
[Entity("Person")]
public interface IPerson {
  string Id { get; }
  ICompany Employer { get; set; }
}

[Entity("Company")]
public interface IPerson {
  string Id { get; }
  [InverseProperty("Employer")]
  ICollection&lt;IPerson&gt; Employees { get; set; }
}</pre>
</div>
<p>The above example shows that the inverse of <tt class="docutils literal"><span class="pre">Employees</span></tt> is <tt class="docutils literal"><span class="pre">Employer</span></tt>. This means that if
the <tt class="docutils literal"><span class="pre">Employer</span></tt> property on <tt class="docutils literal"><span class="pre">P1</span></tt> is set to <tt class="docutils literal"><span class="pre">C1</span></tt> then getting <tt class="docutils literal"><span class="pre">C1.Employees</span></tt> will
return a collection containing <tt class="docutils literal"><span class="pre">P1</span></tt>.</p>
</div>
<div class="section" id="namespace-declaration-attribute">
<h4>Namespace Declaration Attribute<a class="headerlink" href="#namespace-declaration-attribute" title="Permalink to this headline">¶</a></h4>
<p>When using URIs in annotations it is cleaner if the complete URI doesn&#8217;t need to be entered
every time. To support this the NamespaceDeclaration assembly attribute can be used, many
times if needed, to define namespace prefix mappings. The mapping takes a short string and the
URI prefix to be used.</p>
<p>The attribute can be used to specify the prefixes required (typically assembly attributes are
added to the AssemblyInfo.cs code file in the Properties folder of the project):</p>
<div class="highlight-python"><pre>[assembly: NamespaceDeclaration("foaf", "http://xmlns.com/foaf/0.1/")]</pre>
</div>
<p>Then these prefixes can be used in property or type annotation using the CURIE syntax of
{prefix}:{rest of URI}:</p>
<div class="highlight-python"><pre>[Entity("foaf:Person")]
public interface IPerson  { ... }</pre>
</div>
</div>
<div class="section" id="property-type-attribute">
<h4>Property Type Attribute<a class="headerlink" href="#property-type-attribute" title="Permalink to this headline">¶</a></h4>
<p>While no decoration is required to include a property in a generated class, if the property is
to be mapped onto an existing RDF vocabulary then the PropertyType attribute can be used to do
this. The PropertyType attribute requires a string property that is either an absolute or
relative URI. If it is a relative URI then it is appended to the URI defined by the
TypeIdentifierPrefix attribute or the default base type URI. Again, prefixes defined by a
NamespaceDeclaration attribute can also be used:</p>
<div class="highlight-python"><pre>// Example 1. Explicit type declaration
[PropertyType("http://www.mydomain.com/types/name")]
string Name { get; set; }

// Example 2. Prefixed type declaration.
// The prefix must be declared with a NamespaceDeclaration attribute
[PropertyType("foaf:name")]
string Name { get; set; }


// Example 3. Where "name" is appended to the default namespace
// or the one specified by the TypeIdentifierPrefix in AssemblyInfo.cs.
[PropertyType("name")]
string Name { get; set; }</pre>
</div>
</div>
<div class="section" id="inverse-property-type-attribute">
<h4>Inverse Property Type Attribute<a class="headerlink" href="#inverse-property-type-attribute" title="Permalink to this headline">¶</a></h4>
<p>Allows inverse properties to be mapped to a given RDF predicate type rather than a .NET
property name. This is most useful when mapping existing RDF schemas to support the case where
the .NET data-binding only requires the inverse of the RDF property:</p>
<div class="highlight-python"><pre>// Example 1. The following states that the collection of employees
// is found by traversing the "http://www.mydomain.com/types/employer"
// predicate from instances of Person.
[InversePropertyType("http://www.mydomain.com/types/employer")]
ICollection&lt;IPerson&gt; Employees { get; set; }</pre>
</div>
</div>
<div class="section" id="additional-custom-attributes">
<h4>Additional Custom Attributes<a class="headerlink" href="#additional-custom-attributes" title="Permalink to this headline">¶</a></h4>
<p>Any custom attributes added to the entity interface that are not in the
BrightstarDB.EntityFramework namespace will be automatically copied through into the generated
class. This allows you to easily make use of custom attributes for validation, property
annotation and other purposes.</p>
<p>As an example, the following interface code:</p>
<div class="highlight-python"><pre>[Entity("http://xmlns.com/foaf/0.1/Person")]
public interface IFoafPerson : IFoafAgent
{
    [Identifier("http://www.networkedplanet.com/people/")]
    string Id { get; }

    [PropertyType("http://xmlns.com/foaf/0.1/nick")]
    [DisplayName("Also Known As")]
    string Nickname { get; set; }

    [PropertyType("http://xmlns.com/foaf/0.1/name")]
    [Required]
    [CustomValidation(typeof(MyCustomValidator), "ValidateName",
                      ErrorMessage="Custom error message")]
    string Name { get; set; }
}</pre>
</div>
<p>would result in this generated class code:</p>
<div class="highlight-python"><pre> public partial class FoafPerson : BrightstarEntityObject, IFoafPerson
 {
 public FoafPerson(BrightstarEntityContext context, IDataObject dataObject) : base(context, dataObject) { }
 public FoafPerson() : base() { }
 public System.String Id { get {return GetIdentity(); } set { SetIdentity(value); } }
 #region Implementation of BrightstarDB.Tests.EntityFramework.IFoafPerson

 [System.ComponentModel.DisplayNameAttribute("Also Known As")]
 public System.String Nickname
 {
         get { return GetRelatedProperty&lt;System.String&gt;("Nickname"); }
         set { SetRelatedProperty("Nickname", value); }
 }

 [System.ComponentModel.DataAnnotations.RequiredAttribute]
 [System.ComponentModel.DataAnnotations.CustomValidationAttribute(typeof(MyCustomValidator),
   "ValidateName", ErrorMessage="Custom error message")]
 public System.String Name
 {
         get { return GetRelatedProperty&lt;System.String&gt;("Name"); }
         set { SetRelatedProperty("Name", value); }
 }

#endregion
 }</pre>
</div>
<p>It is also possible to add custom attributes to the generated entity class itself. Any custom
attributes that are allowed on both classes and interfaces can be added to the entity
interface and will be automatically copied through to the generated class in the same was as
custom attributes on properties. However, if you need to use a custom attribute that is
allowed on a class but not on an interface, then you must use the
BrightstarDB.EntityFramework.ClassAttribute attribute. This custom attribute can be added to
the entity interface and allows you to specify a different custom attribute that should be
added to the generated entity class. When using this custom attribute you should ensure that
you either import the namespace that contains the other custom attribute or reference the
other custom attribute using its fully-qualified type name to ensure that the generated class
code compiles successfully.</p>
<p>For example, the following interface code:</p>
<div class="highlight-python"><pre>[Entity("http://xmlns.com/foaf/0.1/Person")]
[ClassAttribute("[System.ComponentModel.DisplayName(\\"Person\\")]")]
public interface IFoafPerson : IFoafAgent
{
  // ... interface definition here
}</pre>
</div>
<p>would result in this generated class code:</p>
<div class="highlight-python"><pre>[System.ComponentModel.DisplayName("Person")]
public partial class FoafPerson : BrightstarEntityObject, IFoafPerson
{
  // ... generated class code here
}</pre>
</div>
<p>Note that the DisplayName custom attribute is referenced using its fully-qualified type name
(<tt class="docutils literal"><span class="pre">System.ComponentModel.DisplayName</span></tt>), as the generated context code will not include a
<tt class="docutils literal"><span class="pre">using</span> <span class="pre">System.ComponentModel;</span></tt> namespace import. Alternatively, this interface code would also
generate class code that compiles correctly:</p>
<div class="highlight-python"><pre>using System.ComponentModel;

[Entity("http://xmlns.com/foaf/0.1/Person")]
[ClassAttribute("[DisplayName(\\"Person\\")]")]
public interface IFoafPerson : IFoafAgent
{
  // ... interface definition here
}</pre>
</div>
</div>
</div>
<div class="section" id="patterns">
<span id="id6"></span><h3>Patterns<a class="headerlink" href="#patterns" title="Permalink to this headline">¶</a></h3>
<p>This section describes how to model common patterns using BrightstarDB Entity Framework. It
covers how to define one-to-one, one-to-many, many-to-many and reflexive relationships.</p>
<p>Examples of these relationship patterns can be found in the <a class="reference internal" href="#tweetbox"><em>Tweetbox sample</em></a>.</p>
<div class="section" id="one-to-one">
<h4>One-to-One<a class="headerlink" href="#one-to-one" title="Permalink to this headline">¶</a></h4>
<p>Entities can have one-to-one relationships with other entities. An example of this would be
the link between a user and a the authorization to another social networking site. The
one-to-one relationship would be described in the interfaces as follows:</p>
<div class="highlight-python"><pre>[Entity]
public interface IUser {
  ...
  ISocialNetworkAccount SocialNetworkAccount { get; set; }
  ...
}

[Entity]
public interface ISocialNetworkAccount {
  ...
  [InverseProperty("SocialNetworkAccount")]
          IUser TwitterAccount { get; set; }
  ...
}</pre>
</div>
</div>
<div class="section" id="one-to-many">
<h4>One-to-Many<a class="headerlink" href="#one-to-many" title="Permalink to this headline">¶</a></h4>
<p>A User entity can be modeled to have a one-to-many relationship with a set of Tweet entities,
by marking the properties in each interface as follows:</p>
<div class="highlight-python"><pre>[Entity]
public interface ITweet {
  ...
  IUser Author { get; set; }
  ...
}

[Entity]
public interface IUser {
  ...
  [InverseProperty("Author")]
  ICollection&lt;ITweet&gt; Tweets { get; set; }
  ...
}</pre>
</div>
</div>
<div class="section" id="many-to-many">
<h4>Many-to-Many<a class="headerlink" href="#many-to-many" title="Permalink to this headline">¶</a></h4>
<p>The Tweet entity can be modeled to have a set of zero or more Hash Tags. As any Hash Tag
entity could be used in more than one Tweet, this uses a many-to-many relationship pattern:</p>
<div class="highlight-python"><pre>[Entity]
public interface ITweet {
  ...
  ICollection&lt;IHashTag&gt; HashTags { get; set; }
  ...
}

[Entity]
public interface IHashTag {
  ...
  [InverseProperty("HashTags")]
  ICollection&lt;ITweet&gt; Tweets { get; set; }
  ...
}</pre>
</div>
</div>
<div class="section" id="reflexive-relationship">
<h4>Reflexive relationship<a class="headerlink" href="#reflexive-relationship" title="Permalink to this headline">¶</a></h4>
<p>A reflexive relationship (that refers to itself) can be defined as in the example below:</p>
<div class="highlight-python"><pre>[Entity]
public interface IUser {
  ...
  ICollection&lt;IUser&gt; Following { get; set; }

  [InverseProperty("Following")]
  ICollection&lt;IUser&gt; Followers { get; set; }
  ...
}</pre>
</div>
</div>
</div>
<div class="section" id="behaviour">
<span id="id7"></span><h3>Behaviour<a class="headerlink" href="#behaviour" title="Permalink to this headline">¶</a></h3>
<p>The classes generated by the BrightstarDB Entity Framework deal with data and data
persistence. However, most applications require these classes to have behaviour. All generated
classes are generated as .NET partial classes. This means that another file can contain
additional method definitions. The following example shows how to add additional methods to a
generated class.</p>
<p>Assume we have the following interface definition:</p>
<div class="highlight-python"><pre>[Entity]
public interface IPerson {
  string Id { get; }
  string FirstName { get; set; }
  string LastName { get; set; }
}</pre>
</div>
<p>To add custom behaviour the new method signature should first be added to the interface. The
example below shows the same interface but with an added method signature to get a user&#8217;s full
name:</p>
<div class="highlight-python"><pre>[Entity]
public interface IPerson {
  string Id { get; }
  string FirstName { get; set; }
  string LastName { get; set; }
  // new method signature
  string GetFullName();
}</pre>
</div>
<p>After running the custom tool on the EntityContext.tt file there is a new class called Person.
To add additional methods add a new .cs file to the project and add the following class
declaration:</p>
<div class="highlight-python"><pre>public partial class Person {
  public string GetFullName() {
    return FirstName + " " + LastName;
  }
}</pre>
</div>
<p>The new partial class implements the additional method declaration and has access to all the
data properties in the generated class.</p>
</div>
<div class="section" id="optimistic-locking-in-ef">
<span id="id8"></span><h3>Optimistic Locking<a class="headerlink" href="#optimistic-locking-in-ef" title="Permalink to this headline">¶</a></h3>
<p>The Entity Framework provides the option to enable optimistic locking when working with the
store. Optimistic locking uses a well-known version number property (the property predicate
URI is <a class="reference external" href="http://www.brightstardb.com/.well-known/model/version">http://www.brightstardb.com/.well-known/model/version</a>) to track the version number of
an entity, when making an update to an entity the version number is used to determine if
another client has concurrently updated the entity. If this is detected, it results in an
exception of the type <tt class="docutils literal"><span class="pre">BrightstarDB.Client.TransactionPreconditionsFailedException</span></tt> being raised.</p>
<div class="section" id="enabling-optimistic-locking">
<h4>Enabling Optimistic Locking<a class="headerlink" href="#enabling-optimistic-locking" title="Permalink to this headline">¶</a></h4>
<p>Optimistic locking can be enabled either through the connection string (giving the user
control over whether or not optimistic locking is enabled) or through code (giving the control
to the programmer).</p>
<p>To enable optimistic locking in a connection string, simply add &#8220;optimisticLocking=true&#8221; to
the connection string. e.g.</p>
<div class="highlight-python"><pre>type=http;endpoint=http://localhost:8090/brightstar;storeName=myStore;optimisticLocking=true</pre>
</div>
<p>To enable optimistic locking from code, use the optional optimisticLocking parameter on the
constructor of the context class e.g.:</p>
<div class="highlight-python"><pre>var myContext = new MyEntityContext(connectionString, true);</pre>
</div>
<div class="admonition note">
<p class="first admonition-title">Note</p>
<p class="last">The programmatic setting always overrides the setting in the connection string - this gives
the programmer final control over whether optimistic locking is used. The programmer can
also prevent optimistic locking from being used by passing false as the value of the
<tt class="docutils literal"><span class="pre">optimisticLocking</span></tt> parameter of the constructor of the context class.</p>
</div>
</div>
<div class="section" id="handling-optimistic-locking-errors">
<h4>Handling Optimistic Locking Errors<a class="headerlink" href="#handling-optimistic-locking-errors" title="Permalink to this headline">¶</a></h4>
<p>Optimistic locking errors only occur when the <tt class="docutils literal"><span class="pre">SaveChanges()</span></tt> method is called on the context
class. The error is notified by raising an exception of the type
<tt class="docutils literal"><span class="pre">BrightstarDB.Client.TransactionPreconditionsFailedException</span></tt>. When this exception is caught by
your code, you have two basic options to choose from. You can apply each of these options
separately to each object modified by your update.</p>
<blockquote>
<div><ol class="arabic simple">
<li>Attempt the save again but first update the local context object with data from the
server. This will save all the changes you have made EXCEPT for those that were detected on
the server. This is the &#8220;store wins&#8221; scenario.</li>
<li>Attempt the save again, but first update only the version numbers of the local context
object with data from the server. This will keep all the changes you have made, overwriting
any concurrent changes that happened on the server. This is the &#8220;client wins&#8221; scenario.</li>
</ol>
</div></blockquote>
<p>To attempt the save again, you must first call the <tt class="docutils literal"><span class="pre">Refresh()</span></tt> method on the context object.
This method takes two paramters - the first parameter specifies the mode for the refresh, this
can either be RefreshMode.ClientWins or RefreshMode.StoreWins depending on the scenario to be
applied. The second parameter is the entity or collection of entities to which the refresh is
to be applied. You apply different refresh strategies to different entities within the same
update if you wish. Once the conflicted entities are refreshed, you can then make a call to
the <tt class="docutils literal"><span class="pre">SaveChanges()</span></tt> method of the context once more. The code sample below shows this in
outline:</p>
<div class="highlight-python"><pre>try
{
  myContext.SaveChanges();
}
catch(TransactionPreconditionsFailedException)
{
  // Refresh the conflicted object(s) - in this case with the StoreWins mode
  myContext.Refresh(RefreshMode.StoreWins, conflictedEntity);
  // Attempt the save again
  myContext.SaveChanges();
}</pre>
</div>
<div class="admonition note">
<p class="first admonition-title">Note</p>
<p class="last">On stores with a high degree of concurrent updates it is possible that the second call to
<tt class="docutils literal"><span class="pre">SaveChanges()</span></tt> could also result in an optimistic locking error because objects have been
further modified since the initial optimistic locking failure was reported. Production code
for highly concurrent environments should be written to handle this possibility.</p>
</div>
</div>
</div>
<div class="section" id="linq-restrictions">
<span id="id9"></span><h3>LINQ Restrictions<a class="headerlink" href="#linq-restrictions" title="Permalink to this headline">¶</a></h3>
<div class="section" id="supported-linq-operators">
<h4>Supported LINQ Operators<a class="headerlink" href="#supported-linq-operators" title="Permalink to this headline">¶</a></h4>
<p>The LINQ query processor in BrightstarDB has some restrictions, but supports the most commonly
used core set of LINQ query methods. The following table lists the supported query methods.
Unless otherwise noted the indexed variant of LINQ query methods are not supported.</p>
<table border="1" class="docutils">
<colgroup>
<col width="9%" />
<col width="91%" />
</colgroup>
<thead valign="bottom">
<tr class="row-odd"><th class="head">Method</th>
<th class="head">Notes</th>
</tr>
</thead>
<tbody valign="top">
<tr class="row-even"><td>Any</td>
<td>Supported as first result operator. Not supported as second or subsequent result operator</td>
</tr>
<tr class="row-odd"><td>All</td>
<td>Supported as first result operator. Not supported as second or subsequent result operator</td>
</tr>
<tr class="row-even"><td>Average</td>
<td>Supported as first result operator. Not supported as second or subsequent result operator.</td>
</tr>
<tr class="row-odd"><td>Cast</td>
<td>Supported for casting between Entity Framework entity types only</td>
</tr>
<tr class="row-even"><td>Contains</td>
<td>Supported for literal values only</td>
</tr>
<tr class="row-odd"><td>Count</td>
<td>Supported with or without a Boolean filter expression. Supported as first result operator. Not supported as second or subsequent result operator.</td>
</tr>
<tr class="row-even"><td>Distinct</td>
<td>Supported for literal values. For entities <tt class="docutils literal"><span class="pre">Distinct()</span></tt> is supported but only to eliminate duplicates of the same Id any override of .Equals on the entity class is not used.</td>
</tr>
<tr class="row-odd"><td>First</td>
<td>Supported with or without a Boolean filter expression</td>
</tr>
<tr class="row-even"><td>LongCount</td>
<td>Supported with or without a Boolean filter expression. Supported as first result operator. Not supported as second or subsequent result operator.</td>
</tr>
<tr class="row-odd"><td>Max</td>
<td>Supported as first result operator. Not supported as second or subsequent result operator.</td>
</tr>
<tr class="row-even"><td>Min</td>
<td>Supported as first result operator. Not supported as second or subsequent result operator.</td>
</tr>
<tr class="row-odd"><td>OfType&lt;TResult&gt;</td>
<td>Supported only if <tt class="docutils literal"><span class="pre">TResult</span></tt> is an Entity Framework entity type</td>
</tr>
<tr class="row-even"><td>OrderBy</td>
<td>&nbsp;</td>
</tr>
<tr class="row-odd"><td>OrderByDescending</td>
<td>&nbsp;</td>
</tr>
<tr class="row-even"><td>Select</td>
<td>&nbsp;</td>
</tr>
<tr class="row-odd"><td>SelectMany</td>
<td>&nbsp;</td>
</tr>
<tr class="row-even"><td>Single</td>
<td>Supported with or without a Boolean filter expression</td>
</tr>
<tr class="row-odd"><td>SingleOrDefault</td>
<td>Supported with or without a Boolean filter expression</td>
</tr>
<tr class="row-even"><td>Skip</td>
<td>&nbsp;</td>
</tr>
<tr class="row-odd"><td>Sum</td>
<td>Supported as first result operator. Not supported as second or subsequent result operator.</td>
</tr>
<tr class="row-even"><td>Take</td>
<td>&nbsp;</td>
</tr>
<tr class="row-odd"><td>ThenBy</td>
<td>&nbsp;</td>
</tr>
<tr class="row-even"><td>ThenByDescending</td>
<td>&nbsp;</td>
</tr>
<tr class="row-odd"><td>Where</td>
<td>&nbsp;</td>
</tr>
</tbody>
</table>
</div>
<div class="section" id="supported-class-methods-and-properties">
<h4>Supported Class Methods and Properties<a class="headerlink" href="#supported-class-methods-and-properties" title="Permalink to this headline">¶</a></h4>
<p>In general, the translation of LINQ to SPARQL cannot translate methods on .NET datatypes into
functionally equivalent SPARQL. However we have implemented translation of a few commonly used
String, Math and DateTime methods as listed in the following table.</p>
<p>The return values of these methods and properties can only be used in the filtering of queries
and cannot be used to modify the return value. For example you can test that
<tt class="docutils literal"><span class="pre">foo.Name.ToLower().Equals(&quot;somestring&quot;)</span></tt>, but you cannot return the value <tt class="docutils literal"><span class="pre">foo.Name.ToLower()</span></tt>.</p>
<table border="1" class="docutils">
<colgroup>
<col width="45%" />
<col width="55%" />
</colgroup>
<thead valign="bottom">
<tr class="row-odd"><th class="head">.NET function</th>
<th class="head">SPARQL Equivalent</th>
</tr>
</thead>
<tbody valign="top">
<tr class="row-even"><td colspan="2"><strong>String Functions</strong></td>
</tr>
<tr class="row-odd"><td>p0.StartsWith(string s)</td>
<td>STRSTARTS(p0, s)</td>
</tr>
<tr class="row-even"><td>p0.StartsWith(string s, bool ignoreCase,
CultureInfo culture)</td>
<td>REGEX(p0, &#8220;^&#8221; + s, &#8220;i&#8221;) if ignoreCase is true;
STRSTARTS(p0, s) if ignoreCase is false</td>
</tr>
<tr class="row-odd"><td>p0.StartsWith(string s,
StringComparison comparisonOptions)</td>
<td>REGEX(p0, &#8220;^&#8221; + s, &#8220;i&#8221;) if comparisonOptions is
StringComparison.CurrentCultureIgnoreCase,
StringComparison.InvariantCultureIgnoreCase or
StringComparison.OrdinalIgnoreCase;
STRSTARTS(p0, s) otherwise</td>
</tr>
<tr class="row-even"><td>p0.EndsWith(string s)</td>
<td>STRENDS(p0, s)</td>
</tr>
<tr class="row-odd"><td><dl class="first last docutils">
<dt>p0.StartsWith(string s, bool ignoreCase,</dt>
<dd>CultureInfo culture)</dd>
</dl>
</td>
<td>REGEX(p0, s + &#8220;$&#8221;, &#8220;i&#8221;) if ignoreCase is true;
STRENDS(p0, s) if ignoreCase is false</td>
</tr>
<tr class="row-even"><td><dl class="first last docutils">
<dt>p0.StartsWith(string s, StringComparison</dt>
<dd>comparisonOptions)</dd>
</dl>
</td>
<td>REGEX(p0, s + &#8220;$&#8221;, &#8220;i&#8221;) if comparisonOptions is
StringComparison.CurrentCultureIgnoreCase,
StringComparison.InvariantCultureIgnoreCase or
StringComparison.OrdinalIgnoreCase;
STRENDS(p0, s) otherwise</td>
</tr>
<tr class="row-odd"><td>p0.Length</td>
<td>STRLEN(p0)</td>
</tr>
<tr class="row-even"><td>p0.Substring(int start)</td>
<td>SUBSTR(p0, start)</td>
</tr>
<tr class="row-odd"><td>p0.Substring(int start, int len)</td>
<td>SUBSTR(p0, start, end)</td>
</tr>
<tr class="row-even"><td>p0.ToUpper()</td>
<td>UCASE(p0)</td>
</tr>
<tr class="row-odd"><td>p0.ToLower()</td>
<td>LCASE(p0)</td>
</tr>
<tr class="row-even"><td colspan="2"><strong>Date Functions</strong></td>
</tr>
<tr class="row-odd"><td>p0.Day</td>
<td>DAY(p0)</td>
</tr>
<tr class="row-even"><td>p0.Hour</td>
<td>HOURS(p0)</td>
</tr>
<tr class="row-odd"><td>p0.Minute</td>
<td>MINUTES(p0)</td>
</tr>
<tr class="row-even"><td>p0.Month</td>
<td>MONTH(p0)</td>
</tr>
<tr class="row-odd"><td>p0.Second</td>
<td>SECONDS(p0)</td>
</tr>
<tr class="row-even"><td>p0.Year</td>
<td>YEAR(p0)</td>
</tr>
<tr class="row-odd"><td colspan="2"><strong>Math Functions</strong></td>
</tr>
<tr class="row-even"><td>Math.Round(decimal d)</td>
<td>ROUND(d)</td>
</tr>
<tr class="row-odd"><td>Math.Round(double d)</td>
<td>ROUND(d)</td>
</tr>
<tr class="row-even"><td>Math.Floor(decimal d)</td>
<td>FLOOR(d)</td>
</tr>
<tr class="row-odd"><td>Math.Floor(double d)</td>
<td>FLOOR(d)</td>
</tr>
<tr class="row-even"><td>Math.Ceiling(decimal d)</td>
<td>CEIL(d)</td>
</tr>
<tr class="row-odd"><td>Math.Ceiling(decimal d)</td>
<td>CEIL(d)</td>
</tr>
<tr class="row-even"><td colspan="2"><strong>Regular Expressions</strong></td>
</tr>
<tr class="row-odd"><td><dl class="first last docutils">
<dt>Regex.IsMatch(string p0,</dt>
<dd>string expression,
RegexOptions options)</dd>
</dl>
</td>
<td>REGEX(p0, expression, flags)
Flags are generated from the options parameter.
The supported RegexOptions are IgnoreCase,
Multiline, Singleline and
IgnorePatternWhitespace (or any combination of
these).</td>
</tr>
</tbody>
</table>
<p>The static method <tt class="docutils literal"><span class="pre">Regex.IsMatch()</span></tt> is supported when used to filter on a string property
in a LINQ query e.g.:</p>
<div class="highlight-python"><pre>context.Persons.Where(p =&gt; Regex.IsMatch(p.Name, "^a.*e$", RegexOptions.IgnoreCase));</pre>
</div>
<p>However, please note that the regular expression options that can be used is limited to a
combination of <tt class="docutils literal"><span class="pre">IgnoreCase</span></tt>, <tt class="docutils literal"><span class="pre">Multiline</span></tt>, <tt class="docutils literal"><span class="pre">Singleline</span></tt> and <tt class="docutils literal"><span class="pre">IgnorePatternWhitespace</span></tt>.</p>
</div>
</div>
<div class="section" id="odata">
<span id="id10"></span><h3>OData<a class="headerlink" href="#odata" title="Permalink to this headline">¶</a></h3>
<p>The Open Data Protocol (OData) is an open web protocol for querying data. An OData provider can be added to BrightstarDB Entity Framework projects to allow OData
consumers to query the underlying data in the store.</p>
<div class="admonition note">
<p class="first admonition-title">Note</p>
<p class="last"><a class="reference internal" href="#annotations-guide"><em>Identifier Attributes</em></a> must exist on any BrightstarDB entity
interfaces in order to be processed by an OData consumer</p>
</div>
<p>For more details on how to add a BrightstarDB OData service to your projects, read
<a class="reference internal" href="#adding-linked-data-support"><em>Adding Linked Data Support</em></a> in the MVC Nerd Dinner samples
chapter</p>
<div class="section" id="odata-restrictions">
<h4>OData Restrictions<a class="headerlink" href="#odata-restrictions" title="Permalink to this headline">¶</a></h4>
<p>The OData v2 protocol implemented by BrightstarDB does not support properties that contain a
collection of literal values. This means that BrightstarDB entity properties that are of type
<tt class="docutils literal"><span class="pre">ICollection&lt;literal</span> <span class="pre">type&gt;</span></tt> are not supported. Any properties of this type will not be
readable via the OData service.</p>
<p>An OData provider connected to the BrightstarDB Entity Framework as a few restrictions on how
it can be queried.</p>
<p><strong>Expand</strong></p>
<blockquote>
<div><ul class="simple">
<li>Second degree expansions are not currently supported. e.g.
<tt class="docutils literal"><span class="pre">Department('5598556a-671a-44f0-b176-502da62b3b2f')?$expand=Persons/Skills</span></tt></li>
</ul>
</div></blockquote>
<p><strong>Filtering</strong></p>
<blockquote>
<div><ul class="simple">
<li>The arithmetic filter <tt class="docutils literal"><span class="pre">Mod</span></tt> is not supported</li>
<li>The string filter functions <tt class="docutils literal"><span class="pre">int</span> <span class="pre">indexof(string</span> <span class="pre">p0,</span> <span class="pre">string</span> <span class="pre">p1)</span></tt>,
<tt class="docutils literal"><span class="pre">string</span> <span class="pre">trim(string</span> <span class="pre">p0)</span></tt> and <tt class="docutils literal"><span class="pre">trim(string</span> <span class="pre">p0,</span> <span class="pre">string</span> <span class="pre">p1)</span></tt> are not supported.</li>
<li>The type filter functions <tt class="docutils literal"><span class="pre">bool</span> <span class="pre">IsOf(type</span> <span class="pre">p0)</span></tt> and <tt class="docutils literal"><span class="pre">bool</span> <span class="pre">IsOf(expression</span> <span class="pre">p0,</span> <span class="pre">type</span> <span class="pre">p1)</span></tt>
are not supported.</li>
</ul>
</div></blockquote>
<p><strong>Format</strong></p>
<p>Microsoft WCF Data Services do not currently support the <tt class="docutils literal"><span class="pre">$format</span></tt> query option.
To return OData results formatted in JSON, the accept headers can be set in the web request
sent to the OData service.</p>
</div>
</div>
<div class="section" id="savingchanges-event">
<span id="id11"></span><h3>SavingChanges Event<a class="headerlink" href="#savingchanges-event" title="Permalink to this headline">¶</a></h3>
<p>The generated EntityFramework context class exposes an event, <tt class="docutils literal"><span class="pre">SavingChanges</span></tt>. This event is
raised during the processing of the <tt class="docutils literal"><span class="pre">SaveChanges()</span></tt> method before any data is committed back to
the Brightstar store. The event sender is the context class itself and in the event handler
you can use the <tt class="docutils literal"><span class="pre">TrackedObjects</span></tt> property of the context class to iterate through all entities
that the context class has retrieved from the BrightstarDB store. Entities expose an <tt class="docutils literal"><span class="pre">IsModified</span></tt>
property which can be used to determine if the entity has been newly created or locally
modified. The sample code below uses this to update a <tt class="docutils literal"><span class="pre">Created</span></tt> and <tt class="docutils literal"><span class="pre">LastModified</span></tt>
timestamp on any entity that implements the <tt class="docutils literal"><span class="pre">ITrackable</span></tt> interface.:</p>
<div class="highlight-python"><pre>private static void UpdateTrackables(object sender, EventArgs e)
{
  // This method is invoked by the context.
  // The sender object is the context itself
  var context = sender as MyEntityContext;


  // Iterate through just the tracked objects that implement the ITrackable interface
  foreach(var t in context.TrackedObjects
                  .Where(x=&gt;x is ITrackable &amp;&amp; x.IsModified)
                  .Cast&lt;ITrackable&gt;())
  {
    // If the Created property is not yet set, it will have DateTime.MinValue as its defaulft value
    // We can use this fact to determine if the Created property needs setting.
    if (t.Created == DateTime.MinValue) t.Created = DateTime.Now;

    // The LastModified property should always be updated
    t.LastModified = DateTime.Now;
  }
}</pre>
</div>
<div class="admonition note">
<p class="first admonition-title">Note</p>
<p class="last">The source code for this example can be found in [INSTALLDIR]\Samples\EntityFramework\EntityFrameworkSamples.sln</p>
</div>
</div>
<div class="section" id="inotifypropertychanged-and-inotifycollectionchanged-support">
<span id="local-change-tracking"></span><h3>INotifyPropertyChanged and INotifyCollectionChanged Support<a class="headerlink" href="#inotifypropertychanged-and-inotifycollectionchanged-support" title="Permalink to this headline">¶</a></h3>
<p>The classes generated by the Entity Framework provide support for tracking local changes. All
generated entity classes implement the <a class="reference external" href="http://msdn.microsoft.com/en-us/library/system.componentmodel.inotifypropertychanged%28v=vs.100%29.aspx">System.ComponentModel.INotifyPropertyChanged</a>
interface and fire a notification event any time a property with a single value is modified.
All collections exposed by the generated classes implement the
<a class="reference external" href="http://msdn.microsoft.com/en-us/library/system.collections.specialized.inotifycollectionchanged%28v=vs.100%29.aspx">System.Collections.Specialized.INotifyCollectionChanged</a> interface and fire a notification
when an item is added to or removed from the collection or when the collection is reset.</p>
<p>There are a few points to note about using these features with the Entity Framework:</p>
<p>Firstly, although the generated classes implement the <tt class="docutils literal"><span class="pre">INotifyPropertyChanged</span></tt> interface, your
code will typically use the interfaces. To attach a handler to the <tt class="docutils literal"><span class="pre">PropertyChanged</span></tt> event, you
need an instance of <tt class="docutils literal"><span class="pre">INotifyPropertyChanged</span></tt> in your code. There are two ways to achieve this -
either by casting or by adding <tt class="docutils literal"><span class="pre">INotifyPropertyChanged</span></tt> to your entity interface. If casting you
will need to write code like this:</p>
<div class="highlight-python"><pre>// Get an entity to listen to
var person = _context.Persons.Where(x=&gt;x.Name.Equals("Fred")).FirstOrDefault();

// Attach the NotifyPropertyChanged event handler
(person as INotifyPropertyChanged).PropertyChanged += HandlePropertyChanged;</pre>
</div>
<p>Alternatively it can be easier to simply add the <tt class="docutils literal"><span class="pre">INotifyPropertyChanged</span></tt> interface to your
entity interface like this:</p>
<div class="highlight-python"><pre>[Entity]
public interface IPerson : INotifyPropertyChanged
{
  // Property definitions go here
}</pre>
</div>
<p>This enables you to then write code without the cast:</p>
<div class="highlight-python"><pre>// Get an entity to listen to
var person = _context.Persons.Where(x=&gt;x.Name.Equals("Fred")).FirstOrDefault();

// Attach the NotifyPropertyChanged event handler
person.PropertyChanged += HandlePropertyChanged;</pre>
</div>
<p>When tracking changes to collections you should also be aware that the dynamically loaded
nature of these collections means that sometimes it is not possible for the change tracking
code to provide you with the object that was removed from a collection. This will typically
happen when you have a collection one one entity that is the inverse of a collection or
property on another entity. Updating the collection at one end will fire the
<a class="reference external" href="http://msdn.microsoft.com/en-us/library/system.collections.specialized.inotifycollectionchanged.collectionchanged%28v=vs.100%29.aspx">CollectionChanged</a> event on the inverse collection, but if the inverse collection is not yet
loaded, the event will be raised as a <a class="reference external" href="http://msdn.microsoft.com/en-us/library/system.collections.specialized.notifycollectionchangedaction%28v=vs.100%29.aspx">NotifyCollectionChangedAction.Reset</a> type event,
rather than a <a class="reference external" href="http://msdn.microsoft.com/en-us/library/system.collections.specialized.notifycollectionchangedaction%28v=vs.100%29.aspx">NotifyCollectionChangedAction.Remove</a> event. This is done to avoid the
overhead of retrieving the removed object from the data store just for the purpose of raising
the notification event.</p>
<p>Finally, please note that event handlers are attached only to the local entity objects, the
handlers are not persisted when the context changes are saved and are not available to any new
context&#8217;s you create - these handlers are intended only for tracking changes made locally to
properties in the context before a <tt class="docutils literal"><span class="pre">SaveChanges()</span></tt> is invoked. The properties are also useful
for data binding in applications where you want the user interface to update as the properties
are modified.</p>
</div>
</div>
<div class="section" id="entity-framework-samples">
<span id="id12"></span><h2>Entity Framework Samples<a class="headerlink" href="#entity-framework-samples" title="Permalink to this headline">¶</a></h2>
<p>The following samples provide detailed information on how to build applications using
BrightstarDB. If there are classes of applications for which you would like to see other
tutorials please let us know.</p>
<div class="section" id="tweetbox">
<span id="id13"></span><h3>Tweetbox<a class="headerlink" href="#tweetbox" title="Permalink to this headline">¶</a></h3>
<div class="admonition note">
<p class="first admonition-title">Note</p>
<p class="last">The source code for this example can be found in
[INSTALLDIR]\Samples\EntityFramework\EntityFrameworkSamples.sln</p>
</div>
<div class="section" id="overview">
<h4>Overview<a class="headerlink" href="#overview" title="Permalink to this headline">¶</a></h4>
<p>The TweetBox sample is a simple console application that shows the speed in which BrightstarDB
can load content. The aim is not to create a Twitter style application, but to show how
objects with various relationships to one another are loading quickly, in a structure that
will be familiar to developers.</p>
<p>The model consists of 3 simple interfaces: <tt class="docutils literal"><span class="pre">IUser</span></tt>, <tt class="docutils literal"><span class="pre">ITweet</span></tt> and <tt class="docutils literal"><span class="pre">IHashTag</span></tt>. The relationships
between the interfaces mimic the structure on Twitter, in that Users have a many to many
relationship with other Users (or followers), and have a one to many relationship with Tweets.
The tweets have a many to many relationship with Hashtags, as a Tweet can have zero or more
Hashtags, and a Hashtag may appear in more than one Tweet.</p>
</div>
<div class="section" id="the-interfaces">
<h4>The Interfaces<a class="headerlink" href="#the-interfaces" title="Permalink to this headline">¶</a></h4>
<p><strong>IUser</strong></p>
<p>The IUser interface represents a user on Twitter, with simple string properties for the
username, bio (profile text) and date of registration. The &#8216;Following&#8217; property shows the list
of users that this user follows, the other end of this relationship is shown in the
&#8216;Followers&#8217; property, this is marked with the &#8216;InverseProperty&#8217; attribute to tell BrightstarDB
that Followers is the other end of the Following relationship. The final property is a list of
tweets that the user has authored, this is the other end of the relationship from the ITweet
interface (described below):</p>
<div class="highlight-python"><pre>[Entity]
public interface IUser
{
    string Id { get; }
    string Username { get; set; }
    string Bio { get; set; }
    DateTime DateRegistered { get; set; }
    ICollection&lt;IUser&gt; Following { get; set; }
    [InverseProperty("Following")]
    ICollection&lt;IUser&gt; Followers { get; set; }
    [InverseProperty("Author")]
    ICollection&lt;ITweet&gt; Tweets { get; set; }
}</pre>
</div>
<p><strong>ITweet</strong></p>
<p>The ITweet interface represents a tweet on twitter, and has simple properties for the tweet
content and the date and time it was published. The Tweet has an IUser property (&#8216;Author&#8217;) to
relate it to the user who wrote it (the other end of this relationship is described above).
ITweet also contains a collection of Hashtags that appear in the tweet (described below):</p>
<div class="highlight-python"><pre>[Entity]
public interface ITweet
{
    string Id { get; }
    string Content { get; set; }
    DateTime DatePublished { get; set; }
    IUser Author { get; set; }
    ICollection&lt;IHashTag&gt; HashTags { get; set; }
}</pre>
</div>
<p><strong>IHashTag</strong></p>
<p>A hashtag is a keyword that is contained in a tweet. The same hashtag may appear in more than
one tweet, and so the collection of Tweets is marked with the &#8216;InverseProperty&#8217; attribute to
show that it is the other end of the collection of HashTags in the ITweet interface:</p>
<div class="highlight-python"><pre>[Entity]
public interface IHashTag
{
    string Id { get; }
    string Value { get; set; }
    [InverseProperty("HashTags")]
    ICollection&lt;ITweet&gt; Tweets { get; set; }
}</pre>
</div>
</div>
<div class="section" id="initialising-the-brightstardb-context">
<h4>Initialising the BrightstarDB Context<a class="headerlink" href="#initialising-the-brightstardb-context" title="Permalink to this headline">¶</a></h4>
<p>The BrightstarDB context can be initialised using a connection string:</p>
<div class="highlight-python"><pre>var connectionString = "Type=http;endpoint=http://localhost:8090/brightstar;StoreName=Tweetbox";
var context = new TweetBoxContext(connectionString);</pre>
</div>
<p>If you have added the connection string into the Config file:</p>
<div class="highlight-python"><pre>&lt;add key="BrightstarDB.ConnectionString" value="Type=http;endpoint=http://localhost:8090/brightstar;StoreName=Tweetbox" /&gt;</pre>
</div>
<p>then you can initialise the content with a simple:</p>
<div class="highlight-python"><pre>var context = new TweetBoxContext();</pre>
</div>
<p>For more information about connection strings, please read the
<a class="reference internal" href="#connection-strings"><em>&#8220;Connection Strings&#8221;</em></a> topic.</p>
</div>
<div class="section" id="creating-a-new-user-entity">
<h4>Creating a new User entity<a class="headerlink" href="#creating-a-new-user-entity" title="Permalink to this headline">¶</a></h4>
<p>Method 1:</p>
<div class="highlight-python"><pre>var jo = context.Users.Create();
jo.Username = "JoBloggs79";
jo.Bio = "A short sentence about this user";
jo.DateRegistered = DateTime.Now;
context.SaveChanges();</pre>
</div>
<p>Method 2:</p>
<div class="highlight-python"><pre>var jo = new User {
                 Username = "JoBloggs79",
                 Bio = "A short sentence about this user",
                 DateRegistered = DateTime.Now
             };
context.Users.Add(jo);
context.SaveChanges();</pre>
</div>
</div>
<div class="section" id="relationships-between-entities">
<h4>Relationships between entities<a class="headerlink" href="#relationships-between-entities" title="Permalink to this headline">¶</a></h4>
<p>The following code snippets show the creation of relationships between entities by simply
setting properties.</p>
<p><strong>Users to Users</strong>:</p>
<div class="highlight-python"><pre>var trevor = context.Users.Create();
trevor.Username = "TrevorSims82";
trevor.Bio = "A short sentence about this user";
trevor.DateRegistered = DateTime.Now;
trevor.Following.Add(jo);
context.SaveChanges();</pre>
</div>
<p><strong>Tweets to Tweeter</strong>:</p>
<div class="highlight-python"><pre>var tweet = context.Tweets.Create();
tweet.Content = "My first tweet";
tweet.DatePublished = DateTime.Now;
tweet.Tweeter = trevor;
context.SaveChanges();</pre>
</div>
<p><strong>Tweets to HashTags:</strong>:</p>
<div class="highlight-python"><pre>var nosql = context.HashTags.Where(ht =&gt; ht.Value.Equals("nosql").FirstOrDefault();
if (nosql == null)
{
    nosql = context.HashTags.Create();
    nosql.Value = "nosql";
}
var  brightstardb = context.HashTags.Where(ht =&gt; ht.Value.Equals("brightstardb").FirstOrDefault();
if (brightstardb == null)
{
    brightstardb = context.HashTags.Create();
    brightstardb.Value = "brightstardb";
}
var tweet2 = context.Tweets.Create();
tweet.Content = "New fast, scalable NoSQL database for the .NET platform";
tweet.HashTags.Add(nosql);
tweet.HashTags.Add(brightstar);
tweet.DatePublished = DateTime.Now;
tweet.Tweeter = trevor;
context.SaveChanges();</pre>
</div>
</div>
<div class="section" id="fast-creation-persistence-and-indexing-of-data">
<h4>Fast creation, persistence and indexing of data<a class="headerlink" href="#fast-creation-persistence-and-indexing-of-data" title="Permalink to this headline">¶</a></h4>
<p>In order to show the speed at which objects can be created, persisted and index in
BrightstarDB, the console application creates 100 users, each with 500 tweets. Each of those
tweets has 2 hashtags (chosen from a set of 10,000 hash tags).</p>
<blockquote>
<div><ol class="arabic simple">
<li>Creates 100 users</li>
<li>Creates 10,000 hashtags</li>
<li>Saves the users and hashtags to the database</li>
<li>Loops through the existing users and adds followers and tweets (each tweet has 2 random hashtags)</li>
<li>Saves the changes back to the store</li>
<li>Writes out the time taken to the console</li>
</ol>
</div></blockquote>
</div>
</div>
<div class="section" id="mvc-nerd-dinner">
<span id="id14"></span><h3>MVC Nerd Dinner<a class="headerlink" href="#mvc-nerd-dinner" title="Permalink to this headline">¶</a></h3>
<div class="admonition note">
<p class="first admonition-title">Note</p>
<p class="last">The source code for this example can be found in the solution
[INSTALLDIR]\Samples\NerdDinner\BrightstarDB.Samples.NerdDinner.sln</p>
</div>
<p>To demonstrate the ease of using BrightstarDB with ASP.NET MVC, we will use the well-known
“Nerd Dinner” tutorial used by .NET Developers when they first learn MVC. We won’t recreate
the full Nerd Dinner application, but just a portion of it, to show how to use BrightstarDB
for code-first data persistence, and show how it not only matches the ease of creating
applications from scratch, but surpasses Entity Framework by introducing pain free model
changes (more on that later). The Brightstar.NerdDinner sample application shows a simple
model layer, using ASP.NET MVC4 for the CRUD application and BrightstarDB for data storage. In
later sections we will extend this basic functionality with support for linked data in the
form of both OData and SPARQL query support and we will show how to use BrightstarDB as the
basis for a .NET custom membership and role provider.</p>
<p>This tutorial is quite long, but is broken up into a number of separate sections each of which
you can follow along with in code, or you can refer to the complete sample application which
can be found in [INSTALLDIR]\Samples\NerdDinner.</p>
<blockquote>
<div><ul class="simple">
<li><a class="reference internal" href="#creating-the-basic-data-model"><em>Creating The Basic Data Model</em></a> - creates the initial
application and code-first data model</li>
<li><a class="reference internal" href="#creating-mvc-controllers-and-v"><em>Creating MVC Controllers and Views</em></a> - shows how
easy it is to use this model with ASP.NET MVC4 to create web interfaces for create, update
and delete (CRUD) operations.</li>
<li><a class="reference internal" href="#applying-model-changes"><em>Applying Model Changes</em></a> - shows how BrightstarDB handles
changes to the code-first data model without data loss.</li>
<li><a class="reference internal" href="#adding-a-custom-membership-pro"><em>Adding A Custom Membership Provider</em></a> - describes
how to build a ASP.NET custom membership provider that uses BrightstarDB to manage user
account information.</li>
<li><a class="reference internal" href="#adding-a-custom-role-provider"><em>Adding A Custom Role Provider</em></a> - builds on the
custom membership provider to enable users to be assigned different roles and levels of access</li>
<li><a class="reference internal" href="#adding-linked-data-support"><em>Adding Linked Data Support</em></a> - extends the web
application to provide a SPARQL and an ODATA query endpoint</li>
<li><a class="reference internal" href="#consuming-odata-in-powerpivot"><em>Consuming OData In PowerPivot</em></a> - shows one way in
which the OData endpoint can be used - enabling data to be retrieved into Excel.</li>
</ul>
</div></blockquote>
<div class="section" id="creating-the-basic-data-model">
<span id="id15"></span><h4>Creating The Basic Data Model<a class="headerlink" href="#creating-the-basic-data-model" title="Permalink to this headline">¶</a></h4>
<div class="section" id="creating-the-asp-net-mvc4-application">
<h5>Creating the ASP.NET MVC4 Application.<a class="headerlink" href="#creating-the-asp-net-mvc4-application" title="Permalink to this headline">¶</a></h5>
<p><strong>Step 1: Create a New Empty ASP.NET MVC4 Application</strong></p>
<img alt="_images/mvc0.png" src="_images/mvc0.png" />
<p>Choose “ASP.NET MVC 4 Web Application” from the list of project types in Visual Studio. If you
do not already have MVC 4 installed you can download it from <a class="reference external" href="http://www.asp.net/mvc/mvc4">http://www.asp.net/mvc/mvc4</a>.
You must also install the &#8220;Visual Web Developer&#8221; feature in Visual Studio to be able to open
and work with MVC projects. Choose a name for your application (we are using
BrightstarDB.Samples.NerdDinner), and then click OK. In the next dialog box, select “Empty”
for the template type, this mean that the project will not be pre-filled with any default
controllers, models or views so we can show every step in building the application. Choose
“Razor” as the View Engine. Leave the “Create a unit test project” box unchecked, as for the
purposes of this example project it is not needed.</p>
<img alt="_images/mvc0a.png" src="_images/mvc0a.png" />
<p><strong>Step 2: Add references to BrightstarDB</strong></p>
<p>Add a reference in your project to the BrightstarDB DLL from the BrightstarDB SDK.</p>
<p><strong>Step 3: Add a connection string to your BrightstarDB location</strong></p>
<p>Open the web.config file in the root directory your new project, and add a connection string
to the location of your BrightstarDB store. There is no setup required - you can name a store
that does not exist and it will be created the first time that you try to connect to it from
the application. The only thing you will need to ensure is that if you are using an HTTP, TCP
or Named Pipe connection, the BrightstarDB service must be running:</p>
<div class="highlight-python"><pre>&lt;appSettings&gt;
  ...
  &lt;add key="BrightstarDB.ConnectionString"
       value="Type=http;endpoint=http://localhost:8090/brightstar;StoreName=NerdDinner" /&gt;
  ...
&lt;/appSettings&gt;</pre>
</div>
<p>For more information about connection strings, please read the <a class="reference internal" href="#connection-strings"><em>&#8220;Connection Strings&#8221;</em></a> topic.</p>
<p><strong>Step 4: Add the Brightstar Entity Context into your project</strong></p>
<p>Select <strong>Add &gt; New Item</strong> on the Models folder, and select <strong>Brightstar Entity Context</strong> from the
Data category. Rename it to NerdDinnerContext.tt</p>
<img alt="_images/mvc2.png" src="_images/mvc2.png" />
<p><strong>Step 5: Creating the data model interfaces</strong></p>
<p>BrightstarDB data models are defined by a number of standard .NET interfaces with certain
attributes set. The NerdDinner model is very simple (especially for this tutorial) and only
consists of a set of “Dinners” that refer to specific events that people can attend, and also
a set of “RSVP”s that are used to track a person’s interest in attending a dinner.</p>
<p>We create the two interfaces as shown below in the Models folder of our project.</p>
<p>IDinner.cs:</p>
<div class="highlight-python"><pre>using System;
using System.Collections.Generic;
using System.ComponentModel.DataAnnotations;
using BrightstarDB.EntityFramework;

namespace BrightstarDB.Samples.NerdDinner.Models
{
    [Entity]
    public interface IDinner
    {
        [Identifier("http://nerddinner.com/dinners/")]
        string Id { get; }


        [Required(ErrorMessage = "Please provide a title for the dinner")]
        string Title { get; set; }


        string Description { get; set; }


        [Display(Name = "Event Date")]
        [DataType(DataType.DateTime)]
        DateTime EventDate { get; set; }


        [Required(ErrorMessage = "The event must have an address.")]
        string Address { get; set; }


        [Required(ErrorMessage = "Please enter the name of the host of this event")]
        [Display(Name = "Host")]
        string HostedBy { get; set; }


        ICollection&lt;IRSVP&gt; RSVPs { get; set; }
    }
}</pre>
</div>
<p>IRSVP.cs::</p>
<div class="highlight-python"><pre>using System.ComponentModel.DataAnnotations;
using BrightstarDB.EntityFramework;

namespace BrightstarDB.Samples.NerdDinner.Models
{
    [Entity]
    public interface IRSVP
    {
        [Identifier("http://nerddinner.com/rsvps/")]
        string Id { get; }


        [Display(Name = "Email Address")]
        [Required(ErrorMessage = "Email address is required")]
        string AttendeeEmail { get; set; }


        [InverseProperty("RSVPs")]
        IDinner Dinner { get; set; }
    }
}</pre>
</div>
<p>By default, BrightstarDB identifier properties are automatically generated URIs that are
automatically. In order to work with simpler values for our entity Ids we decorate the Id
property with an identifier attribute. This adds a prefix for BrightstarDB to use when
generating and querying the entity identifiers and ensures that the actual value we get in the
Id property is just the part of the URI that follows the prefix, which will be a simple GUID
string.</p>
<p>In the IRSVP interface, we add an InverseProperty attribute to the Dinner property, and set it
to the name of the .NET property on the referencing type (&#8220;RSVPs&#8221;). This shows that these two
properties reflect different sides of the same association. In this case the association is a
one-to-many relationship (one dinner can have many RSVPs), but BrightstarDB also supports
many-to-many and many-to-one relationships using the same mechanism.</p>
<p>We can also add other attributes such as those from the <tt class="docutils literal"><span class="pre">System.ComponentModel.DataAnnotations</span></tt>
namespace to provide additional hints for the MVC framework such as marking a property as
required, providing an alternative display name for forms or specifying the way in which a
property should be rendered. These additional attributes are automatically added to the
classes generated by the BrightstarDB Entity Framework. For more information about
BrightstarDB Entity Framework attributes and passing through additional attributes, please
refer to the <a class="reference internal" href="#annotations-guide"><em>Annotations</em></a> section of the <a class="reference internal" href="#entity-framework"><em>Entity Framework</em></a> documentation.</p>
<p><strong>Step 6: Creating a context class to handle database persistence</strong></p>
<p>Right click on the Brightstar Entity Context and select <strong>Run Custom Tool</strong>. This runs the text
templating tool that updates the .cs file contained within the .tt file with the most up to
date persistence code needed for your interfaces. Any time you modify the interfaces that
define your data model, you should re-run the text template to regenerate the context code.</p>
<p>We now have the basic data model for our application completed and have generated the code for
creating persistent entities that match our data model and storing them in BrightstarDB. In
the next step we will see how to use this data model and context in creating screens in our
MVC application.</p>
</div>
<div class="section" id="running-the-application">
<h5>Running the application<a class="headerlink" href="#running-the-application" title="Permalink to this headline">¶</a></h5>
<p>Hit F5 to start up the application in Debug mode. This opens a browser window that by default
starts in the Index action of the HomeController. As we have not yet added any dinners yet,
the list is empty, but we can click on <strong>Create New</strong> to go to the Create view to add some
dinners.</p>
<img alt="_images/mvc8.png" src="_images/mvc8.png" />
<p>Note that the custom attributes entered in the entity interface have been picked up by MVC. If
you attempt to submit this form without filling in Title, Address or Host you will see the
form validation errors on the page.</p>
<p>After entering some data we can see them in the list on the index page:</p>
<img alt="_images/mvc9.png" src="_images/mvc9.png" />
<p>We can also easily view the details of a dinner, edit the details or delete the dinner by
using the links next to each item on the list.</p>
</div>
</div>
<div class="section" id="creating-mvc-controllers-and-views">
<span id="creating-mvc-controllers-and-v"></span><h4>Creating MVC Controllers And Views<a class="headerlink" href="#creating-mvc-controllers-and-views" title="Permalink to this headline">¶</a></h4>
<p>In the previous section we created the skeleton MVC application and added to it a BrightstarDB
data model for dinners and RSVPs. In this section we will start to flesh out the MVC
application with some screens for data entry and display.</p>
<div class="section" id="create-the-home-controller">
<h5>Create the Home Controller<a class="headerlink" href="#create-the-home-controller" title="Permalink to this headline">¶</a></h5>
<p>Right click on the controller folder and select “Add &gt; Controller”. Name it “HomeController”
and select “Controller with empty Read/Write Actions”. This adds a Controller class to the
folder, with empty actions for Index(), Details(), Create(), &nbsp;Edit() and Delete(). This will
be the main controller for all our CRUD operations.</p>
<p>The basic MVC4 template for these operations makes a couple of assumptions that we need to
correct. Firstly, the id parameter passed in to various operations is assumed to be an int;
however our BrightstarDB entities use a string value for their Id, so we must change the int
id parameters to string id on the Details, Edit and Delete actions. Secondly, by default the
HttpPost actions for the Create and Edit actions accept FormCollection parameters, but because
we have a data model available it is easier to work with the entity class, so we will change
these methods to accept our data model’s classes as parameters rather than FormCollection and
let the MVC framework handle the data binding for us - for the Delete action it does not
really matter as we are not concerned with the value posted back by that action in this sample
application.</p>
<p>Before we start editing the Actions, we add the following line to the HomeController class:</p>
<div class="highlight-python"><pre>public class HomeController : Controller
{
        NerdDinnerContext _nerdDinners = new NerdDinnerContext();
...
}</pre>
</div>
<p>This ensures that any action invoked on the controller can access the BrightstarDB entity
framework context.</p>
<p><strong>Index</strong></p>
<p>This view will show a list of all dinners in the system, it’s a simple case of using LINQ to
return a list of all dinners::</p>
<div class="highlight-python"><pre>public ActionResult Index()
{
    var dinners = from d in _nerdDinners.Dinners
                  select d;
    return View(dinners.ToList());
}</pre>
</div>
<p><strong>Details</strong></p>
<p>This view shows all the details of a particular dinner, so we use LINQ again to query the
store for a dinner with a particular Id. Note that we have changed the type of the id
parameter from int to string. The LINQ query here uses FirstOrDefault() which means that if
there is no dinner with the specified ID, we will get a null value returned by the query. If
that is the case, we return the user to a &#8220;404&#8221; view to display a &#8220;Not found&#8221; message in the
browser, otherwise we return the default Details view.:</p>
<div class="highlight-python"><pre>public ActionResult Details(string id)
{
    var dinner = _nerdDinners.Dinners.FirstOrDefault(d =&gt; d.Id.Equals(id));
    return dinner == null ? View("404") : View(dinner);
}</pre>
</div>
<p><strong>Edit</strong></p>
<p>The controller has two methods to deal with the Edit action, the first handles a get request
and is similar to the Details method above, but the view loads the property values into a form
ready to be edited. As with the previous method, the type of the id parameter has been changed
to string:</p>
<div class="highlight-python"><pre>public ActionResult Edit(string id)
{
    var dinner = _nerdDinners.Dinners.Where(d =&gt; d.Id.Equals(id)).FirstOrDefault();
    return dinner == null ? View("404") : View(dinner);
}</pre>
</div>
<p>The method that accept the HttpPost that is sent back after a user clicks “Save” on the view,
deals with updating the property values in the store. Note that rather than receiving the id
and FormsCollection parameters provided by the default scaffolding, we change this method to
receive a Dinner object. The Dinner class is generated by the BrightstarDB Entity Framework
from our IDinner data model interface and the MVC framework can automatically data bind the
values in the edit form to a new Dinner instance before invoking our Edit method. This
automatic data binding makes the code to save the edited dinner much simpler and shorter - we
just need to attach the Dinner object to the _nerdDinners context and then call SaveChanges()
on the context to persist the updated entity:</p>
<div class="highlight-python"><pre>[HttpPost]
public ActionResult Edit(Dinner dinner)
{
    if(ModelState.IsValid)
    {
        dinner.Context = _nerdDinners;
        _nerdDinners.SaveChanges();
        return RedirectToAction("Index");
    }
    return View();
}</pre>
</div>
<p><strong>Create</strong></p>
<p>Like the Edit method, Create displays a form on the initial view, and then accepts the
HttpPost that gets sent back after a user clicks “Save”. To make things slight easier for the
user we are pre-filling the “EventDate” property with a date one week in the future:</p>
<div class="highlight-python"><pre>public ActionResult Create()
{
   var dinner = new Dinner {EventDate = DateTime.Now.AddDays(7)};
   return View(dinner);
}</pre>
</div>
<p>When the user has entered the rest of the dinner details, we add the Dinner object to the
Dinners collection in the context and then call SaveChanges():</p>
<div class="highlight-python"><pre>[HttpPost]
public ActionResult Create(Dinner dinner)
{
    if(ModelState.IsValid)
    {
        _nerdDinners.Dinners.Add(dinner);
        _nerdDinners.SaveChanges();
        return RedirectToAction("Index");
    }
    return View();
}</pre>
</div>
<p><strong>Delete</strong></p>
<p>The first stage of the Delete method displays the details of the dinner about to be deleted to
the user for confirmation:</p>
<div class="highlight-python"><pre>public ActionResult Delete(string id)
{
    var dinner = _nerdDinners.Dinners.Where(d =&gt; d.Id.Equals(id)).FirstOrDefault();
    return dinner == null ? View("404") : View(dinner);
}</pre>
</div>
<p>When the user has confirmed the object is Deleted from the store:</p>
<div class="highlight-python"><pre>[HttpPost, ActionName("Delete")]
public ActionResult DeleteConfirmed(string id, FormCollection collection)
{
    var dinner = _nerdDinners.Dinners.FirstOrDefault(d =&gt; d.Id.Equals(id));
    if (dinner != null)
    {
        _nerdDinners.DeleteObject(dinner);
        _nerdDinners.SaveChanges();
    }
    return RedirectToAction("Index");
}</pre>
</div>
</div>
<div class="section" id="adding-views">
<h5>Adding views<a class="headerlink" href="#adding-views" title="Permalink to this headline">¶</a></h5>
<p>Now that we have filled in the logic for the actions, we can proceed to create the necessary
views. These views will make use of the Microsoft JQuery Unobtrusive Validation nuget package.
You can install this package through the GUI Nuget package manager or using the NuGet console
command:</p>
<div class="highlight-python"><pre>PM&gt; install-package Microsoft.jQuery.Unobtrusive.Validation</pre>
</div>
<p>This will also install the jQuery and jQuery.Validation packages that are dependencies.</p>
<p>Before creating specific views, we can create a common look and feel for these views by
creating a _ViewStart.cshtml and a shared _Layout.cshtml. This approach also makes the Razor
for the individual views simpler and easier to manage. Please refer to the sample solution for
the content of these files and the 404 view that is displayed when a URL specifies an ID that
cannot be resolved.</p>
<p>All of the views for the Home controller need to go in the Home folder under the Views folder
- if it does not exist yet, create the Home folder within the Views folder of the MVC
solution. Then, to Add a view, right click on the “Home” folder within “Views” and select “Add
&gt; View”. For each view we create a strongly-typed view with the appropriate scaffold template
and create it as a partial view.</p>
<p>The Index View uses a List template, and the IDinner model:</p>
<img alt="_images/mvc3.png" src="_images/mvc3.png" />
<div class="admonition note">
<p class="first admonition-title">Note</p>
<p class="last">If the IDinner type is not displayed in the &#8220;Model class&#8221; drop-down list, this may be
because Visual Studio is not aware of the type yet - to fix this, you must save and compile
the solution before trying to add views.</p>
</div>
<div class="admonition note">
<p class="first admonition-title">Note</p>
<p class="last">If you get an error from Visual Studio when trying to add this view, please see
<a class="reference external" href="http://techquila.com/tech/2012/11/mvc4-list-view-template-error-column-attribute-is-an-ambiguous-reference/">this blog post</a> for a possible solution.</p>
</div>
<p>The Details View uses the Details template:</p>
<img alt="_images/mvc4.png" src="_images/mvc4.png" />
<p>The Edit View uses the Edit template and also includes script library references. You may want to
modify the reference to the jquery-1.7.1.min.js script from the generated template to point to
the version of jQuery installed by the validation NuGet package (this is jquery-1.4.4.min.js
at the time of writing).</p>
<img alt="_images/mvc5.png" src="_images/mvc5.png" />
<p>The Create View uses the Create template and again includes the script library references,
which you should modify in the same way as you did for the Edit view.</p>
<img alt="_images/mvc6.png" src="_images/mvc6.png" />
<p>The Delete view uses the Delete template:</p>
<img alt="_images/mvc6a.png" src="_images/mvc6a.png" />
<p>Adding strongly typed views in this way pre-populates the HTML with tables, forms and text
where needed to display information and gather data from the user.</p>
<img alt="_images/mvc7.png" src="_images/mvc7.png" />
</div>
<div class="section" id="review-site">
<h5>Review Site<a class="headerlink" href="#review-site" title="Permalink to this headline">¶</a></h5>
<p>We have now implemented all of the code we need to write within our Controller and Views to
implement the Dinner listing and Dinner creation functionality within our web application.
Running the web application for the first time should display a home page with an empty list
of dinners:</p>
<img alt="_images/mvc8.png" src="_images/mvc8.png" />
<p>Clicking on the Create New link takes you to the form for entering the details for a new
dinner. Note that this form supports some basic validation through the annotation attributes
we added to the model. For example the name of the dinner host is required:</p>
<img alt="_images/mvc9.png" src="_images/mvc9.png" />
<p>Once a dinner is created it shows up in the list on the home page from where you can view
details, edit or delete the dinner:</p>
<img alt="_images/mvc11.png" src="_images/mvc11.png" />
<p>However, we still have no way of registering attendees! To do that we need to add another
action that will allow us to create an RSVP and attach it to a dinner.</p>
</div>
<div class="section" id="create-the-addattendee-action">
<h5>Create the AddAttendee Action<a class="headerlink" href="#create-the-addattendee-action" title="Permalink to this headline">¶</a></h5>
<p>Like the Create, Edit and Delete actions, AddAttendee will be an action with two parts to it.
The first part of the action, invoked by an HTTP GET (a normal link) will display a form in
which the user can enter the email address they want to use for the RSVP. The second part of
the action will handle the HTTP POST generated by that form when the user submits it - this
part will use the details in the form to create a new RSVP entity and connect it to the
correct event. The action will be created in the Home controller, so new methods will be added
to HomeController.cs.</p>
<p>This is the code for the first part of AddAttendee action - it is a similar pattern that we
have seen else where. We retrieve the dinner entity by its ID and pass it through to the view
so we can show the user some details about the dinner they have chosen to attend:</p>
<div class="highlight-python"><pre>public ActionResult AddAttendee(string id)
{
    var dinner = _nerdDinners.Dinners.FirstOrDefault(x =&gt; x.Id.Equals(id));
    ViewBag.Dinner = dinner;
    return dinner == null ? View("404") : View();
}</pre>
</div>
<p>The view invoked by this action needs to be added to the Views/Home folder as
AddAttendee.cshtml. Create a new view, named AddAttendee and strongly typed using the IDinner
type but choose the Empty scaffold &nbsp;and check &#8220;Create as partial view&#8221; and then edit the
.cshtml file like this:</p>
<div class="highlight-python"><pre>@model BrightstarDB.Samples.NerdDinner.Models.IRSVP

&lt;h3&gt;Join A Dinner&lt;/h3&gt;
&lt;p&gt;To join the dinner @ViewBag.Dinner.Title on @ViewBag.Dinner.EventDate.ToLongDateString(),
   enter your email address below and click RSVP.&lt;/p&gt;

@using(@Html.BeginForm("AddAttendee", "Home")) {
    @Html.ValidationSummary(true)
    @Html.Hidden("DinnerId", ViewBag.Dinner.Id as string)
    &lt;div class="editor-label"&gt;@Html.LabelFor(m=&gt;m.AttendeeEmail)&lt;/div&gt;
    &lt;div class="editor-field"&gt;
        @Html.EditorFor(m=&gt;m.AttendeeEmail)
        @Html.ValidationMessageFor(m=&gt;m.AttendeeEmail)
    &lt;/div&gt;
    &lt;p&gt;&lt;input type="submit" value="Register"/&gt;&lt;/p&gt;
}
&lt;div&gt;
    @Html.ActionLink("Back To List", "Index")
&lt;/div&gt;</pre>
</div>
<p>Note the use of a hidden field in the form that carries the Dinner ID so that when we handle
the POST we know which dinner to connect the response to.</p>
<p>This is the code to handle the second part of the action:</p>
<div class="highlight-python"><pre>[HttpPost]
public ActionResult AddAttendee(FormCollection form)
{
    if (ModelState.IsValid)
    {
        var rsvpDinnerId = form["DinnerId"];
        var dinner = _nerdDinners.Dinners.FirstOrDefault(d =&gt; d.Id.Equals(rsvpDinnerId));
        if (dinner != null)
        {
            var rsvp= new RSVP{AttendeeEmail = form["AttendeeEmail"], Dinner = dinner};
            _nerdDinners.RSVPs.Add(rsvp);
            _nerdDinners.SaveChanges();
            return RedirectToAction("Details", new {id = rsvp.Dinner.Id});
        }
    }
    return View();
}</pre>
</div>
<p>Here we do not use the MVC framework to data-bind the form values to an RSVP object because it
will attempt to put the ID from the URL (which is the dinner ID) into the Id field of the
RSVP, which is not what we want. Instead we just get the FormCollection to allow us to
retrieve the form values. The code retrieves the DinnerId from the form and uses that to get
the IDinner entity from BrightstarDB. A new RSVP entity is then created using the
AttendeeEmail value from the form and the dinner entity just found. The RSVP is then added to
the BrightstarDB RSVPs collection and SaveChanges() is called to persist it. Finally the user
is returned to the details page for the dinner.</p>
<p>Next, we modify the Details view so that it shows all attendees of a dinner. This is the
updated CSHTML for the Details view:</p>
<div class="highlight-python"><pre>@model BrightstarDB.Samples.NerdDinner.Models.IDinner

&lt;fieldset&gt;
    &lt;legend&gt;IDinner&lt;/legend&gt;

    &lt;div class="display-label"&gt;
         @Html.DisplayNameFor(model =&gt; model.Title)
    &lt;/div&gt;
    &lt;div class="display-field"&gt;
        @Html.DisplayFor(model =&gt; model.Title)
    &lt;/div&gt;

    &lt;div class="display-label"&gt;
         @Html.DisplayNameFor(model =&gt; model.Description)
    &lt;/div&gt;
    &lt;div class="display-field"&gt;
        @Html.DisplayFor(model =&gt; model.Description)
    &lt;/div&gt;

    &lt;div class="display-label"&gt;
         @Html.DisplayNameFor(model =&gt; model.EventDate)
    &lt;/div&gt;
    &lt;div class="display-field"&gt;
        @Html.DisplayFor(model =&gt; model.EventDate)
    &lt;/div&gt;

    &lt;div class="display-label"&gt;
         @Html.DisplayNameFor(model =&gt; model.Address)
    &lt;/div&gt;
    &lt;div class="display-field"&gt;
        @Html.DisplayFor(model =&gt; model.Address)
    &lt;/div&gt;

    &lt;div class="display-label"&gt;
         @Html.DisplayNameFor(model =&gt; model.HostedBy)
    &lt;/div&gt;
    &lt;div class="display-field"&gt;
        @Html.DisplayFor(model =&gt; model.HostedBy)
    &lt;/div&gt;

    &lt;div class="display-label"&gt;
        @Html.DisplayNameFor(model=&gt;model.RSVPs)
    &lt;/div&gt;
    &lt;div class="display-field"&gt;
        @if (Model.RSVPs != null)
        {
            &lt;ul&gt;
                @foreach (var r in Model.RSVPs)
                {
                    &lt;li&gt;@r.AttendeeEmail&lt;/li&gt;
                }
            &lt;/ul&gt;
        }
    &lt;/div&gt;
&lt;/fieldset&gt;
&lt;p&gt;
    @Html.ActionLink("Edit", "Edit", new { id=Model.Id }) |
    @Html.ActionLink("Back to List", "Index")
&lt;/p&gt;</pre>
</div>
<p>Finally we modify the Index view to add an Add Attendee action link to each row in the table.
This is the updated CSHTML for the Index view:</p>
<div class="highlight-python"><pre>@model IEnumerable&lt;BrightstarDB.Samples.NerdDinner.Models.IDinner&gt;

&lt;p&gt;
    @Html.ActionLink("Create New", "Create")
&lt;/p&gt;
&lt;table&gt;
    &lt;tr&gt;
        &lt;th&gt;
            @Html.DisplayNameFor(model =&gt; model.Title)
        &lt;/th&gt;
        &lt;th&gt;
            @Html.DisplayNameFor(model =&gt; model.Description)
        &lt;/th&gt;
        &lt;th&gt;
            @Html.DisplayNameFor(model =&gt; model.EventDate)
        &lt;/th&gt;
        &lt;th&gt;
            @Html.DisplayNameFor(model =&gt; model.Address)
        &lt;/th&gt;
        &lt;th&gt;
            @Html.DisplayNameFor(model =&gt; model.HostedBy)
        &lt;/th&gt;
        &lt;th&gt;&lt;/th&gt;
    &lt;/tr&gt;

@foreach (var item in Model) {
    &lt;tr&gt;
        &lt;td&gt;
            @Html.DisplayFor(modelItem =&gt; item.Title)
        &lt;/td&gt;
        &lt;td&gt;
            @Html.DisplayFor(modelItem =&gt; item.Description)
        &lt;/td&gt;
        &lt;td&gt;
            @Html.DisplayFor(modelItem =&gt; item.EventDate)
        &lt;/td&gt;
        &lt;td&gt;
            @Html.DisplayFor(modelItem =&gt; item.Address)
        &lt;/td&gt;
        &lt;td&gt;
            @Html.DisplayFor(modelItem =&gt; item.HostedBy)
        &lt;/td&gt;
        &lt;td&gt;
            @Html.ActionLink("Add Attendee", "AddAttendee", new { id=item.Id }) |
            @Html.ActionLink("Edit", "Edit", new { id=item.Id }) |
            @Html.ActionLink("Details", "Details", new { id=item.Id }) |
            @Html.ActionLink("Delete", "Delete", new { id=item.Id })
        &lt;/td&gt;
    &lt;/tr&gt;
}

&lt;/table&gt;</pre>
</div>
<p>Now we can use the Add Attendee link on the home page to register attendance at an event:</p>
<img alt="_images/mvc12.png" src="_images/mvc12.png" />
<p>And we can then see this registration on the event details page:</p>
<img alt="_images/mvc13.png" src="_images/mvc13.png" />
</div>
</div>
<div class="section" id="applying-model-changes">
<span id="id16"></span><h4>Applying Model Changes<a class="headerlink" href="#applying-model-changes" title="Permalink to this headline">¶</a></h4>
<p>Change during development happens and many times, changes impact the persistent data model.
Fortunately it is easy to modify the persistent data model with BrightstarDB.</p>
<p>As an example we are going to add the requirement for dinners to have a specific City field
(perhaps to allow grouping of dinners by the city the occur in for example).</p>
<p>The first step is to modify the IDinner interface to add a City property:</p>
<div class="highlight-python"><pre>[Entity]
public interface IDinner
{
    [Identifer("http://nerddinner.com/dinners#")]
    string Id { get; }
    string Title { get; set; }
    string Description { get; set; }
    DateTime EventDate { get; set; }
    string Address { get; set; }
    string City { get; set; }
    string HostedBy { get; set; }
    ICollection&lt;IRSVP&gt; RSVPs { get; set; }
}</pre>
</div>
<p>Because this change modifies an entity interface, we need to ensure that the generated context
classes are also updated. To update the context, right click on the NerdDinnerContext.tt and
select “Run Custom Tool”</p>
<p>That is all that needs to be done from a BrightstarDB point of view! The City property is now
assignable on all new and existing Dinner entities and you can write LINQ queries that make
use of the City property. Of course, there are still a couple of things that need to change in
our web interface. Open the Index, Create, Delete, Details and Edit views to add the new City
property to the HTML so that you will be able to view and amend its data - the existing HTML
in each of these views should provide you with the examples you need.</p>
<p>Note that if you create a new dinner, you will be required to enter a City, but existing
dinners will not have a city assigned:</p>
<img alt="_images/mvc14.png" src="_images/mvc14.png" />
<p>If you use a query to find or group dinners by their city, those dinners that have no value
for the city will not be returned by the query, and of course if you try to edit one of those
dinners, then you will be required to provide a value for the City field.</p>
</div>
<div class="section" id="adding-a-custom-membership-provider">
<span id="adding-a-custom-membership-pro"></span><h4>Adding a Custom Membership Provider<a class="headerlink" href="#adding-a-custom-membership-provider" title="Permalink to this headline">¶</a></h4>
<p>Custom Membership Providers are a quick and straightforward way of managing membership
information when you wish to store that membership data in a data source that is not supported
by the membership providers included within the .NET framework. Often developers will need to
implement custom membership providers even when storing the data in a supported data source,
because the schema of that membership information differs from that in the default providers.</p>
<p>In this topic we are going to add a Custom Membership Provider to the Nerd Dinner sample so
that users can register and login.</p>
<div class="section" id="adding-the-custom-membership-provider-and-login-entity">
<h5>Adding the Custom Membership Provider and login Entity<a class="headerlink" href="#adding-the-custom-membership-provider-and-login-entity" title="Permalink to this headline">¶</a></h5>
<blockquote>
<div><ol class="arabic simple">
<li>Add a new class to your project and name it BrightstarMembershipProvider.cs</li>
<li>Make the class extend System.Web.Security.MembershipProvider. This is the abstract class
that all ASP.NET membership providers must inherit from.</li>
<li>Right click on the MembershipProvider class name and choose “Implement abstract class”
from the context menu, this automatically creates all the override methods that your custom
class can implement.</li>
<li>Add a new interface to the Models directory and name it INerdDinnerLogin.cs</li>
<li>Add the [Entity] attribute to the interface, and add the properties shown below:</li>
<li>The Id property is decorated with the Identifier attribute to allow us to work with
simpler string values rather than the full URI that is generated by BrightstarDB (for more
information, please read the Entity Framework Documentation).</li>
</ol>
</div></blockquote>
<div class="highlight-python"><pre>[Entity]
public interface INerdDinnerLogin
{
   [Identifier("http://nerddinner.com/logins/")]
   string Id { get; }
   string Username { get; set; }
   string Password { get; set; }
   string PasswordSalt { get; set; }
   string Email { get; set; }
   string Comments { get; set; }
   DateTime CreatedDate { get; set; }
   DateTime LastActive { get; set; }
   DateTime LastLoginDate { get; set; }
   bool IsActivated { get; set; }
   bool IsLockedOut { get; set; }
   DateTime LastLockedOutDate { get; set; }
   string LastLockedOutReason { get; set; }
   int? LoginAttempts { get; set; }
}</pre>
</div>
<p>To update the Brightstar Entity Context, right click on the NerdDinnerContext.tt file and
select “Run Custom Tool” from the context menu.</p>
</div>
<div class="section" id="configuring-the-application-to-use-the-brightstar-membership-provider">
<h5>Configuring the application to use the Brightstar Membership Provider<a class="headerlink" href="#configuring-the-application-to-use-the-brightstar-membership-provider" title="Permalink to this headline">¶</a></h5>
<p>To configure your web application to use this custom Membership Provider, we simply need to
change the configuration values in the Web.config file in the root directory of the
application. Change the membership node contained within the &lt;system.web&gt; to the snippet below:</p>
<dl class="docutils">
<dt>&nbsp; &lt;membership defaultProvider=&#8221;BrightstarMembershipProvider&#8221;&gt;</dt>
<dd><blockquote class="first">
<div><dl class="docutils">
<dt>&lt;providers&gt;</dt>
<dd><p class="first">&lt;clear/&gt;
&lt;add name=&#8221;BrightstarMembershipProvider&#8221;</p>
<blockquote class="last">
<div><dl class="docutils">
<dt>type=&#8221;BrightstarDB.Samples.NerdDinner.BrightstarMembershipProvider,</dt>
<dd><dl class="first last docutils">
<dt>BrightStarDB.Samples.NerdDinner&#8221;</dt>
<dd>enablePasswordReset=&#8221;true&#8221;</dd>
</dl>
</dd>
<dt>maxInvalidPasswordAttempts=&#8221;5&#8221;</dt>
<dd>minRequiredPasswordLength=&#8221;6&#8221;</dd>
<dt>minRequiredNonalphanumericCharacters=&#8221;0&#8221;</dt>
<dd>passwordAttemptWindow=&#8221;10&#8221;
applicationName=&#8221;/&#8221; /&gt;</dd>
</dl>
</div></blockquote>
</dd>
</dl>
<p>&lt;/providers&gt;</p>
</div></blockquote>
<p class="last">&lt;/membership&gt;</p>
</dd>
</dl>
<p>Note that if the name of your project is not BrightstarDB.Samples.NerdDinner, you will have to
change the type=&#8221;&#8221; attribute to the correct full type reference.</p>
<p>We must also change the authentication method for the web application to Forms authentication.
This is done by adding the following inside the &lt;system.web&gt; section of the Web.config file:</p>
<div class="highlight-python"><pre>&lt;authentication mode="Forms"/&gt;</pre>
</div>
<p>If after making these changes you see an error message like this in the browser:</p>
<div class="highlight-python"><pre>Parser Error Message: It is an error to use a section registered as
allowDefinition='MachineToApplication' beyond application level.  This error can be caused by
a virtual directory not being configured as an application in IIS.</pre>
</div>
<p>The most likely problem is that you have added the &lt;membership&gt; and &lt;authentication&gt; tags into
the Web.config file contained in the Views folder. These configuration elements must ONLY go
in the Web.config file located in the project&#8217;s root directory.</p>
</div>
<div class="section" id="adding-functionality-to-the-custom-membership-provider">
<h5>Adding functionality to the Custom Membership Provider<a class="headerlink" href="#adding-functionality-to-the-custom-membership-provider" title="Permalink to this headline">¶</a></h5>
<div class="admonition note">
<p class="first admonition-title">Note</p>
<p class="last">For the purpose of keeping this example simple, we will leave some of these methods to throw</p>
</div>
<p>NotImplementedException, but you can add in whatever logic suits your business requirements
once you have the basic functionality up and running.</p>
<p>The full code for the BrightstarMembershipProvider.cs is given below, but can be broken down
as follows:</p>
<p><strong>Initialization</strong></p>
<p>We add an Initialize() method along with a GetConfigValue() helper method to handle retrieving
the configuration values from Web.config, and setting default values if it is unable to
retrieve a value.</p>
<p><strong>Private helper methods</strong></p>
<p>We add three more helper methods: CreateSalt() and CreatePasswordHash() to help us with user
passwords, and ConvertLoginToMembershipUser() to return a built in .NET MembershipUser object
when given the BrightstarDB INerdDinnerLogin entity.</p>
<p><strong>CreateUser()</strong></p>
<p>The CreateUser() method is used when a user registers on our site, the first part of this code
validates based on the configuration settings (such as whether an email must be unique) and
then creates a NerdDinnerLogin entity, adds it to the NerdDinnerContext and saves the changes
to the BrightstarDB store.</p>
<p><strong>GetUser()</strong></p>
<p>The GetUser() method simply looks up a login in the BrightstarDB store, and returns a .NET
MembershipUser object with the help of the ConvertLoginToMembershipUser() method mentioned
above.</p>
<p><strong>GetUserNameByEmail()</strong></p>
<p>The GetUserNameByEmail() method is similar to the GetUser() method but looks up by email
rather than username. It’s used by the CreateUser() method if the configuration settings
specify that new users must have unique emails.</p>
<p><strong>ValidateUser()</strong></p>
<p>The ValidateUser() method is used when a user logs in to our web application. The login is
looked up in the BrightstarDB store by username, and then the password is checked. If the
checks pass successfully then it returns a true value which enables the user to successfully
login.</p>
<div class="highlight-python"><pre>using System;
using System.Collections.Specialized;
using System.Linq;
using System.Security.Cryptography;
using System.Web.Security;
using BrightstarDB.Samples.NerdDinner.Models;


namespace BrightstarDB.Samples.NerdDinner
{
    public class BrightstarMembershipProvider : MembershipProvider
    {


        #region Configuration and Initialization


        private string _applicationName;
        private const bool _requiresUniqueEmail = true;
        private int _maxInvalidPasswordAttempts;
        private int _passwordAttemptWindow;
        private int _minRequiredPasswordLength;
        private int _minRequiredNonalphanumericCharacters;
        private bool _enablePasswordReset;
        private string _passwordStrengthRegularExpression;
        private MembershipPasswordFormat _passwordFormat = MembershipPasswordFormat.Hashed;


        private string GetConfigValue(string configValue, string defaultValue)
        {
            if (string.IsNullOrEmpty(configValue))
                return defaultValue;


            return configValue;
        }


        public override void Initialize(string name, NameValueCollection config)
        {
            if (config == null) throw new ArgumentNullException("config");


            if (string.IsNullOrEmpty(name)) name = "BrightstarMembershipProvider";


            if (String.IsNullOrEmpty(config["description"]))
            {
                config.Remove("description");
                config.Add("description", "BrightstarDB Membership Provider");
            }


            base.Initialize(name, config);


            _applicationName = GetConfigValue(config["applicationName"],
                          System.Web.Hosting.HostingEnvironment.ApplicationVirtualPath);
            _maxInvalidPasswordAttempts = Convert.ToInt32(
                          GetConfigValue(config["maxInvalidPasswordAttempts"], "10"));
            _passwordAttemptWindow = Convert.ToInt32(
                          GetConfigValue(config["passwordAttemptWindow"], "10"));
            _minRequiredNonalphanumericCharacters = Convert.ToInt32(
                          GetConfigValue(config["minRequiredNonalphanumericCharacters"],</pre>
</div>
<dl class="docutils">
<dt>&#8220;1&#8221;));</dt>
<dd><blockquote class="first">
<div><dl class="docutils">
<dt>_minRequiredPasswordLength = Convert.ToInt32(</dt>
<dd>GetConfigValue(config[&#8220;minRequiredPasswordLength&#8221;], &#8220;6&#8221;));</dd>
<dt>_enablePasswordReset = Convert.ToBoolean(</dt>
<dd>GetConfigValue(config[&#8220;enablePasswordReset&#8221;], &#8220;true&#8221;));</dd>
<dt>_passwordStrengthRegularExpression = Convert.ToString(</dt>
<dd>GetConfigValue(config[&#8220;passwordStrengthRegularExpression&#8221;], &#8220;&#8221;));</dd>
</dl>
</div></blockquote>
<p>}</p>
<p>#endregion</p>
<p>#region Properties</p>
<p>public override string ApplicationName
{</p>
<blockquote>
<div>get { return _applicationName; }
set { _applicationName = value; }</div></blockquote>
<p>}</p>
<p>public override int MaxInvalidPasswordAttempts
{</p>
<blockquote>
<div>get { return _maxInvalidPasswordAttempts; }</div></blockquote>
<p>}</p>
<p>public override int MinRequiredNonAlphanumericCharacters
{</p>
<blockquote>
<div>get { return _minRequiredNonalphanumericCharacters; }</div></blockquote>
<p>}</p>
<p>public override int MinRequiredPasswordLength
{</p>
<blockquote>
<div>get { return _minRequiredPasswordLength; }</div></blockquote>
<p>}</p>
<p>public override int PasswordAttemptWindow
{</p>
<blockquote>
<div>get { return _passwordAttemptWindow; }</div></blockquote>
<p>}</p>
<p>public override MembershipPasswordFormat PasswordFormat
{</p>
<blockquote>
<div>get { return _passwordFormat; }</div></blockquote>
<p>}</p>
<p>public override string PasswordStrengthRegularExpression
{</p>
<blockquote>
<div>get { return _passwordStrengthRegularExpression; }</div></blockquote>
<p>}</p>
<p>public override bool RequiresUniqueEmail
{</p>
<blockquote>
<div>get { return _requiresUniqueEmail; }</div></blockquote>
<p>}
#endregion</p>
<p>#region Private Methods</p>
<p>private static string CreateSalt()
{</p>
<blockquote>
<div>var rng = new RNGCryptoServiceProvider();
var buffer = new byte[32];
rng.GetBytes(buffer);
return Convert.ToBase64String(buffer);</div></blockquote>
<p>}</p>
<p>private static string CreatePasswordHash(string password, string salt)
{</p>
<blockquote>
<div>var snp = string.Concat(password, salt);
var hashed = FormsAuthentication.HashPasswordForStoringInConfigFile(snp, &#8220;sha1&#8221;);
return hashed;</div></blockquote>
<p>}</p>
<p class="last">/// &lt;summary&gt;
/// This helper method returns a .NET MembershipUser object generated from the</p>
</dd>
<dt>supplied BrightstarDB entity</dt>
<dd><p class="first">/// &lt;/summary&gt;
private static MembershipUser ConvertLoginToMembershipUser(INerdDinnerLogin login)
{</p>
<blockquote>
<div><p>if (login == null) return null;
var user = new MembershipUser(&#8220;BrightstarMembershipProvider&#8221;,</p>
<blockquote>
<div>login.Username, login.Id, login.Email,
&#8220;&#8221;, &#8220;&#8221;, login.IsActivated, login.IsLockedOut,
login.CreatedDate, login.LastLoginDate,
login.LastActive, DateTime.UtcNow, login.LastLockedOutDate);</div></blockquote>
<p>return user;</p>
</div></blockquote>
<p>}</p>
<p>#endregion</p>
<p class="last">public override MembershipUser CreateUser(string username, string password, string</p>
</dd>
</dl>
<p>email, string passwordQuestion, string passwordAnswer, bool isApproved, object
providerUserKey, out MembershipCreateStatus status)</p>
<blockquote>
<div><dl class="docutils">
<dt>{</dt>
<dd><p class="first">var args = new ValidatePasswordEventArgs(email, password, true);</p>
<p>OnValidatingPassword(args);</p>
<p>if (args.Cancel)
{</p>
<blockquote>
<div>status = MembershipCreateStatus.InvalidPassword;
return null;</div></blockquote>
<p>}</p>
<p>if (string.IsNullOrEmpty(email))
{</p>
<blockquote>
<div>status = MembershipCreateStatus.InvalidEmail;
return null;</div></blockquote>
<p>}</p>
<p>if (string.IsNullOrEmpty(password))
{</p>
<blockquote>
<div>status = MembershipCreateStatus.InvalidPassword;
return null;</div></blockquote>
<p>}</p>
<p>if (RequiresUniqueEmail &amp;&amp; GetUserNameByEmail(email) != &#8220;&#8221;)
{</p>
<blockquote>
<div>status = MembershipCreateStatus.DuplicateEmail;
return null;</div></blockquote>
<p>}</p>
<p>var u = GetUser(username, false);</p>
<p>try
{</p>
<blockquote>
<div><p>if (u == null)
{</p>
<blockquote>
<div><p>var salt = CreateSalt();</p>
<p>//Create a new NerdDinnerLogin entity and set the properties
var login = new NerdDinnerLogin
{</p>
<blockquote>
<div>Username = username,
Email = email,
PasswordSalt = salt,
Password = CreatePasswordHash(password, salt),
CreatedDate = DateTime.UtcNow,
IsActivated = true,
IsLockedOut = false,
LastLockedOutDate = DateTime.UtcNow,
LastLoginDate = DateTime.UtcNow,
LastActive = DateTime.UtcNow</div></blockquote>
<p>};
//Create a context using the connection string in the Web.Config
var context = new NerdDinnerContext();
//Add the entity to the context
context.NerdDinnerLogins.Add(login);
//Save the changes to the BrightstarDB store
context.SaveChanges();</p>
<p>status = MembershipCreateStatus.Success;
return GetUser(username, true /<em>online</em>/);</p>
</div></blockquote>
<p>}</p>
</div></blockquote>
<p>}
catch (Exception)
{</p>
<blockquote>
<div>status = MembershipCreateStatus.ProviderError;
return null;</div></blockquote>
<p>}</p>
<p class="last">status = MembershipCreateStatus.DuplicateUserName;
return null;</p>
</dd>
</dl>
<p>}</p>
<p>public override MembershipUser GetUser(string username, bool userIsOnline)
{</p>
<blockquote>
<div>if (string.IsNullOrEmpty(username)) return null;
//Create a context using the connection string in Web.config
var context = new NerdDinnerContext();
//Query the store for a NerdDinnerLogin that matches the supplied username
var login = context.NerdDinnerLogins.Where(l =&gt;</div></blockquote>
</div></blockquote>
<dl class="docutils">
<dt>l.Username.Equals(username)).FirstOrDefault();</dt>
<dd><p class="first">if (login == null) return null;
if(userIsOnline)
{</p>
<blockquote class="last">
<div>//if the call states that the user is online, update the LastActive property</div></blockquote>
</dd>
<dt>of the NerdDinnerLogin</dt>
<dd><blockquote class="first">
<div><blockquote>
<div>login.LastActive = DateTime.UtcNow;
context.SaveChanges();</div></blockquote>
<p>}
return ConvertLoginToMembershipUser(login);</p>
</div></blockquote>
<p>}</p>
<p>public override string GetUserNameByEmail(string email)
{</p>
<blockquote class="last">
<div>if (string.IsNullOrEmpty(email)) return &#8220;&#8221;;
//Create a context using the connection string in Web.config
var context = new NerdDinnerContext();
//Query the store for a NerdDinnerLogin that matches the supplied username
var login = context.NerdDinnerLogins.Where(l =&gt;</div></blockquote>
</dd>
<dt>l.Email.Equals(email)).FirstOrDefault();</dt>
<dd><blockquote class="first">
<div>if (login == null) return string.Empty;
return login.Username;</div></blockquote>
<p>}</p>
<p>public override bool ValidateUser(string username, string password)
{</p>
<blockquote class="last">
<div><p>//Create a context using the connection string set in Web.config
var context = new NerdDinnerContext();
//Query the store for a NerdDinnerLogin matching the supplied username
var logins = context.NerdDinnerLogins.Where(l =&gt; l.Username.Equals(username));
if (logins.Count() == 1)
{</p>
<blockquote>
<div>//Ensure that only a single login matches the supplied username
var login = logins.First();
//Check the properties on the NerdDinnerLogin to ensure the user account is</div></blockquote>
</div></blockquote>
</dd>
<dt>activate and not locked out</dt>
<dd>if (login.IsLockedOut || !login.IsActivated) return false;
//Validate the password of the NerdDinnerLogin against the supplied password
var validatePassword = login.Password == CreatePasswordHash(password,</dd>
<dt>login.PasswordSalt);</dt>
<dd><blockquote class="first">
<div><blockquote>
<div><blockquote>
<div><p>if (!validatePassword)
{</p>
<blockquote>
<div>//return validation failure
return false;</div></blockquote>
<p>}
//return validation success
return true;</p>
</div></blockquote>
<p>}
return false;</p>
</div></blockquote>
<p>}</p>
<p>#region MembershipProvider properties and methods not implemented for this tutorial</p>
</div></blockquote>
<dl class="docutils">
<dt>...</dt>
<dd><blockquote class="first">
<div>#endregion</div></blockquote>
<p class="last">}</p>
</dd>
</dl>
<p class="last">}</p>
</dd>
</dl>
</div>
<div class="section" id="extending-the-mvc-application">
<h5>Extending the MVC application<a class="headerlink" href="#extending-the-mvc-application" title="Permalink to this headline">¶</a></h5>
<p>All the models, views and controllers needed to implement the logic logic are generated
automatically when creating a new MVC4 Web Application if the option for &#8220;Internet
Application&#8221; is selected. However, if you are following this tutorial through from the
beginning you will need to add this infrastructure by hand. The infrastructure includes:</p>
<blockquote>
<div><ul class="simple">
<li>An AccountController class with ActionResult methods for logging in, logging out and</li>
</ul>
</div></blockquote>
<p>registering (in AccountController.cs in the Controllers folder).</p>
<blockquote>
<div><ul class="simple">
<li>AccountModels.cs which contains classes for LogonModel and RegisterModel (in the Models</li>
</ul>
</div></blockquote>
<p>folder).</p>
<blockquote>
<div><ul class="simple">
<li>LogOn, Register, ChangePassword and ChangePasswordSuccess views that use the models to</li>
</ul>
</div></blockquote>
<p>display form fields and validate input from the user (in the Views/Account folder).</p>
<blockquote>
<div><ul class="simple">
<li>A _LogOnPartial view that is used in the main _Layout view to display a login link, or the</li>
</ul>
</div></blockquote>
<p>username if the user is logged in (in the Views/Shared folder).</p>
<div class="admonition note">
<p class="first admonition-title">Note</p>
<p class="last">These files can be found in [INSTALLDIR]\Samples\NerdDinner\BrightstarDB.Samples.NerdDinner</p>
</div>
<p>The details of the contents of these files is beyond the scope of this tutorial, however the
infrastructure is all designed to work with the configured Membership Provider for the web
application - in our case the BrightstarMembershipProvider class we have just created.</p>
<p>The AccountController created here has some dependencies on the Custom Role Provider discussed
in the next section. You will need to complete the steps in the next section before you will
be able to successfully register a user in the web application.</p>
<p><strong>Summary</strong></p>
<p>In this tutorial we have walked through some simple steps to use a Custom Membership Provider
to allow BrightstarDB to handle the authentication of users on your MVC3 Web Application.</p>
<p>For simplicity, we have kept the same structure of membership information as we would find in
a default provider, but you can expand on this sample to include extra membership information
by simply adding more properties to the BrightstarDB entity.</p>
</div>
</div>
<div class="section" id="adding-a-custom-role-provider">
<span id="id17"></span><h4>Adding a Custom Role Provider<a class="headerlink" href="#adding-a-custom-role-provider" title="Permalink to this headline">¶</a></h4>
<p>As with Custom Membership Providers, Custom Role Providers allow developers to use role
management within application when either the role information is stored in a data source
other than that supported by the default providers, or the role information is managed in a
schema which differs from that set out in the default providers.</p>
<p>In this topic we are going to add a Custom Role Provider to the Nerd Dinner sample so that we
can restrict certain areas from users who are not members of the appropriate role.</p>
<div class="section" id="adding-the-custom-role-provider">
<h5>Adding the Custom Role Provider<a class="headerlink" href="#adding-the-custom-role-provider" title="Permalink to this headline">¶</a></h5>
<blockquote>
<div><ol class="arabic simple">
<li>Add the following line to the INerdDinnerLogin interface&#8217;s</li>
</ol>
</div></blockquote>
<p>properties``ICollection&lt;string&gt; Roles { get; set; } <a href="#id18"><span class="problematic" id="id19">``</span></a>To update the context classes, right
click on the NerdDinnerContext.tt file and select “Run Custom Tool” from the context menu.</p>
<blockquote>
<div><ol class="arabic simple">
<li>Add a new class to your project and name it BrightstarRoleProvider.cs</li>
<li>Make this new class inherit from the RoleProvider class (System.Web.Security namespace)</li>
</ol>
<ol class="arabic simple">
<li>Right click on the RoleProvider class name and choose &#8220;Implement abstract class&#8221; from the</li>
</ol>
</div></blockquote>
<p>context menu, this automatically creates all the override methods that your custom class can
implement.</p>
</div>
<div class="section" id="id20">
<h5>Configuring the application to use the Brightstar Membership Provider<a class="headerlink" href="#id20" title="Permalink to this headline">¶</a></h5>
<p>To configure your web application to use the Custom Role Provider, add the following to your
Web.config, inside the &lt;system.web&gt; section:</p>
<p>&lt;roleManager &nbsp;enabled=&#8221;true&#8221; defaultProvider=&#8221;BrightstarRoleProvider&#8221;&gt;</p>
<blockquote>
<div>&lt;providers&gt;</div></blockquote>
<p>&lt;clear/&gt;</p>
<p>&lt;add name=&#8221;BrightstarRoleProvider&#8221;
type=&#8221;BrightstarDB.Samples.NerdDinner.BrightstarRoleProvider&#8221; applicationName=&#8221;/&#8221; /&gt;</p>
<blockquote>
<div>&lt;/providers&gt;</div></blockquote>
<p>&lt;/roleManager&gt;</p>
<p>To set up the default login path for the web application, replace the &lt;authentication&gt; element
in the Web.config file with the following:</p>
<p>&lt;authentication mode=&#8221;Forms&#8221;&gt;</p>
<blockquote>
<div>&lt;forms loginUrl=&#8221;/Account/LogOn&#8221;/&gt;</div></blockquote>
<p>&lt;/authentication&gt;</p>
</div>
<div class="section" id="adding-functionality-to-the-custom-role-provider">
<h5>Adding functionality to the Custom Role Provider<a class="headerlink" href="#adding-functionality-to-the-custom-role-provider" title="Permalink to this headline">¶</a></h5>
<p>The full code for the BrightstarRoleProvider.cs is given below, but can be broken down as
follows:</p>
<p><strong>Initialization</strong></p>
<p>We add an Initialize() method along with a GetConfigValue() helper method to handle retrieving
the configuration values from Web.config, and setting default values if it is unable to
retrieve a value.</p>
<p><strong>GetRolesForUser()</strong></p>
<p>This method returns the contents of the Roles collection that we added to the INerdDinnerLogin
entity as a string array.</p>
<p><strong>AddUsersToRoles()</strong></p>
<p>AddUsersToRoles() loops through the usernames and role names supplied, and looks up the logins
from the BrightstarDB store. When found, the role names are added to the Roles collection for
that login.</p>
<p><strong>RemoveUsersFromRoles()</strong></p>
<p>RemoveUsersFromRoles() loops through the usernames and role names supplied, and looks up the
logins from the BrightstarDB store. When found, the role names are removed from the Roles
collection for that login.</p>
<p><strong>IsUserInRole()</strong></p>
<p>The BrightstarDB store is searched for the login who matches the supplied username, and then a
true or false is passed back depending on whether the role name was found in that login&#8217;s Role
collection. If the login is inactive or locked out for any reason, then a false value is
passed back.</p>
<p><strong>GetUsersInRole()</strong></p>
<p>BrightstarDB is queried for all logins that contain the supplied role name in their Roles
collection.</p>
<div class="highlight-python"><pre>using System;
using System.Collections.Generic;
using System.Linq;
using System.Web;
using System.Web.Security;
using BrightstarDB.Samples.NerdDinner.Models;


namespace BrightstarDB.Samples.NerdDinner
{
    public class BrightstarRoleProvider : RoleProvider
    {
        #region Initialization

        private string _applicationName;


        private static string GetConfigValue(string configValue, string defaultValue)
        {
            if (string.IsNullOrEmpty(configValue))
                return defaultValue;


            return configValue;
        }


        public override void Initialize(string name,</pre>
</div>
<dl class="docutils">
<dt>System.Collections.Specialized.NameValueCollection config)</dt>
<dd><dl class="first docutils">
<dt>{</dt>
<dd><p class="first">if (config == null) throw new ArgumentNullException(&#8220;config&#8221;);</p>
<p>if (string.IsNullOrEmpty(name)) name = &#8220;NerdDinnerRoleProvider&#8221;;</p>
<p>if (String.IsNullOrEmpty(config[&#8220;description&#8221;]))
{</p>
<blockquote>
<div>config.Remove(&#8220;description&#8221;);
config.Add(&#8220;description&#8221;, &#8220;Nerd Dinner Membership Provider&#8221;);</div></blockquote>
<p>}
base.Initialize(name, config);
_applicationName = GetConfigValue(config[&#8220;applicationName&#8221;],</p>
<blockquote class="last">
<div>System.Web.Hosting.HostingEnvironment.ApplicationVirtualPath);</div></blockquote>
</dd>
</dl>
<p>}</p>
<p>#endregion</p>
<p class="last">/// &lt;summary&gt;
/// Gets a list of the roles that a specified user is in for the configured</p>
</dd>
<dt>applicationName.</dt>
<dd>/// &lt;/summary&gt;
/// &lt;returns&gt;
/// A string array containing the names of all the roles that the specified user is</dd>
<dt>in for the configured applicationName.</dt>
<dd><p class="first">/// &lt;/returns&gt;
/// &lt;param name=&#8221;username&#8221;&gt;The user to return a list of roles for.&lt;/param&gt;
public override string[] GetRolesForUser(string username)
{</p>
<blockquote class="last">
<div>if (string.IsNullOrEmpty(username)) throw new ArgumentNullException(&#8220;username&#8221;);
//create a new BrightstarDB context using the values in Web.config
var context = new NerdDinnerContext();
//find a match for the username
var login = context.NerdDinnerLogins.Where(l =&gt;</div></blockquote>
</dd>
<dt>l.Username.Equals(username)).FirstOrDefault();</dt>
<dd><blockquote class="first">
<div>if (login == null) return null;
//return the Roles collection
return login.Roles.ToArray();</div></blockquote>
<p>}</p>
<p class="last">/// &lt;summary&gt;
/// Adds the specified user names to the specified roles for the configured</p>
</dd>
<dt>applicationName.</dt>
<dd>/// &lt;/summary&gt;
/// &lt;param name=&#8221;usernames&#8221;&gt;A string array of user names to be added to the</dd>
</dl>
<p>specified roles. &lt;/param&gt;&lt;param name=&#8221;roleNames&#8221;&gt;A string array of the role names to add
the specified user names to.&lt;/param&gt;</p>
<blockquote>
<div><p>public override void AddUsersToRoles(string[] usernames, string[] roleNames)
{</p>
<blockquote>
<div><p>//create a new BrightstarDB context using the values in Web.config
var context = new NerdDinnerContext();
foreach (var username in usernames)
{</p>
<blockquote>
<div>//find the match for the username
var login = context.NerdDinnerLogins.Where(l =&gt;</div></blockquote>
</div></blockquote>
</div></blockquote>
<dl class="docutils">
<dt>l.Username.Equals(username)).FirstOrDefault();</dt>
<dd><p class="first">if (login == null) continue;
foreach (var role in roleNames)
{</p>
<blockquote class="last">
<div>//if the Roles collection of the login does not already contain the</div></blockquote>
</dd>
<dt>role, then add it</dt>
<dd><blockquote class="first">
<div><blockquote>
<div><blockquote>
<div>if (login.Roles.Contains(role)) continue;
login.Roles.Add(role);</div></blockquote>
<p>}</p>
</div></blockquote>
<p>}
context.SaveChanges();</p>
</div></blockquote>
<p>}</p>
<p class="last">/// &lt;summary&gt;
/// Removes the specified user names from the specified roles for the configured</p>
</dd>
<dt>applicationName.</dt>
<dd>/// &lt;/summary&gt;
/// &lt;param name=&#8221;usernames&#8221;&gt;A string array of user names to be removed from the</dd>
</dl>
<p>specified roles. &lt;/param&gt;&lt;param name=&#8221;roleNames&#8221;&gt;A string array of role names to remove the
specified user names from.&lt;/param&gt;</p>
<blockquote>
<div><p>public override void RemoveUsersFromRoles(string[] usernames, string[] roleNames)
{</p>
<blockquote>
<div><p>//create a new BrightstarDB context using the values in Web.config
var context = new NerdDinnerContext();
foreach (var username in usernames)
{</p>
<blockquote>
<div>//find the match for the username
var login = context.NerdDinnerLogins.Where(l =&gt;</div></blockquote>
</div></blockquote>
</div></blockquote>
<dl class="docutils">
<dt>l.Username.Equals(username)).FirstOrDefault();</dt>
<dd><blockquote class="first">
<div><blockquote>
<div><p>if (login == null) continue;
foreach (var role in roleNames)
{</p>
<blockquote>
<div>//if the Roles collection of the login contains the role, then remove it
if (!login.Roles.Contains(role)) continue;
login.Roles.Remove(role);</div></blockquote>
<p>}</p>
</div></blockquote>
<p>}
context.SaveChanges();</p>
</div></blockquote>
<p>}</p>
<p class="last">/// &lt;summary&gt;
/// Gets a value indicating whether the specified user is in the specified role for</p>
</dd>
<dt>the configured applicationName.</dt>
<dd>/// &lt;/summary&gt;
/// &lt;returns&gt;
/// true if the specified user is in the specified role for the configured</dd>
<dt>applicationName; otherwise, false.</dt>
<dd><p class="first">/// &lt;/returns&gt;
/// &lt;param name=&#8221;username&#8221;&gt;The username to search for.&lt;/param&gt;
/// &lt;param name=&#8221;roleName&#8221;&gt;The role to search in.&lt;/param&gt;
public override bool IsUserInRole(string username, string roleName)
{</p>
<blockquote class="last">
<div><p>try
{</p>
<blockquote>
<div>//create a new BrightstarDB context using the values in Web.config
var context = new NerdDinnerContext();
//find a match for the username
var login = context.NerdDinnerLogins.Where(l =&gt;</div></blockquote>
</div></blockquote>
</dd>
<dt>l.Username.Equals(username)).FirstOrDefault();</dt>
<dd><p class="first">if (login == null || login.IsLockedOut || !login.IsActivated)
{</p>
<blockquote>
<div>// no match or inactive automatically returns false
return false;</div></blockquote>
<p class="last">}
//if the Roles collection of the login contains the role we are checking</p>
</dd>
<dt>for, return true</dt>
<dd><blockquote class="first">
<div><blockquote>
<div>return login.Roles.Contains(roleName.ToLower());</div></blockquote>
<p>}
catch (Exception)
{</p>
<blockquote>
<div>return false;</div></blockquote>
<p>}</p>
</div></blockquote>
<p>}</p>
<p class="last">/// &lt;summary&gt;
/// Gets a list of users in the specified role for the configured applicationName.
/// &lt;/summary&gt;
/// &lt;returns&gt;
/// A string array containing the names of all the users who are members of the</p>
</dd>
<dt>specified role for the configured applicationName.</dt>
<dd><p class="first">/// &lt;/returns&gt;
/// &lt;param name=&#8221;roleName&#8221;&gt;The name of the role to get the list of users for.&lt;/param&gt;
public override string[] GetUsersInRole(string roleName)
{</p>
<blockquote class="last">
<div>if (string.IsNullOrEmpty(roleName)) throw new ArgumentNullException(&#8220;roleName&#8221;);
//create a new BrightstarDB context using the values in Web.config
var context = new NerdDinnerContext();
//search for all logins who have the supplied roleName in their Roles collection
var usersInRole = context.NerdDinnerLogins.Where(l =&gt;</div></blockquote>
</dd>
<dt>l.Roles.Contains(roleName.ToLower())).Select(l =&gt; l.Username).ToList();</dt>
<dd><blockquote class="first">
<div>return usersInRole.ToArray();</div></blockquote>
<p>}</p>
<p class="last">/// &lt;summary&gt;
/// Gets a value indicating whether the specified role name already exists in the</p>
</dd>
<dt>role data source for the configured applicationName.</dt>
<dd>/// &lt;/summary&gt;
/// &lt;returns&gt;
/// true if the role name already exists in the data source for the configured</dd>
<dt>applicationName; otherwise, false.</dt>
<dd>/// &lt;/returns&gt;
/// &lt;param name=&#8221;roleName&#8221;&gt;The name of the role to search for in the data</dd>
<dt>source.&lt;/param&gt;</dt>
<dd><p class="first">public override bool RoleExists(string roleName)
{</p>
<blockquote class="last">
<div>//for the purpose of the sample the roles are hard coded
return roleName.Equals(&#8220;admin&#8221;) || roleName.Equals(&#8220;editor&#8221;) ||</div></blockquote>
</dd>
<dt>roleName.Equals(&#8220;standard&#8221;);</dt>
<dd><p class="first">}</p>
<p class="last">/// &lt;summary&gt;
/// Gets a list of all the roles for the configured applicationName.
/// &lt;/summary&gt;
/// &lt;returns&gt;
/// A string array containing the names of all the roles stored in the data source</p>
</dd>
<dt>for the configured applicationName.</dt>
<dd><p class="first">/// &lt;/returns&gt;
public override string[] GetAllRoles()
{</p>
<blockquote>
<div>//for the purpose of the sample the roles are hard coded
return new string[] { &#8220;admin&#8221;, &#8220;editor&#8221;, &#8220;standard&#8221; };</div></blockquote>
<p>}</p>
<p class="last">/// &lt;summary&gt;
/// Gets an array of user names in a role where the user name contains the specified</p>
</dd>
<dt>user name to match.</dt>
<dd>/// &lt;/summary&gt;
/// &lt;returns&gt;
/// A string array containing the names of all the users where the user name matches</dd>
<dt>&lt;paramref name=&#8221;usernameToMatch&#8221;/&gt; and the user is a member of the specified role.</dt>
<dd>/// &lt;/returns&gt;
/// &lt;param name=&#8221;roleName&#8221;&gt;The role to search in.&lt;/param&gt;&lt;param</dd>
<dt>name=&#8221;usernameToMatch&#8221;&gt;The user name to search for.&lt;/param&gt;</dt>
<dd><p class="first">public override string[] FindUsersInRole(string roleName, string usernameToMatch)
{</p>
<blockquote class="last">
<div>if (string.IsNullOrEmpty(roleName)) throw new ArgumentNullException(&#8220;roleName&#8221;);
if (string.IsNullOrEmpty(usernameToMatch)) throw new</div></blockquote>
</dd>
</dl>
<p>ArgumentNullException(&#8220;usernameToMatch&#8221;);</p>
<blockquote>
<div>var allUsersInRole = GetUsersInRole(roleName);
if (allUsersInRole == null || allUsersInRole.Count() &lt; 1) return new string[] {</div></blockquote>
<dl class="docutils">
<dt>&#8220;&#8221; };</dt>
<dd><blockquote class="first">
<div>var match = (from u in allUsersInRole where u.Equals(usernameToMatch) select u);
return match.ToArray();</div></blockquote>
<p>}</p>
<p>#region Properties</p>
<p class="last">/// &lt;summary&gt;
/// Gets or sets the name of the application to store and retrieve role information</p>
</dd>
<dt>for.</dt>
<dd><p class="first">/// &lt;/summary&gt;
/// &lt;returns&gt;
/// The name of the application to store and retrieve role information for.
/// &lt;/returns&gt;
public override string ApplicationName
{</p>
<blockquote>
<div>get { return _applicationName; }
set { _applicationName = value; }</div></blockquote>
<p>}</p>
<p>#endregion</p>
<p>#region Not Implemented Methods</p>
<p>/// &lt;summary&gt;
/// Adds a new role to the data source for the configured applicationName.
/// &lt;/summary&gt;
/// &lt;param name=&#8221;roleName&#8221;&gt;The name of the role to create.&lt;/param&gt;
public override void CreateRole(string roleName)
{</p>
<blockquote>
<div>//for the purpose of the sample the roles are hard coded
throw new NotImplementedException();</div></blockquote>
<p>}</p>
<p class="last">/// &lt;summary&gt;
/// Removes a role from the data source for the configured applicationName.
/// &lt;/summary&gt;
/// &lt;returns&gt;
/// true if the role was successfully deleted; otherwise, false.
/// &lt;/returns&gt;
/// &lt;param name=&#8221;roleName&#8221;&gt;The name of the role to delete.&lt;/param&gt;&lt;param</p>
</dd>
</dl>
<p>name=&#8221;throwOnPopulatedRole&#8221;&gt;If true, throw an exception if &lt;paramref name=&#8221;roleName&#8221;/&gt; has
one or more members and do not delete &lt;paramref name=&#8221;roleName&#8221;/&gt;.&lt;/param&gt;</p>
<blockquote>
<div><blockquote>
<div><blockquote>
<div><p>public override bool DeleteRole(string roleName, bool throwOnPopulatedRole)
{</p>
<blockquote>
<div>//for the purpose of the sample the roles are hard coded
throw new NotImplementedException();</div></blockquote>
<p>}</p>
<p>#endregion</p>
</div></blockquote>
<p>}</p>
</div></blockquote>
<p>}</p>
</div></blockquote>
</div>
<div class="section" id="adding-secure-sections-to-the-website">
<h5>Adding Secure Sections to the Website<a class="headerlink" href="#adding-secure-sections-to-the-website" title="Permalink to this headline">¶</a></h5>
<p>To display the functionality of the new Custom Role Provider, add 2 new ViewResult methods to
the Home Controller. Notice that the [Authorize] MVC attribute has been added to each of the
methods to restrict access to users in those roles only.</p>
<div class="highlight-python"><pre>[Authorize(Roles = "editor")]
public ViewResult SecureEditorSection()
{
return View();
}


[Authorize(Roles = "admin")]
public ViewResult SecureAdminSection()
{
return View();
}</pre>
</div>
<p>Right click on the View() methods, and select &#8220;Add View&#8221; for each. This automatically adds the
SecureEditorSection.cshtml and SecureAdminSection.cshtml files to the Home view folder.</p>
<p>To be able to navigate to these sections, open the file Views/Shared/_Layout.cshtml and add
two new action links to the main navigation menu:</p>
<div class="highlight-python"><pre>&lt;div id="menucontainer"&gt;
&lt;ul id="menu"&gt;
&lt;li&gt;@Html.ActionLink("Home", "Index", "Home")&lt;/li&gt;
&lt;li&gt;@Html.ActionLink("Query SPARQL", "Index", "Sparql")&lt;/li&gt;
**&lt;li&gt;@Html.ActionLink("Editors Only", "SecureEditorSection", "Home")&lt;/li&gt;**
**&lt;li&gt;@Html.ActionLink("Admin Only", "SecureAdminSection", "Home")&lt;/li&gt;**
&lt;/ul&gt;
&lt;/div&gt;</pre>
</div>
<p>In a real world application, you would manage roles within your own administration section,
but for the purpose of this sample we are going with an overly simplistic way of adding a user
to a role.</p>
</div>
<div class="section" id="id21">
<h5>Running the Application<a class="headerlink" href="#id21" title="Permalink to this headline">¶</a></h5>
<p>Press F5 to run the application. You will notice a [Log On] link in the top right hand corner
of the screen. You can navigate to the registration page via the logon page.</p>
<img alt="_images/1_register.png" src="_images/1_register.png" />
<p><strong>Register</strong></p>
<p>Choosing a username, email and password will create a login entity for you in the BrightstarDB
store, and automatically log you in.</p>
<img alt="_images/2_loggedin.png" src="_images/2_loggedin.png" />
<p><strong>Logged In</strong></p>
<p>The partial view that contains the login link code recognizes that you are logged in and
displays your username and a [Log Off] link. Clicking the links clears the cookies that keep
you logged in to the website.</p>
<img alt="_images/3_logon.png" src="_images/3_logon.png" />
<p><strong>Log On</strong></p>
<p>You can log on again at any time by entering your username and password.</p>
<p><strong>Role Authorization</strong></p>
<p>Clicking on the navigation links to &#8220;Secure Editor Section&#8221; will allow access to that view.
Whereas the &#8220;Secure Admin Section&#8221; will not pass authorization - by default MVC redirects the
user to the login view.</p>
</div>
</div>
<div class="section" id="adding-linked-data-support">
<span id="id22"></span><h4>Adding Linked Data Support<a class="headerlink" href="#adding-linked-data-support" title="Permalink to this headline">¶</a></h4>
<p>As data on the web becomes more predominant, it is becoming increasingly important to be able
to expose the underlying data of a web application in some way that is easy for external
applications to consume. While many web applications choose to expose bespoke APIs, these are
difficult for developers to use because each API has its own data structures and calls to
access data. However there are two well supported standards for publishing data on the web -
OData and SPARQL.</p>
<p>OData is an open standard, originally created by Microsoft, that provides a framework for
exposing a collection of entities as data accessible by URIs and represented in ATOM feeds.
SPARQL is a standard from the W3C for querying an RDF data store. Because BrightstarDB is,
under the hood, an RDF data store adding SPARQL support is pretty straightforward; and because
the BrightstarDB Entity Framework provides a set of entity classes, it is also very easy to
create an OData endpoint.</p>
<p>In this section we will show how to add these different forms of Linked Data to your web
application.</p>
<div class="section" id="create-a-sparql-action">
<h5>Create a SPARQL Action<a class="headerlink" href="#create-a-sparql-action" title="Permalink to this headline">¶</a></h5>
<p>The standard way of interfacing to a SPARQL endpoint is to either use an HTTP GET with a
?query= parameter that carries the SPARQL query as a string; or to use an HTTP POST which has
a form encoded in the POST request with a query field in it. For this example we will do the
latter as it is easiest to show and test with a browser-based API. We will create a query
action at /sparql, and include a form that allows a SPARQL query to be submitted through the
browser. To do this we need to create a new Controller to handle the /sparql URL.</p>
<p>Right-click on the Controllers folder and choose Add &gt; Controller. In the dialog that is
displayed, change the controller name to SparqlController, and choose the Empty MVC Controller
template option from the drop-down list.</p>
<p>Edit the SparqlController.cs file to add the following two methods to the class:</p>
<div class="highlight-python"><pre>public ViewResult Index()
{
    return View();
}


[HttpPost]
[ValidateInput(false)]
public ActionResult Index(string query)
{
    if (String.IsNullOrEmpty(query))
    {
        return View("Error");
    }
    var client = BrightstarService.GetClient();
    var results = client.ExecuteQuery("NerdDinner", query);
    return new FileStreamResult(results, "application/xml; charset=utf-16");
}</pre>
</div>
<p>The first method just displays a form that will allow a user to enter a SPARQL query. The
second method handles a POST operation and extracts the SPARQL query and executes it,
returning the results to the browser directly as an XML data stream.</p>
<p>Create a new folder under Views called &#8220;Sparql&#8221; and add a new View to the Views\Sparql with
the name Index.cshtml. This view simply displays a form with a large enough text box to allow
a query to be entered.</p>
<div class="highlight-python"><pre>&lt;h2&gt;SPARQL&lt;/h2&gt;


@using (Html.BeginForm()) {
    @Html.ValidationSummary(true)

    &lt;p&gt;Enter your SPARQL query in the text box below:&lt;/p&gt;


    @Html.TextArea("query", "SELECT ?d WHERE {?d a &lt;</pre>
</div>
<p><a class="reference external" href="http://brightstardb.com/namespaces/default/Dinner">http://brightstardb.com/namespaces/default/Dinner</a>&gt;}&#8221;, 10, 50, null)</p>
<blockquote>
<div><blockquote>
<div><dl class="docutils">
<dt>&lt;p&gt;</dt>
<dd>&lt;input type=&#8221;submit&#8221; value=&#8221;Query&#8221; /&gt;</dd>
</dl>
<p>&lt;/p&gt;</p>
</div></blockquote>
<p>}</p>
</div></blockquote>
<p>Now you can compile and run the web application again and click on the Query SPARQL link at
the top of the page (or simply navigate to the /sparql address for the web application). As
this is a normal browser HTTP GET, you will see the form rendered by the first of the two
action methods. By default this contains a SPARQL query that should work nicely against the
NerdDinner entity model, returning the URI identifiers of all Dinner entities in the
BrightstarDB data store.</p>
<img alt="_images/mvc15.png" src="_images/mvc15.png" />
<p>Clicking on the Query button submits the form, simulating an HTTP POST from an external
application. The results are returned as raw XML, which will be formatted and displayed
depending on which browser you use and your browser settings (the screenshot below is from a
Firefox browser window).</p>
<img alt="_images/mvc16.png" src="_images/mvc16.png" />
</div>
<div class="section" id="creating-an-odata-provider">
<h5>Creating an OData Provider<a class="headerlink" href="#creating-an-odata-provider" title="Permalink to this headline">¶</a></h5>
<p>The Open Data Protocol (OData) is an open web protocol for querying and updating data. An
OData provider can be added to BrightstarDB Entity Framework projects to allow OData consumers
to query the underlying data.</p>
<p>The following steps describe how to create an OData provider to an existing project (in this
example we add to the NerdDinner MVC Web Application project).</p>
<p>1. Right-click on the project in the Solution Explorer and select Add New Item. In the dialog
that is displayed click on Web, and select WCF Data Service. Rename this to OData.svc and
click &#8216;add&#8217;.</p>
<img alt="_images/odata_1_additem.png" src="_images/odata_1_additem.png" />
<p>2. Change the class inheritance from DataService to EntityDataService, and add the name of the
BrightstarEntityContext to the type argument.</p>
<ol class="arabic simple" start="3">
<li>Edit the body of the method with the following configuration settings:</li>
</ol>
<div class="highlight-python"><pre>public class OData : EntityDataService&lt;NerdDinnerContext&gt;
{
// This method is called only once to initialize service-wide policies.
public static void InitializeService(DataServiceConfiguration config)
{
config.SetEntitySetAccessRule("*", EntitySetRights.AllRead);
config.SetEntitySetAccessRule("NerdDinnerLogin", EntitySetRights.None);
config.SetServiceOperationAccessRule("*", ServiceOperationRights.All);
config.DataServiceBehavior.MaxProtocolVersion = DataServiceProtocolVersion.V2;
}
}</pre>
</div>
<div class="admonition note">
<p class="first admonition-title">Note</p>
<p class="last">The NerdDinnerLogin set has been given EntitySetRights of None. This hides the set (which</p>
</div>
<p>contains sensitive login information) from the OData service</p>
<p>4. Rebuild and run the project. Navigation to /OData.svc and you will see the standard OData
metadata page displaying the entity sets from BrightstarDB</p>
<img alt="_images/odata_2_metadata.png" src="_images/odata_2_metadata.png" />
<p>5. The OData service can now be queried using the standard OData conventions. There are a
<a class="reference internal" href="#odata"><em>few restrictions</em></a> when using OData services with BrighstarDB.</p>
<img alt="_images/odata_3_querying.png" src="_images/odata_3_querying.png" />
</div>
</div>
<div class="section" id="consuming-odata-in-powerpivot">
<span id="id23"></span><h4>Consuming OData in PowerPivot<a class="headerlink" href="#consuming-odata-in-powerpivot" title="Permalink to this headline">¶</a></h4>
<p>The data in BrighstarDB can be consumed by various OData consumers. In this topic we look at
consuming the data using PowerPivot (a list of recommended OData consumers can be found
<a class="reference external" href="&lt;%LINK_CAPTION%&gt;">odata.org/consumers</a>).</p>
<p>Open Excel, click the PowerPivot tab and open the PowerPivot window</p>
<p>If you do not have PowerPivot installed, you can download it from <a class="reference external" href="&lt;%LINK_CAPTION%&gt;">powerpivot.com</a></p>
<p>To consume data from Brightstar, click the &#8216;From Data Feeds&#8217; button in the &#8216;Get External Data&#8217;
section:</p>
<img alt="_images/odataconsumer_1_feedbutton.png" src="_images/odataconsumer_1_feedbutton.png" />
<p>Add a name for your feed, and enter the URL of the OData service file for your BrightstarDB
application.</p>
<img alt="_images/odataconsumer_2b_connect.png" src="_images/odataconsumer_2b_connect.png" />
<p>Click &#8220;Test Connection&#8221; to make sure that you can connect to your OData service and then click
&#8220;Next&#8221;</p>
<img alt="_images/odataconsumer_3b_selectsets.png" src="_images/odataconsumer_3b_selectsets.png" />
<p>Select the sets that you wish to consume and click &#8220;Finish&#8221;</p>
<img alt="_images/odataconsumer_5b_success.png" src="_images/odataconsumer_5b_success.png" />
<p>This then shows all the data that is consumed from the OData service in the PowerPivot window.
When any data is added or edited in the BrightstarDB store, the data in the PowerPivot windows
can be updated by clicking the &#8220;Refresh&#8221; button.</p>
<img alt="_images/odataconsumer_6_data.png" src="_images/odataconsumer_6_data.png" />
</div>
</div>
<div class="section" id="mapping-to-existing-rdf-data">
<span id="mapping-to-existing-rdf-schema"></span><h3>Mapping to Existing RDF Data<a class="headerlink" href="#mapping-to-existing-rdf-data" title="Permalink to this headline">¶</a></h3>
<div class="admonition note">
<p class="first admonition-title">Note</p>
<p class="last">The source code for this example can be found in</p>
</div>
<p>[INSTALLDIR]\Samples\EntityFramework\EntityFrameworkSamples.sln</p>
<p>One of the things that makes BrightstarDB unique is the ability to map multiple object models
onto the same data and to map an object model onto existing RDF data. An example of this could
be when some contact data in RDF foaf form is imported into BrightstarDB and an application
wants to make use of that data. Using the BrightstarDB annotations it is possible to map
object classes and properties to existing types and property types.</p>
<div class="section" id="the-following-foaf-rdf-triples-are-added-to-the-data-store">
<h4>The following FOAF RDF triples are added to the data store.<a class="headerlink" href="#the-following-foaf-rdf-triples-are-added-to-the-data-store" title="Permalink to this headline">¶</a></h4>
<div class="highlight-python"><pre>&lt;http://www.brightstardb.com/people/david&gt; &lt;http://www.w3.org/1999/02/22-rdf-syntax-ns#type&gt;</pre>
</div>
<dl class="docutils">
<dt>&lt;<a class="reference external" href="http://xmlns.com/foaf/0.1/Person">http://xmlns.com/foaf/0.1/Person</a>&gt; .</dt>
<dd>&lt;<a class="reference external" href="http://www.brightstardb.com/people/david">http://www.brightstardb.com/people/david</a>&gt; &lt;<a class="reference external" href="http://xmlns.com/foaf/0.1/nick">http://xmlns.com/foaf/0.1/nick</a>&gt; &#8220;&#8221;David&#8221;&#8221; .
&lt;<a class="reference external" href="http://www.brightstardb.com/people/david">http://www.brightstardb.com/people/david</a>&gt; &lt;<a class="reference external" href="http://xmlns.com/foaf/0.1/name">http://xmlns.com/foaf/0.1/name</a>&gt; &#8220;&#8221;David</dd>
<dt>Summers&#8221;&#8221; .</dt>
<dd>&lt;<a class="reference external" href="http://www.brightstardb.com/people/david">http://www.brightstardb.com/people/david</a>&gt; &lt;<a class="reference external" href="http://xmlns.com/foaf/0.1/Organization">http://xmlns.com/foaf/0.1/Organization</a>&gt;</dd>
<dt>&#8220;&#8221;Microsoft&#8221;&#8221; .</dt>
<dd>&lt;<a class="reference external" href="http://www.brightstardb.com/people/simon">http://www.brightstardb.com/people/simon</a>&gt; &lt;<a class="reference external" href="http://www.w3.org/1999/02/22-rdf-syntax-ns#type">http://www.w3.org/1999/02/22-rdf-syntax-ns#type</a>&gt;</dd>
<dt>&lt;<a class="reference external" href="http://xmlns.com/foaf/0.1/Person">http://xmlns.com/foaf/0.1/Person</a>&gt; .</dt>
<dd>&lt;<a class="reference external" href="http://www.brightstardb.com/people/simon">http://www.brightstardb.com/people/simon</a>&gt; &lt;<a class="reference external" href="http://xmlns.com/foaf/0.1/nick">http://xmlns.com/foaf/0.1/nick</a>&gt; &#8220;&#8221;Simon&#8221;&#8221; .
&lt;<a class="reference external" href="http://www.brightstardb.com/people/simon">http://www.brightstardb.com/people/simon</a>&gt; &lt;<a class="reference external" href="http://xmlns.com/foaf/0.1/name">http://xmlns.com/foaf/0.1/name</a>&gt; &#8220;&#8221;Simon</dd>
<dt>Williamson&#8221;&#8221; .</dt>
<dd>&lt;<a class="reference external" href="http://www.brightstardb.com/people/simon">http://www.brightstardb.com/people/simon</a>&gt; &lt;<a class="reference external" href="http://xmlns.com/foaf/0.1/Organization">http://xmlns.com/foaf/0.1/Organization</a>&gt;</dd>
<dt>&#8220;&#8221;Microsoft&#8221;&#8221; .</dt>
<dd>&lt;<a class="reference external" href="http://www.brightstardb.com/people/simon">http://www.brightstardb.com/people/simon</a>&gt; &lt;<a class="reference external" href="http://xmlns.com/foaf/0.1/knows">http://xmlns.com/foaf/0.1/knows</a>&gt; &lt;</dd>
</dl>
<p><a class="reference external" href="http://www.brightstardb.com/people/david">http://www.brightstardb.com/people/david</a>&gt; .</p>
<p>Triples can be loaded into the BrightStarDB using the following code::</p>
<div class="highlight-python"><pre>var triples = new StringBuilder();
triples.AppendLine(@"&lt;http://www.brightstardb.com/people/simon&gt; &lt;</pre>
</div>
<dl class="docutils">
<dt><a class="reference external" href="http://www.w3.org/1999/02/22-rdf-syntax-ns#type">http://www.w3.org/1999/02/22-rdf-syntax-ns#type</a>&gt; &lt;<a class="reference external" href="http://xmlns.com/foaf/0.1/Person">http://xmlns.com/foaf/0.1/Person</a>&gt; .&#8221;);</dt>
<dd>triples.AppendLine(&#64;&#8221;&lt;<a class="reference external" href="http://www.brightstardb.com/people/simon">http://www.brightstardb.com/people/simon</a>&gt; &lt;</dd>
<dt><a class="reference external" href="http://xmlns.com/foaf/0.1/nick">http://xmlns.com/foaf/0.1/nick</a>&gt; &#8220;&#8221;Simon&#8221;&#8221; .&#8221;);</dt>
<dd>triples.AppendLine(&#64;&#8221;&lt;<a class="reference external" href="http://www.brightstardb.com/people/simon">http://www.brightstardb.com/people/simon</a>&gt; &lt;</dd>
<dt><a class="reference external" href="http://xmlns.com/foaf/0.1/name">http://xmlns.com/foaf/0.1/name</a>&gt; &#8220;&#8221;Simon Williamson&#8221;&#8221; .&#8221;);</dt>
<dd>triples.AppendLine(&#64;&#8221;&lt;<a class="reference external" href="http://www.brightstardb.com/people/simon">http://www.brightstardb.com/people/simon</a>&gt; &lt;</dd>
<dt><a class="reference external" href="http://xmlns.com/foaf/0.1/Organization">http://xmlns.com/foaf/0.1/Organization</a>&gt; &#8220;&#8221;Microsoft&#8221;&#8221; .&#8221;);</dt>
<dd>triples.AppendLine(&#64;&#8221;&lt;<a class="reference external" href="http://www.brightstardb.com/people/simon">http://www.brightstardb.com/people/simon</a>&gt; &lt;</dd>
<dt><a class="reference external" href="http://xmlns.com/foaf/0.1/knows">http://xmlns.com/foaf/0.1/knows</a>&gt; &lt;<a class="reference external" href="http://www.brightstardb.com/people/david">http://www.brightstardb.com/people/david</a>&gt; .&#8221;);</dt>
<dd>client.ExecuteTransaction(storeName, null, triples.ToString());</dd>
</dl>
</div>
<div class="section" id="defining-mappings">
<h4>Defining Mappings<a class="headerlink" href="#defining-mappings" title="Permalink to this headline">¶</a></h4>
<p>To access this data from the Entity Framework, we need to define the mappings between the RDF
predictates and the properties on an object that represents an entity in the store.</p>
<p>The properties are marked up with the PropertyType attribute of the RDF predicate. If the
property &#8220;Name&#8221; should match the predicate &#8220;<a class="reference external" href="&lt;%LINK_CAPTION%&gt;">http://xmlns.com/foaf/0.1/name&#8221;</a>, we add the
attribute <tt class="docutils literal"><span class="pre">[PropertyType(&quot;```http://xmlns.com/foaf/0.1/name`_</span></tt>&#8221;)].``</p>
<p>We can add a Namespace Declaration to the project&#8217;s AssemblyInfo.cs file to shorted the URIs
used in the attributes, in the format::</p>
<div class="highlight-python"><pre>[assembly: NamespaceDeclaration("foaf", "`http://xmlns.com/foaf/0.1/")`_]</pre>
</div>
<p>This means the PropertyType attributes can be shortened to <tt class="docutils literal"><span class="pre">[PropertyType(&quot;foaf:name&quot;)]</span></tt></p>
<p>The RDF example given above would be mapped to an entity as given below::</p>
<div class="highlight-python"><pre>[Entity("http://xmlns.com/foaf/0.1/Person")]
public interface IPerson
{
    [Identifier("http://www.brightstardb.com/people/")]
    string Id { get; }


    [PropertyType("foaf:nick")]
    string Nickname { get; set; }


    [PropertyType("foaf:name")]
    string Name { get; set; }


    [PropertyType("foaf:Organization")]
    string Organisation { get; set; }


    [PropertyType("foaf:knows")]
    ICollection&lt;IPerson&gt; Knows { get; set; }


    [InversePropertyType("foaf:knows")]
    ICollection&lt;IPerson&gt; KnownBy { get; set; }
}</pre>
</div>
<p>Adding the [Identifier(&#8220;<a class="reference external" href="http://www">http://www</a>.``brightstardb``.com/people/&#8221;)] to the ID of the interface,
means that when we can query and retrieve the Id without the entire prefix</p>
</div>
<div class="section" id="example">
<h4>Example<a class="headerlink" href="#example" title="Permalink to this headline">¶</a></h4>
<p>Once there is RDF data in the store, and an interface that maps an entity to the RDF data, the
data can then be accessed easy using the Entity Framework by using the correct connection
string to directly access the store.</p>
<div class="highlight-python"><pre>var connectionString = "Type=http;endpoint=http://localhost:8090/brightstar;StoreName=Foaf";
var context = new FoafContext(connectionString);</pre>
</div>
<p>If you have added the connection string into the Config file:</p>
<p>&lt;add key=&#8221;BrightstarDB.ConnectionString&#8221; value=&#8221;Type=http;endpoint=
<a class="reference external" href="http://localhost:8090/brightstar;StoreName=Foaf">http://localhost:8090/brightstar;StoreName=Foaf</a>&#8221; /&gt;</p>
<p>then you can initialise the content with a simple::</p>
<div class="highlight-python"><pre>var context = new FoafContext();</pre>
</div>
<p>For more information about connection strings, please read the <a class="reference internal" href="#connection-strings"><em>&#8220;Connection Strings&#8221;
topic</em></a></p>
<p>The code below connects to the store to access all the people in the RDF data, it then writes
their name and place of employment, along with all the people they know or are known by.</p>
<div class="highlight-python"><pre>var context = new FoafContext(connectionString);
var people = context.Persons.ToList();
var count = people.Count;
Console.WriteLine(@"{0} people found in raw RDF data", count);
Console.WriteLine();
foreach(var person in people)
{
    var knows = new List&lt;IPerson&gt;();
    knows.AddRange(person.Knows);
    knows.AddRange(person.KnownBy);


    Console.WriteLine(@"{0} ({1}), works at {2}", person.Name, person.Nickname,</pre>
</div>
<dl class="docutils">
<dt>person.Organisation);</dt>
<dd>Console.WriteLine(knows.Count == 1 ? string.Format(&#64;&#8221;{0} knows 1 other person&#8221;,</dd>
<dt>person.Nickname)</dt>
<dd>: string.Format(&#64;&#8221;{0} knows {1} other people&#8221;, person.Nickname,</dd>
<dt>knows.Count));</dt>
<dd><blockquote class="first">
<div><p>foreach(var other in knows)
{</p>
<blockquote>
<div>Console.WriteLine(&#64;&#8221; &nbsp; &nbsp;{0} at {1}&#8221;, other.Name, other.Organisation);</div></blockquote>
<p>}
Console.WriteLine();</p>
</div></blockquote>
<p class="last">}</p>
</dd>
</dl>
</div>
</div>
</div>
<div class="section" id="data-object-layer">
<span id="id25"></span><h2>Data Object Layer<a class="headerlink" href="#data-object-layer" title="Permalink to this headline">¶</a></h2>
<p>The Data Object Layer is a simple generic object wrapper for the underlying RDF data in any
BrightstarDB store.</p>
<p>Data Objects are lightweight wrappers around sets of RDF triples in the underlying
BrightstarDB store. They allow the developer to interact with the RDF data without requiring
all information to be sent in N-Triple format.</p>
<p>For more information about the RDF layer of BrightstarDB, please read the <a class="reference internal" href="#rdf-client-api"><em>RDF Client API</em></a> section.</p>
<div class="section" id="creating-a-data-object-context">
<h3>Creating a Data Object Context<a class="headerlink" href="#creating-a-data-object-context" title="Permalink to this headline">¶</a></h3>
<p>The following example shows how to create a new context using a connection string:</p>
<div class="highlight-python"><pre>var context = BrightstarService.GetDataObjectContext("Type=http;endpoint=</pre>
</div>
<p><a class="reference external" href="http://localhost:8090/brightstar">http://localhost:8090/brightstar</a>;&#8221;);</p>
<p>For more information about connection strings, please read the <a class="reference internal" href="#connection-strings"><em>&#8220;Connection Strings&#8221;
topic</em></a></p>
</div>
<div class="section" id="creating-a-store">
<h3>Creating a Store<a class="headerlink" href="#creating-a-store" title="Permalink to this headline">¶</a></h3>
<p>A new store can be creating using the following code:</p>
<div class="highlight-python"><pre>string storeName = "Store_" + Guid.NewGuid();
context.CreateStore(storeName);</pre>
</div>
</div>
<div class="section" id="deleting-a-store">
<h3>Deleting a Store<a class="headerlink" href="#deleting-a-store" title="Permalink to this headline">¶</a></h3>
<p>Deleting a store is also straight forward:</p>
<div class="highlight-python"><div class="highlight"><pre><span class="n">context</span><span class="o">.</span><span class="n">DeleteStore</span><span class="p">(</span><span class="n">storeName</span><span class="p">);</span>
</pre></div>
</div>
</div>
<div class="section" id="creating-data-objects">
<h3>Creating data objects<a class="headerlink" href="#creating-data-objects" title="Permalink to this headline">¶</a></h3>
<p>Data Objects can be created using the following code:</p>
<div class="highlight-python"><pre>var fred = store.MakeDataObject("http://example.org/people/fred");</pre>
</div>
<p>The objects can be created by passing in a well formed URI as the identity, if no identity is
given then one is automatically generated for it.</p>
</div>
<div class="section" id="adding-information-to-data-objects">
<h3>Adding information to data objects<a class="headerlink" href="#adding-information-to-data-objects" title="Permalink to this headline">¶</a></h3>
<p>To add information about this object we can add properties to it:</p>
<p><strong>Setting Single Properties</strong></p>
<p>To set the value of a single property, use the following code:</p>
<div class="highlight-python"><pre>var fullname = store.MakeDataObject("http://example.org/schemas/person/fullName");
fred.SetProperty(fullname, "Fred Evans");</pre>
</div>
<p>Using SetProperty() multiple times will overwrite the previous value of the property.</p>
<p><strong>Adding Multiple Properties</strong></p>
<p>To add multiple properties of the same type use the code below:</p>
<div class="highlight-python"><pre>var skill = store.MakeDataObject("http://example.org/schemas/person/skill");
fred.AddProperty(skill, csharp);
fred.AddProperty(skill, html);
fred.AddProperty(skill, css);</pre>
</div>
</div>
<div class="section" id="retrieving-data-objects">
<h3>Retrieving Data Objects<a class="headerlink" href="#retrieving-data-objects" title="Permalink to this headline">¶</a></h3>
<p>A data object can be retrieved from the store using the following code:</p>
<div class="highlight-python"><pre>var fred = store.GetDataObject("http://example.org/people/fred");</pre>
</div>
<p>If BrightstarDB does not hold any information about a given URI, then a data object is created
for it and passed back. When the developer adds properties to it and saves it, the identity
will be automatically added to BrightstarDB.</p>
<div class="admonition note">
<p class="first admonition-title">Note</p>
<p class="last">GetDataObject() will never return a null object. The data object consists of all the</p>
</div>
<p>information that is held in BrightstarDB for a particular identity.</p>
<p>We can check the RDF data that an object has at any time by using the following code:</p>
<div class="highlight-python"><pre>var triples = ((DataObject)fred).Triples;</pre>
</div>
</div>
<div class="section" id="deleting-data-objects">
<h3>Deleting Data Objects<a class="headerlink" href="#deleting-data-objects" title="Permalink to this headline">¶</a></h3>
<p>A data object can be deleted using the following code:</p>
<div class="highlight-python"><pre>var fred = store.GetDataObject("http://example.org/people/fred");
fred.Delete();</pre>
</div>
<p>This removes all triples describing that data object from the store.</p>
</div>
<div class="section" id="namespace-mappings">
<h3>Namespace Mappings<a class="headerlink" href="#namespace-mappings" title="Permalink to this headline">¶</a></h3>
<p>Namespace mappings are sets of simple string prefixes for URIs, enabling the developer to use
identities that have been shortened to use the prefixes.</p>
<p>For example, the mapping:</p>
<div class="highlight-python"><div class="highlight"><pre><span class="p">{</span><span class="s">&quot;people&quot;</span><span class="p">,</span> <span class="s">&quot;http://example.org/people/&quot;</span><span class="p">}</span>
</pre></div>
</div>
<p>Means that the identity &#8220;people:fred&#8221; will match the identity &#8220;http://example.org/people/fred&#8221;</p>
<p>These mappings are passed through as a dictionary to the OpenStore() method on the context:</p>
<div class="highlight-python"><pre>_namespaceMappings = new Dictionary&lt;string, string&gt;()
                         {
                             {"people", "http://example.org/people/"},
                             {"skills", "http://example.org/skills/"},
                             {"schema", "http://example.org/schema/"}
                         };


store = context.OpenStore(storeName, _namespaceMappings);</pre>
</div>
<div class="admonition note">
<p class="first admonition-title">Note</p>
<p class="last">It is best practise to set up a static dictionary within your class or configuration</p>
</div>
</div>
<div class="section" id="querying-data-using-sparql">
<h3>Querying data using SPARQL<a class="headerlink" href="#querying-data-using-sparql" title="Permalink to this headline">¶</a></h3>
<p>BrightstarDB supports <a class="reference external" href="http://www.w3.org/TR/sparql11-query/">SPARQL 1.1</a> for querying the data in the store. These queries can be
executed via the Data Object store using the ExecuteSparql() method.</p>
<p>The SparqlResult returned has the results of the SPARQL query in the ResultDocument property
(See <a class="reference external" href="http://www.w3.org/TR/rdf-sparql-XMLres/">http://www.w3.org/TR/rdf-sparql-XMLres/</a> for the XML format returned).</p>
<div class="highlight-python"><pre>var query = "SELECT ?skill WHERE { &lt;http://example.org/people/fred&gt; &lt;</pre>
</div>
<dl class="docutils">
<dt><a class="reference external" href="http://example.org/schemas/person/skill">http://example.org/schemas/person/skill</a>&gt; ?skill }&#8221;;</dt>
<dd><p class="first">var sparqlResult = store.ExecuteSparql(query);
foreach (var sparqlResultRow in sparqlResult.ResultDocument.SparqlResultRows())
{</p>
<blockquote>
<div>var val = sparqlResultRow.GetColumnValue(&#8220;skill&#8221;);
Console.WriteLine(&#8220;Skill is &#8221; + val);</div></blockquote>
<p class="last">}</p>
</dd>
</dl>
</div>
<div class="section" id="binding-sparql-results-to-data-objects">
<h3>Binding SPARQL Results To Data Objects<a class="headerlink" href="#binding-sparql-results-to-data-objects" title="Permalink to this headline">¶</a></h3>
<p>When a SPARQL query has been written to return a variable binding, it can be passed to the
BindDataObjectsWithSparql() method. This executes the SPARQL query, and then binds each URI in
the results to a data object, and passes back the enumeration of these instances.</p>
<div class="highlight-python"><pre>var skillsQuery = "SELECT ?skill WHERE {?skill a &lt;http://example.org/schemas/skill&gt;}";
var allSkills = store.BindDataObjectsWithSparql(skillsQuery).ToList();
foreach (var s in allSkills)
{
    Console.WriteLine("Skill is " + s.Identity);
}</pre>
</div>
</div>
<div class="section" id="sample-program">
<span id="data-object-layer-sample-program"></span><h3>Sample Program<a class="headerlink" href="#sample-program" title="Permalink to this headline">¶</a></h3>
<div class="admonition note">
<p class="first admonition-title">Note</p>
<p class="last">The source code for this example can be found in</p>
</div>
<p>[INSTALLDIR]\Samples\DataObjectLayer\DataObjectLayerSamples.sln</p>
<p>The sample project is a simple console application that runs through some of the basic usage
for BrightstarDB&#8217;s Data Object Layer.</p>
<div class="section" id="creating-the-context">
<h4>Creating the context<a class="headerlink" href="#creating-the-context" title="Permalink to this headline">¶</a></h4>
<p>A context is created using a connection string that specifies usage of the HTTP server</p>
<div class="highlight-python"><pre>var context = BrightstarService.GetDataObjectContext(@"Type=http;endpoint=</pre>
</div>
<p><a class="reference external" href="http://localhost:8090/brightstar">http://localhost:8090/brightstar</a>;&#8221;);</p>
</div>
<div class="section" id="creating-the-store">
<h4>Creating the store<a class="headerlink" href="#creating-the-store" title="Permalink to this headline">¶</a></h4>
<p>A store is created with a unique name</p>
<div class="highlight-python"><pre>string storeName = "DataObjectLayerSample_" + Guid.NewGuid();
var store = context.CreateStore(storeName);</pre>
</div>
</div>
<div class="section" id="id27">
<h4>Namespace Mappings<a class="headerlink" href="#id27" title="Permalink to this headline">¶</a></h4>
<p>In order to use simpler identities when we are creating and retrieving data objects, we set up
a dictionary of namespace mappings to use when we connect to the store:</p>
<div class="highlight-python"><pre>_namespaceMappings = new Dictionary&lt;string, string&gt;()
    {
        {"people", "http://example.org/people/"},
        {"skills", "http://example.org/skills/"},
        {"schema", "http://example.org/schema/"}
};


store = context.OpenStore(storeName, _namespaceMappings);</pre>
</div>
</div>
<div class="section" id="id28">
<h4>Optimistic Locking<a class="headerlink" href="#id28" title="Permalink to this headline">¶</a></h4>
<p>To enable support for optimistic locking, we must pass a boolean flag to the OpenStore() or
CreateStore() method:</p>
<div class="highlight-python"><pre>store = context.OpenStore(storeName, _namespaceMappings, true); // Open store with</pre>
</div>
<p>optimistic locking enabled</p>
</div>
<div class="section" id="skills">
<h4>Skills<a class="headerlink" href="#skills" title="Permalink to this headline">¶</a></h4>
<p>We create a data object to use as the type of data object for skills, and then create a number
of skill data objects.</p>
<div class="highlight-python"><pre>var skillType = store.MakeDataObject("schema:skill");


var csharp = store.MakeDataObject("skills:csharp");
csharp.SetType(skillType);
var html = store.MakeDataObject("skills:html");
html.SetType(skillType);
var css = store.MakeDataObject("skills:css");
css.SetType(skillType);
var javascript = store.MakeDataObject("skills:javascript");
javascript.SetType(skillType);</pre>
</div>
</div>
<div class="section" id="people">
<h4>People<a class="headerlink" href="#people" title="Permalink to this headline">¶</a></h4>
<p>We follow the same process to create some people data objects.</p>
<div class="highlight-python"><pre>var personType = store.MakeDataObject("schema:person");


var fred = store.MakeDataObject("people:fred");
fred.SetType(personType);
var william = store.MakeDataObject("people:william");
william.SetType(personType);</pre>
</div>
</div>
<div class="section" id="properties">
<h4>Properties<a class="headerlink" href="#properties" title="Permalink to this headline">¶</a></h4>
<p>We create 2 data objects to use as the types for some properties that the people data objects
will hold.</p>
<div class="highlight-python"><pre>var fullname = store.MakeDataObject("schema:person/fullName");
var skill = store.MakeDataObject("schema:person/skill");</pre>
</div>
<p>We then set the single name property on the people, and add skills</p>
<div class="admonition note">
<p class="first admonition-title">Note</p>
<p class="last">For multiple properties we must use the AddProperty() method rather than SetProperty() which</p>
</div>
<p>would overwrite any previous value</p>
<div class="highlight-python"><div class="highlight"><pre><span class="n">fred</span><span class="o">.</span><span class="n">SetProperty</span><span class="p">(</span><span class="n">fullname</span><span class="p">,</span> <span class="s">&quot;Fred Evans&quot;</span><span class="p">);</span>
<span class="n">fred</span><span class="o">.</span><span class="n">AddProperty</span><span class="p">(</span><span class="n">skill</span><span class="p">,</span> <span class="n">csharp</span><span class="p">);</span>
<span class="n">fred</span><span class="o">.</span><span class="n">AddProperty</span><span class="p">(</span><span class="n">skill</span><span class="p">,</span> <span class="n">html</span><span class="p">);</span>
<span class="n">fred</span><span class="o">.</span><span class="n">AddProperty</span><span class="p">(</span><span class="n">skill</span><span class="p">,</span> <span class="n">css</span><span class="p">);</span>


<span class="n">william</span><span class="o">.</span><span class="n">SetProperty</span><span class="p">(</span><span class="n">fullname</span><span class="p">,</span> <span class="s">&quot;William Turner&quot;</span><span class="p">);</span>
<span class="n">william</span><span class="o">.</span><span class="n">AddProperty</span><span class="p">(</span><span class="n">skill</span><span class="p">,</span> <span class="n">html</span><span class="p">);</span>
<span class="n">william</span><span class="o">.</span><span class="n">AddProperty</span><span class="p">(</span><span class="n">skill</span><span class="p">,</span> <span class="n">css</span><span class="p">);</span>
<span class="n">william</span><span class="o">.</span><span class="n">AddProperty</span><span class="p">(</span><span class="n">skill</span><span class="p">,</span> <span class="n">javascript</span><span class="p">);</span>
</pre></div>
</div>
<p>The data type of literal properties are set automatically when a property value is added or set:</p>
<div class="highlight-python"><pre>var employeeNumber = store.MakeDataObject("schema:person/employeeNumber");
var dateOfBirth = store.MakeDataObject("schema:person/dateOfBirth");
var salary = store.MakeDataObject("schema:person/salary");


fred = store.GetDataObject("people:fred");
fred.SetProperty(employeeNumber, 123);
fred.SetProperty(dateOfBirth, DateTime.Now.AddYears(-30));
fred.SetProperty(salary, 18000.00);</pre>
</div>
</div>
<div class="section" id="save-changes">
<h4>Save Changes<a class="headerlink" href="#save-changes" title="Permalink to this headline">¶</a></h4>
<p>Now that we have created the objects we require, we save the changes to the BrightstarDB store.</p>
<div class="highlight-python"><div class="highlight"><pre><span class="n">store</span><span class="o">.</span><span class="n">SaveChanges</span><span class="p">();</span>
</pre></div>
</div>
</div>
<div class="section" id="querying-the-data">
<h4>Querying the data<a class="headerlink" href="#querying-the-data" title="Permalink to this headline">¶</a></h4>
<p>We use SPARQL to query the data in the store. For more information about SPARQL please read
the <a class="reference external" href="http://www.w3.org/TR/sparql11-query/">SPARQL 1.1</a> documenation. In the sample, we write a query that returns all of the skills
of the data object for &#8216;fred&#8217;. We can then loop through the ResultDocument of the SparqlResult
returned to see the identities of each of those skills.</p>
<div class="highlight-python"><pre>const string getPersonSkillsQuery = "SELECT ?skill WHERE { &lt;http://example.org/people/fred&gt;</pre>
</div>
<dl class="docutils">
<dt>&lt;<a class="reference external" href="http://example.org/schemas/person/skill">http://example.org/schemas/person/skill</a>&gt; ?skill }&#8221;;</dt>
<dd>var sparqlResult = store.ExecuteSparql(getPersonSkillsQuery);</dd>
</dl>
</div>
<div class="section" id="binding-data-objects-with-sparql">
<h4>Binding Data Objects With SPARQL<a class="headerlink" href="#binding-data-objects-with-sparql" title="Permalink to this headline">¶</a></h4>
<p>The Data Object Store has a very useful method called BindDataObjectsWithSparql(), which takes
a SPARQL query that is written to return the URI identities of data object. The method then
returns the data objects for each of the URIs contained in the results.</p>
<p>In the sample we pass in a query to return URIs of any objects with the skill type.</p>
<div class="highlight-python"><pre>const string skillsQuery = "SELECT ?skill WHERE {?skill a &lt;http://example.org/schemas/skill</pre>
</div>
<dl class="docutils">
<dt>&gt;}&#8221;;</dt>
<dd>var allSkills = store.BindDataObjectsWithSparql(skillsQuery).ToList();</dd>
</dl>
</div>
<div class="section" id="deleting-objects">
<h4>Deleting Objects<a class="headerlink" href="#deleting-objects" title="Permalink to this headline">¶</a></h4>
<p>To delete data objects we simply call the Delete() method of that object and save the changes
to the store.</p>
<div class="highlight-python"><pre>foreach (var s in allSkills)
{
s.Delete();
}
store.SaveChanges();</pre>
</div>
</div>
</div>
<div class="section" id="optimistic-locking-in-the-data-object-layer">
<span id="optimistic-locking-in-dol"></span><h3>Optimistic Locking in the Data Object Layer<a class="headerlink" href="#optimistic-locking-in-the-data-object-layer" title="Permalink to this headline">¶</a></h3>
<p>The Data Object Layer provides a basic level of optimistic locking support using the
conditional update support provided by the RDF Client API and a special version property that
gets assigned to data objects. To enable optimistic locking support it is necessary to enable
locking when the IDataObjectStore instance is retrieved from the context by either the
OpenStore or CreateStore method (see <a class="reference internal" href="#data-object-layer-sample-program"><em>Sample Program</em></a>
for an example).</p>
<p>With optimistic locking enabled, the Data Object Layer checks for the presence of a special
version property on every object it retrieves (the property predicate URI is
<a class="reference external" href="http://www.brightstardb.com/.well-known/model/version">http://www.brightstardb.com/.well-known/model/version</a>). If this property is present, its value
defines the current version number of the property. If the property is not present, the object
is recorded as being currently unversioned. On save, the DataObjectLayer uses the current
version number of all versioned data objects as the set of preconditions for the update, if
any of these objects have had their version number property modified on the server, the
precondition will fail and the update will not be applied. Also as part of the save, the
DataObjectLayer updates the version number of all versioned data objects and creates a new
version number for all unversioned data objects.</p>
<p>When an concurrent modification is detected, this is notified to your code by a
BrightstarClientException being raised. In your code you should catch this exception and
handle the error, typically either by abandoning updates (and notifying the user) or
re-retrieving the modified objects and attempting the update again.</p>
</div>
</div>
<div class="section" id="dynamic-api">
<span id="id29"></span><h2>Dynamic API<a class="headerlink" href="#dynamic-api" title="Permalink to this headline">¶</a></h2>
<p>The Dynamic API is a thin layer on top of the data object layer. It is designed to further
ease the use of .NET with RDF data and to provide a model for persisting data in systems that
make use of the .NET dynamic keyword. The .NET dynamic keyword and dynamic runtime allow
properties of objects to be set at runtime without any prior class definition.</p>
<p>The following example shows how dynamics work in general. Both &#8216;Name&#8217; and &#8216;Type&#8217; are resolved
at runtime. In this case they are simply stored as properties in the ExpandoObject.</p>
<div class="highlight-python"><pre>dynamic d = new ExpandoObject();
d.Name = "Brightstar";
d.Type = "Product";</pre>
</div>
<div class="section" id="dynamic-context">
<h3>Dynamic Context<a class="headerlink" href="#dynamic-context" title="Permalink to this headline">¶</a></h3>
<p>A dynamic context can be used to create dynamic objects whose state is persisted as RDF in
BrightstarDB. To use the dynamic context a normal DataObjectContext must be created first.
From the context a store can be created or opened. The store provides methods to create and
fetch dynamic objects.</p>
<div class="highlight-python"><pre>var dataObjectContext = BrightstarService.GetDataObjectContext();
// create a dynamic context
var dynaContext = new BrightstarDynamicContext(dataObjectContext);
// create a new store
var storeId = "DynamicSample" + Guid.NewGuid().ToString();
var dynaStore = dynaContext.CreateStore(storeId);</pre>
</div>
</div>
<div class="section" id="dynamic-object">
<h3>Dynamic Object<a class="headerlink" href="#dynamic-object" title="Permalink to this headline">¶</a></h3>
<p>The dynamic object is a wrapper around the IDataObject. When a dynamic property is set this is
translated into an update to the IDataObject and in turn into RDF. By default the name of the
property is appended to &nbsp;the default namespace. By using namespace mappings any RDF vocabulary
can be mapped. If the value of the property is set to be a list of values then multiple
triples are created, one for each value.</p>
<div class="highlight-python"><pre>dynamic brightstar = dynaStore.MakeNewObject();
brightstar.name = "BrightstarDB";</pre>
</div>
<div class="highlight-python"><pre>// namespaces are used by having the prefix comes before '__'
// setting a list of values creates multiple properties on the object.
brightstar.rdfs__label = new[] { "BrightstarDB", "NoSQL Database" };</pre>
</div>
<div class="highlight-python"><pre>dynamic product = dynaStore.MakeNewObject();
// objects are connected together in the same way
brightstar.rdfs__type = product;</pre>
</div>
</div>
<div class="section" id="saving-changes">
<h3>Saving Changes<a class="headerlink" href="#saving-changes" title="Permalink to this headline">¶</a></h3>
<p>The data updated in a context is persisted when SaveChanges is called on the store object.</p>
<div class="highlight-python"><div class="highlight"><pre><span class="n">dynaStore</span><span class="o">.</span><span class="n">SaveChanges</span><span class="p">();</span>
</pre></div>
</div>
</div>
<div class="section" id="loading-data">
<h3>Loading Data<a class="headerlink" href="#loading-data" title="Permalink to this headline">¶</a></h3>
<p>After opening a store dynamic objects can be loaded via the GetDataObject method or the
BindObjectsWithSparql method.</p>
<div class="highlight-python"><pre>dynaStore = dynaContext.OpenStore(storeId);
var object = dynaStore.GetDataObject(aUri);


// any sparql that returns a single variable can be bound as dynamic objects
var objects = dynaStore.BindObjectsWithSparql("select distinct ?dy where { ?dy ?p ?o }");</pre>
</div>
</div>
<div class="section" id="id30">
<span id="id31"></span><h3>Sample Program<a class="headerlink" href="#id30" title="Permalink to this headline">¶</a></h3>
<div class="admonition note">
<p class="first admonition-title">Note</p>
<p class="last">The source code for this example can be found in [INSTALLDIR]\Samples\Dynamic\Dynamic.sln</p>
</div>
<div class="highlight-python"><pre>using System;
using System.Collections.Generic;
using System.Linq;
using System.Text;
using BrightstarDB.Dynamic;
using BrightstarDB.Client;


namespace DynamicSamples
{
    public class Program
    {
        /// &lt;summary&gt;
        /// Assumes BrightstarDB is running as a service and exposing the default endpoint</pre>
</div>
<dl class="docutils">
<dt>at <a class="reference external" href="http://localhost:8090/brightstar">http://localhost:8090/brightstar</a></dt>
<dd><p class="first">/// &lt;/summary&gt;
/// &lt;param name=&#8221;args&#8221;&gt;&lt;/param&gt;
static void Main(string[] args)
{</p>
<blockquote class="last">
<div><p>// gets a new BrightstarDB DataObjectContext
var dataObjectContext = BrightstarService.GetDataObjectContext();</p>
<p>// create a dynamic context
var dynaContext = new BrightstarDynamicContext(dataObjectContext);</p>
<p>// open a new store
var storeId = &#8220;DynamicSample&#8221; + Guid.NewGuid().ToString();
var dynaStore = dynaContext.CreateStore(storeId);</p>
<p>// create some dynamic objects.
dynamic brightstar = dynaStore.MakeNewObject();
dynamic product = dynaStore.MakeNewObject();</p>
<p>// set some properties
brightstar.name = &#8220;BrightstarDB&#8221;;
product.rdfs__label = &#8220;Product&#8221;;
var id = brightstar.Identity;</p>
<p>// use namespace mapping (RDF and RDFS are defined by default)
// Assigning a list creates repeated RDF properties.
brightstar.rdfs__label = new[] { &#8220;BrightstarDB&#8221;, &#8220;NoSQL Database&#8221; };</p>
<p>// objects are connected together in the same way
brightstar.rdfs__type = product;</p>
<p>dynaStore.SaveChanges();</p>
<p>// open store and read some data
dynaStore = dynaContext.OpenStore(storeId);
brightstar = dynaStore.GetDataObject(brightstar.Identity);</p>
<p>// property values are ALWAYS collections.
var name = brightstar.name.FirstOrDefault();
Console.WriteLine(&#8220;Name = &#8221; + name);</p>
<p>// property can also be accessed by index
var nameByIndex = brightstar.name[0];
Console.WriteLine(&#8220;Name = &#8221; + nameByIndex);</p>
<p>// they can be enumerated without a cast
foreach (var l in brightstar.rdfs__label)
{</p>
<blockquote>
<div>Console.WriteLine(&#8220;Label = &#8221; + l);</div></blockquote>
<p>}</p>
<p>// object relationships are navigated in the same way
var p = brightstar.rdfs__type.FirstOrDefault();
Console.WriteLine(p.rdfs__label.FirstOrDefault());</p>
<p>// dynamic objects can also be loaded via sparql
dynaStore = dynaContext.OpenStore(storeId);
var objects = dynaStore.BindObjectsWithSparql(&#8220;select distinct ?dy where { ?dy</p>
</div></blockquote>
</dd>
<dt>?p ?o }&#8221;);</dt>
<dd><blockquote class="first">
<div><blockquote>
<div><blockquote>
<div><p>foreach (var obj in objects)
{</p>
<blockquote>
<div>Console.WriteLine(obj.rdfs__label[0]);</div></blockquote>
<p>}</p>
<p>Console.ReadLine();</p>
</div></blockquote>
<p>}</p>
</div></blockquote>
<p>}</p>
</div></blockquote>
<p class="last">}</p>
</dd>
</dl>
</div>
</div>
<div class="section" id="rdf-client-api">
<span id="id32"></span><h2>RDF Client API<a class="headerlink" href="#rdf-client-api" title="Permalink to this headline">¶</a></h2>
<p>The RDF Client API provides a simple set of methods for creating and deleting stores,
executing transactions and running queries. It should be used when the application needs to
deal directly &nbsp;with RDF data. &nbsp;A RDF Client can connect to an embedded store or remotely to a
running BrightstarDB instance.</p>
<div class="section" id="creating-a-client">
<h3>Creating a client<a class="headerlink" href="#creating-a-client" title="Permalink to this headline">¶</a></h3>
<p>The BrightstarService class provides a number of static methods that can be used to create a
new client. The most general one takes a connection string as a parameter and returns a client
object. The client implements BrightstarDB.IBrightstarService.</p>
<p>The following example shows how to create a new service client using a connection string:</p>
<div class="highlight-python"><pre>var client = BrightstarService.GetClient("Type=http;endpoint=</pre>
</div>
<p><a class="reference external" href="http://localhost:8090/brightstar">http://localhost:8090/brightstar</a>;&#8221;);</p>
<p>For more information about connection strings, please read the <a class="reference internal" href="#connection-strings"><em>&#8220;Connection Strings&#8221;
topic</em></a></p>
</div>
<div class="section" id="id35">
<h3>Creating a Store<a class="headerlink" href="#id35" title="Permalink to this headline">¶</a></h3>
<p>A new store can be creating using the following code:</p>
<div class="highlight-python"><pre>string storeName = "Store_" + Guid.NewGuid();
client.CreateStore(storeName);</pre>
</div>
</div>
<div class="section" id="id36">
<h3>Deleting a Store<a class="headerlink" href="#id36" title="Permalink to this headline">¶</a></h3>
<p>Deleting a store is also straight forward:</p>
<div class="highlight-python"><div class="highlight"><pre><span class="n">client</span><span class="o">.</span><span class="n">DeleteStore</span><span class="p">(</span><span class="n">storeName</span><span class="p">);</span>
</pre></div>
</div>
</div>
<div class="section" id="adding-data">
<h3>Adding data<a class="headerlink" href="#adding-data" title="Permalink to this headline">¶</a></h3>
<p>Data is added to the store by sending the data to add in N-Triples format. Each triple must be
on a single line with no line breaks, a good way to do this is to use a StringBuilder and then
using AppendLine for each triple:</p>
<div class="highlight-python"><pre>var data = new StringBuilder();
data.AppendLine("&lt;http://www.brightstardb.com/products/brightstar&gt;</pre>
</div>
<dl class="docutils">
<dt>&lt;<a class="reference external" href="http://www.brightstardb.com/schemas/product/name">http://www.brightstardb.com/schemas/product/name</a>&gt; \&#8221;BrightstarDB\&#8221; .&#8221;);</dt>
<dd>data.AppendLine(&#8220;&lt;<a class="reference external" href="http://www.brightstardb.com/products/brightstar">http://www.brightstardb.com/products/brightstar</a>&gt;</dd>
</dl>
<p>&lt;<a class="reference external" href="http://www.brightstardb.com/schemas/product/category">http://www.brightstardb.com/schemas/product/category</a>&gt;
&lt;<a class="reference external" href="http://www.brightstardb.com/categories/nosql">http://www.brightstardb.com/categories/nosql</a>&gt; .&#8221;);</p>
<blockquote>
<div>data.AppendLine(&#8220;&lt;<a class="reference external" href="http://www.brightstardb.com/products/brightstar">http://www.brightstardb.com/products/brightstar</a>&gt;</div></blockquote>
<p>&lt;<a class="reference external" href="http://www.brightstardb.com/schemas/product/category">http://www.brightstardb.com/schemas/product/category</a>&gt;
&lt;<a class="reference external" href="http://www.brightstardb.com/categories/.net">http://www.brightstardb.com/categories/.net</a>&gt; .&#8221;);</p>
<blockquote>
<div>data.AppendLine(&#8220;&lt;<a class="reference external" href="http://www.brightstardb.com/products/brightstar">http://www.brightstardb.com/products/brightstar</a>&gt;</div></blockquote>
<p>&lt;<a class="reference external" href="http://www.brightstardb.com/schemas/product/category">http://www.brightstardb.com/schemas/product/category</a>&gt;
&lt;<a class="reference external" href="http://www.brightstardb.com/categories/rdf">http://www.brightstardb.com/categories/rdf</a>&gt; .&#8221;);</p>
<p>The ExecuteTransaction() method is used to insert the N-Triples data into the store:</p>
<div class="highlight-python"><div class="highlight"><pre><span class="n">client</span><span class="o">.</span><span class="n">ExecuteTransaction</span><span class="p">(</span><span class="n">storeName</span><span class="p">,</span><span class="n">null</span><span class="p">,</span> <span class="n">null</span><span class="p">,</span> <span class="n">data</span><span class="o">.</span><span class="n">ToString</span><span class="p">());</span>
</pre></div>
</div>
</div>
<div class="section" id="id37">
<h3>Querying data using SPARQL<a class="headerlink" href="#id37" title="Permalink to this headline">¶</a></h3>
<p>BrightstarDB supports <a class="reference external" href="http://www.w3.org/TR/sparql11-query/">SPARQL 1.1</a> for querying the data in the store. A simple query on the
N-Triples above that returns all categories that the subject called &#8220;Brightstar DB&#8221; is
connected to would look like this:</p>
<div class="highlight-python"><pre>var query = "SELECT ?category WHERE { &lt;http://www.brightstardb.com/products/brightstar&gt; &lt;</pre>
</div>
<p><a class="reference external" href="http://www.brightstardb.com/schemas/product/category">http://www.brightstardb.com/schemas/product/category</a>&gt; ?category }&#8221;;</p>
<p>This string query can then be used by the ExecuteQuery() method to create an XDocument from
the SPARQL results (See <a class="reference external" href="http://www.w3.org/TR/rdf-sparql-XMLres/">http://www.w3.org/TR/rdf-sparql-XMLres/</a> for the XML format
returned).</p>
<div class="highlight-python"><pre>var result = XDocument.Load(client.ExecuteQuery(storeName, query));</pre>
</div>
<p>BrightstarDB supports several different formats for SPARQL results. The default format is XML,
but you can also add a BrightstarDB.SparqlResultsFormat parameter to the ExecuteQuery method
to control the format and encoding of the results set. For example:</p>
<div class="highlight-python"><pre>var jsonResult = client.ExecuteQuery(storeName, query, SparqlResultsFormat.Json);</pre>
</div>
<p>By default results are returned using UTF-8 encoding; however you can override this default
behaviour by using the WithEncoding() method on the SparqlResultsFormat class. The
WithEncoding() method takes a System.Text.Encoding instance and returns a SparqlResultsFormat
instance that will ask for that specific encoding.</p>
<div class="highlight-python"><pre>var unicodeXmlResult = client.ExecuteQuery(storeName, query,</pre>
</div>
<p>SparqlResultsFormat.Xml.WithEncoding(Encoding.Unicode));</p>
</div>
<div class="section" id="update-data-using-sparql">
<h3>Update data using SPARQL<a class="headerlink" href="#update-data-using-sparql" title="Permalink to this headline">¶</a></h3>
<p>BrightstarDB supports <a class="reference external" href="http://www.w3.org/TR/sparql11-update/">SPARQL 1.1 Update</a> for updating data in the store. An update operation
is submitted to BrightstarDB as a job. By default the call to ExecuteUpdate will block until
the update job completes:</p>
<div class="highlight-python"><pre>IJobInfo jobInfo = _client.ExecuteUpdate(storeName, updateExpression);</pre>
</div>
<p>In this case, the resulting IJobInfo object will describe the final state of the update job.
However, you can also run the job asynchronously by passing false for the optional
waitForCompletion parameter:</p>
<div class="highlight-python"><pre>IJobInfo jobInfo = _client.ExecuteUpdate(storeName, updateExpression, false);</pre>
</div>
<p>In this case the resulting IJobInfo object will describe the current state of the update job
and you can use calls to GetJobInfo to poll the job for its current status.</p>
</div>
<div class="section" id="using-extension-methods">
<h3>Using extension methods<a class="headerlink" href="#using-extension-methods" title="Permalink to this headline">¶</a></h3>
<p>To make working with the resulting XDocument easier there exist a number of extensions
methods. The first method is called XDocument.SparqlResultRows() and returns XElements where
each XElement represents a single result row.</p>
<div class="highlight-python"><pre>foreach (var sparqlResultRow in result.SparqlResultRows())
{
   var val = sparqlResultRow.GetColumnValue("category");
   Console.WriteLine("Category is " + val);
}</pre>
</div>
<p>GetColumnValue takes the name of the SPARQL result column and returns the string value. There
are also methods to test if the object is a literal, IsLiteral(string column), and retrieve
the data type and language code.</p>
</div>
<div class="section" id="deleting-data">
<h3>Deleting data<a class="headerlink" href="#deleting-data" title="Permalink to this headline">¶</a></h3>
<p>Deletion is done by defining a pattern that should matching the triples to be deleted. The
following example deletes all the category data about BrightstarDB, again we use the
StringBuilder to create the delete pattern.</p>
<div class="highlight-python"><pre>var deletePatternsData = new StringBuilder();
deletePatternsData.AppendLine("&lt;http://www.brightstardb.com/products/brightstar&gt; &lt;</pre>
</div>
<p><a class="reference external" href="http://www.brightstardb.com/schemas/product/category">http://www.brightstardb.com/schemas/product/category</a>&gt; &lt;
<a class="reference external" href="http://www.brightstardb.com/.well-known/model/wildcard">http://www.brightstardb.com/.well-known/model/wildcard</a>&gt; .&#8221;);</p>
<p>The delete pattern uses a special Resource identifier that can be used as a wildcard: ``
<a class="reference external" href="http://www.brightstardb.com/.well-known/model">http://www.brightstardb.com/.well-known/model</a>/wildcard``</p>
<p>The ExecuteTransaction() method is used to delete the data from the store</p>
<div class="highlight-python"><div class="highlight"><pre><span class="n">client</span><span class="o">.</span><span class="n">ExecuteTransaction</span><span class="p">(</span><span class="n">storeName</span><span class="p">,</span> <span class="n">null</span><span class="p">,</span> <span class="n">deletePatternsData</span><span class="o">.</span><span class="n">ToString</span><span class="p">(),</span> <span class="n">null</span><span class="p">);</span>
</pre></div>
</div>
<div class="admonition note">
<p class="first admonition-title">Note</p>
<p class="last">ExecuteTransaction is blocking by default. To run asynchronously an additional parameter can</p>
</div>
<p>be passed in.</p>
</div>
<div class="section" id="data-types">
<h3>Data Types<a class="headerlink" href="#data-types" title="Permalink to this headline">¶</a></h3>
<p>In the code above we used simple triples to add a literal object to a subject, such as:</p>
<div class="highlight-python"><pre>&lt;http://www.brightstardb.com/products/brightstar&gt; &lt;</pre>
</div>
<p><a class="reference external" href="http://www.brightstardb.com/schemas/product/name">http://www.brightstardb.com/schemas/product/name</a>&gt; &#8220;BrightstarDB&#8221;</p>
<p>Other data types can be used by using the ^^ syntax:</p>
<div class="highlight-python"><pre>&lt;http://www.brightstardb.com/products/brightstar&gt; &lt;</pre>
</div>
<p><a class="reference external" href="http://www.brightstardb.com/schemas/product/productCode">http://www.brightstardb.com/schemas/product/productCode</a>&gt; &#8220;640&#8221;^^&lt;
<a class="reference external" href="http://www.w3.org/2001/XMLSchema#integer">http://www.w3.org/2001/XMLSchema#integer</a>&gt; .</p>
<blockquote>
<div>&lt;<a class="reference external" href="http://www.brightstardb.com/products/brightstar">http://www.brightstardb.com/products/brightstar</a>&gt; &lt;</div></blockquote>
<p><a class="reference external" href="http://www.brightstardb.com/schemas/product/releaseDate">http://www.brightstardb.com/schemas/product/releaseDate</a>&gt; &#8220;2011-11-11 12:00&#8221;^^&lt;
<a class="reference external" href="http://www.w3.org/2001/XMLSchema#dateTime">http://www.w3.org/2001/XMLSchema#dateTime</a>&gt; .</p>
<blockquote>
<div>&lt;<a class="reference external" href="http://www.brightstardb.com/products/brightstar">http://www.brightstardb.com/products/brightstar</a>&gt; &lt;</div></blockquote>
<p><a class="reference external" href="http://www.brightstardb.com/schemas/product/cost">http://www.brightstardb.com/schemas/product/cost</a>&gt; &#8220;0.00&#8221;^^&lt;
<a class="reference external" href="http://www.w3.org/2001/XMLSchema#decimal">http://www.w3.org/2001/XMLSchema#decimal</a>&gt; .</p>
</div>
<div class="section" id="conditional-updates">
<h3>Conditional Updates<a class="headerlink" href="#conditional-updates" title="Permalink to this headline">¶</a></h3>
<p>The execution of a transaction can be made conditional on certain triples existing in the
store. The following example updates the productCode property of a resource only if its
current value is 640.</p>
<div class="highlight-python"><pre>var preconditions = new StringBuilder();
preconditions.AppendLine("&lt;http://www.brightstardb.com/products/brightstar&gt;</pre>
</div>
<p>&lt;<a class="reference external" href="http://www.brightstardb.com/schemas/product/productCode">http://www.brightstardb.com/schemas/product/productCode</a>&gt;
&#8220;640&#8221;^^&lt;<a class="reference external" href="http://www.w3.org/2001/XMLSchema#integer">http://www.w3.org/2001/XMLSchema#integer</a>&gt; .&#8221;);</p>
<blockquote>
<div>var deletes = new StringBuilder();
preconditions.AppendLine(&#8220;&lt;<a class="reference external" href="http://www.brightstardb.com/products/brightstar">http://www.brightstardb.com/products/brightstar</a>&gt;</div></blockquote>
<p>&lt;<a class="reference external" href="http://www.brightstardb.com/schemas/product/productCode">http://www.brightstardb.com/schemas/product/productCode</a>&gt;
&#8220;640&#8221;^^&lt;<a class="reference external" href="http://www.w3.org/2001/XMLSchema#integer">http://www.w3.org/2001/XMLSchema#integer</a>&gt; .&#8221;);</p>
<blockquote>
<div>var inserts = new StringBuilder();
preconditions.AppendLine(&#8220;&lt;<a class="reference external" href="http://www.brightstardb.com/products/brightstar">http://www.brightstardb.com/products/brightstar</a>&gt;</div></blockquote>
<p>&lt;<a class="reference external" href="http://www.brightstardb.com/schemas/product/productCode">http://www.brightstardb.com/schemas/product/productCode</a>&gt;
&#8220;973&#8221;^^&lt;<a class="reference external" href="http://www.w3.org/2001/XMLSchema#integer">http://www.w3.org/2001/XMLSchema#integer</a>&gt; .&#8221;);</p>
<blockquote>
<div>client.ExecuteTransaction(storeName, preconditions.ToString(), deletes.ToString(),</div></blockquote>
<p>inserts.ToString());</p>
<p>When a transaction contains condition triples, every triple specified in the preconditions
must exist in the store before the transaction is applied. If one or more triples specified in
the preconditions are not found, a BrightstarClientException will be raised.</p>
</div>
<div class="section" id="data-imports">
<h3>Data Imports<a class="headerlink" href="#data-imports" title="Permalink to this headline">¶</a></h3>
<p>To support the loading of large data sets BrightstarDB provides an import function. Before
invoking the import function via the client API the data to be imported should be copied into
a folder called &#8216;import&#8217;. The &#8216;import&#8217; folder should be located in the folder containing the
BrigtstarDB store data folders. After a default installation the stores folder is
[INSTALLDIR]\Data, thus the import folder should be [INSTALLDIR]\Data\import. For information
about the RDF syntaxes that BrightstarDB supports for import, please refer to <a class="reference internal" href="Supported_RDF_Syntaxes.html#supported-rdf-syntaxes"><em>Supported
RDF Syntaxes</em></a>.</p>
<p>With the data copied into the folder the following client method can be called. The parameter
is the name of the file that was copied into the import folder.</p>
<div class="highlight-python"><div class="highlight"><pre><span class="n">client</span><span class="o">.</span><span class="n">StartImport</span><span class="p">(</span><span class="s">&quot;data.nt&quot;</span><span class="p">);</span>
</pre></div>
</div>
</div>
<div class="section" id="introduction-to-n-triples">
<span id="introduction-to-ntriples"></span><h3>Introduction To N-Triples<a class="headerlink" href="#introduction-to-n-triples" title="Permalink to this headline">¶</a></h3>
<p><a class="reference external" href="http://www.w3.org/TR/xmlschema-2/#built-in-primitive-datatypes">http://www.w3.org/TR/xmlschema-2/#built-in-primitive-datatypes</a></p>
<p>N-Triples is a consistent and simple way to encode RDF triples. N-Triples is a line based
format. Each N-Triples line encodes one RDF triple. Each line consists of the subject (a URI),
followed &nbsp;by whitespace, the predicate (a URI), more whitespace, and then the object (a URI or
literal) followed by a dot and a new line. The encoding of the literal may include a datatype
or language code as well as the value. URIs are enclosed in &#8216;&lt;&#8217; &#8216;&gt;&#8217; brackets. The formal
definition of the N-Triples format can be found <a class="reference external" href="http://www.w3.org/TR/rdf-testcases/#ntriples">here</a>.</p>
<p>The following are examples of N-Triples data.</p>
<div class="highlight-python"><pre># simple literal property
&lt;http://www.brightstardb.com/products/brightstar&gt; &lt;</pre>
</div>
<p><a class="reference external" href="http://www.brightstardb.com/schemas/product/name">http://www.brightstardb.com/schemas/product/name</a>&gt; &#8220;Brightstar DB&#8221; .</p>
<blockquote>
<div># relationship between two resources
&lt;<a class="reference external" href="http://www.brightstardb.com/products/brightstar">http://www.brightstardb.com/products/brightstar</a>&gt; &lt;</div></blockquote>
<p><a class="reference external" href="http://www.brightstardb.com/schemas/product/category">http://www.brightstardb.com/schemas/product/category</a>&gt; &lt;
<a class="reference external" href="http://www.brightstardb.com/categories/nosql">http://www.brightstardb.com/categories/nosql</a>&gt; .</p>
<blockquote>
<div># data type example for integer value
&lt;<a class="reference external" href="http://www.brightstardb.com/products/brightstar">http://www.brightstardb.com/products/brightstar</a>&gt; &lt;</div></blockquote>
<p><a class="reference external" href="http://www.brightstardb.com/schemas/product/productCode">http://www.brightstardb.com/schemas/product/productCode</a>&gt; &#8220;640&#8221;^^&lt;
<a class="reference external" href="http://www.w3.org/2001/XMLSchema#integer">http://www.w3.org/2001/XMLSchema#integer</a>&gt; .</p>
<blockquote>
<div>&lt;<a class="reference external" href="http://www.brightstardb.com/products/brightstar">http://www.brightstardb.com/products/brightstar</a>&gt; &lt;</div></blockquote>
<p><a class="reference external" href="http://www.brightstardb.com/schemas/product/releaseDate">http://www.brightstardb.com/schemas/product/releaseDate</a>&gt; &#8220;2011-11-11 12:00&#8221;^^&lt;
<a class="reference external" href="http://www.w3.org/2001/XMLSchema#dateTime">http://www.w3.org/2001/XMLSchema#dateTime</a>&gt; .</p>
<blockquote>
<div>&lt;<a class="reference external" href="http://www.brightstardb.com/products/brightstar">http://www.brightstardb.com/products/brightstar</a>&gt; &lt;</div></blockquote>
<p><a class="reference external" href="http://www.brightstardb.com/schemas/product/cost">http://www.brightstardb.com/schemas/product/cost</a>&gt; &#8220;0.00&#8221;^^&lt;
<a class="reference external" href="http://www.w3.org/2001/XMLSchema#decimal">http://www.w3.org/2001/XMLSchema#decimal</a>&gt; .</p>
<p><strong>Allowed Data Types</strong></p>
<p>Data types are defined in terms of an identifier. Common data types use the XML Schema
identifiers. The prefix of these is:</p>
<div class="highlight-python"><pre>http://www.w3.org/2001/XMLSchema#</pre>
</div>
<p>And the common primitive datatypes are defined in <a href="#id44"><span class="problematic" id="id45">`XML Schema Part 2: Datatypes Second
Edition`_</span></a>.</p>
</div>
<div class="section" id="introduction-to-sparql">
<span id="id38"></span><h3>Introduction To SPARQL<a class="headerlink" href="#introduction-to-sparql" title="Permalink to this headline">¶</a></h3>
<p>BrightstarDB is a triple store that implements the RDF and SPARQL standards. SPARQL,
pronounced &#8220;sparkle&#8221;, is the query language developer by the W3C for querying RDF data. SPARQL
primarily uses pattern matching as a query mechanism. A short example follows:</p>
<div class="highlight-python"><pre>PREFIX ont: &lt;`http://www.brightstardb.com/schemas/`_&gt;
SELECT ?name ?description WHERE {
  ?product a ont:Product .
  ?product ont:name ?name .
  ?product ont:description ?description .
}</pre>
</div>
<p>This query is asking for all the names and descriptions of all products in the store.</p>
<p>SELECT is used to specify which bound variables should appear in the result set. The result of
this query is a table with two columns, one called &#8220;name&#8221; and the other &#8220;description&#8221;.</p>
<p>The PREFIX notation is used so that the query itself is more readable. Full URIs can be used
in the query. When included in the query directly URIs are enclosed by &#8216;&lt;&#8217; and &#8216;&gt;&#8217;.</p>
<p>Variables are specified with the &#8216;?&#8217; character in front of the variable name.</p>
<p>In the above example if a product did not have a description then it would not appear in the
results even if it had a name. If the intended result was to retrieve all products with their
name and the description if it existed then the OPTIONAL keyword can be used.</p>
<div class="highlight-python"><pre>PREFIX ont: &lt;`http://www.brightstardb.com/schemas/`_&gt;
SELECT ?name ?description WHERE {
  ?product a ont:Product .
  ?product ont:name ?name .

  OPTIONAL {
    ?product ont:description ?description .
  }
}</pre>
</div>
<p>For more information on SPARQL 1.1 (BrightstarDB supports many 1.1 features) and more
tutorials the following resources are worth reading.</p>
<blockquote>
<div><ol class="arabic simple">
<li><a class="reference external" href="http://www.w3.org/TR/sparql11-query/">SPARQL 1.1 Query Language</a></li>
<li><a class="reference external" href="http://www.w3.org/2004/Talks/17Dec-sparql/">Introduction to RDF Query with SPARQL Tutorial</a></li>
</ol>
</div></blockquote>
</div>
</div>
<div class="section" id="developing-for-windows-phone">
<span id="developing-for-windows-phone-7"></span><h2>Developing for Windows Phone<a class="headerlink" href="#developing-for-windows-phone" title="Permalink to this headline">¶</a></h2>
<p>For Windows Phone 7 and Windows Phone 8 (WP) developers, BrightstarDB provides a fast,
schema-less persistent data store, that is easily managed as part of the isolated storage for
an app. When running on a phone, all the key features of BrighstarDB are available, including
the <a class="reference internal" href="#data-object-layer"><em>Data Object Layer</em></a> and the <a class="reference internal" href="#entity-framework"><em>Entity Framework</em></a> as well as the <a class="reference internal" href="#rdf-client-api"><em>RDF Client API</em></a>. This section covers
the main differences with the .NET 4.0 version of BrightstarDB and some important
considerations when writing your WP7 app to use BrightstarDB. The SDK provides libraries that
are compatible with Windows Phone 7.1 and Windows Phone 8, so all apps you develop with
BrightstarDB will need to target that version of the Windows Phone OS.</p>
<div class="section" id="data-storage-and-connection-strings">
<h3>Data Storage And Connection Strings<a class="headerlink" href="#data-storage-and-connection-strings" title="Permalink to this headline">¶</a></h3>
<p>When running on WP, BrightstarDB writes its data using the IsolatedStorage APIs. This means
that a BrightstarDB store opened within an application will be written into the
IsolatedStorage for that application. This keeps the stores used by different applications
separate from each other. An application can also use multiple stores, as long as each store
has a unique store name. As the BrightstarDB server is not running on the phone, the only
access to the store is by using the embedded connection type. A typical connection string used
in a WP application is shown in the code snippet below::</p>
<div class="highlight-python"><pre>var connectionString = "type=embedded;storesdirectory=brightstar;storename=MyAppStore";</pre>
</div>
</div>
<div class="section" id="sdk-libraries">
<h3>SDK Libraries<a class="headerlink" href="#sdk-libraries" title="Permalink to this headline">¶</a></h3>
<p>The BrightstarDB libraries for WP are all contained in [INSTALLDIR]\SDK\WP71. You need to add
references to these libraries to your WP application project.</p>
</div>
<div class="section" id="development-considerations">
<h3>Development Considerations<a class="headerlink" href="#development-considerations" title="Permalink to this headline">¶</a></h3>
<p>For the most part, working with BrightstarDB on Windows Phone is the same as working with it
on the full .NET Framework. However due to the platform and some .NET restrictions there are a
few things that you need to keep in mind when building your application.</p>
<p>Store Shutdown</p>
<p>Because BrightstarDB uses separate threads to process updates to its stores, it is necessary
for any WP app that uses BrightstarDB to cleanly shutdown the database when the application is
not in use. The easiest way to achieve this is to add code to the Application_Deactivated and
Application_Closing methods in the main application class as shown below. There is no
corresponding global startup required as BrightstarDB will automatically start the required
threads the first time you access a store.</p>
<div class="highlight-python"><pre>// Code to execute when the application is deactivated (sent to background)
// This code will not execute when the application is closing
private void Application_Deactivated(object sender, DeactivatedEventArgs e)
{
    BrightstarService.Shutdown(true);
}


// Code to execute when the application is closing (eg, user hit Back)
// This code will not execute when the application is deactivated
private void Application_Closing(object sender, ClosingEventArgs e)
{
    BrightstarService.Shutdown(true);
}</pre>
</div>
<p>EntityFramework Interfaces Must Be Public</p>
<p>Due to differences between the .NET Framework and Silverlight, there are is one known
limitation on the Entity Framework. All interfaces that are marked with the [Entity] attribute
must be public interfaces when building a Windows Phone application. This is because
Silverlight prevents reflection on internal classes / interfaces for reasons of code security.</p>
</div>
<div class="section" id="deploying-a-reference-store">
<span id="id40"></span><h3>Deploying a Reference Store<a class="headerlink" href="#deploying-a-reference-store" title="Permalink to this headline">¶</a></h3>
<p>As well as using BrightstarDB to store user-modifiable data, you can also ship reference data
with your application. A BrightstarDB reference store can be embedded as part of your
application content and deployed to the Isolated Storage on the mobile device. Once deployed,
the store can be queried and/or updated through your code as normal. The basic steps to
deploying a store in a mobile application are as follows:</p>
<blockquote>
<div><ol class="arabic simple">
<li>Create the reference store</li>
<li>Add the reference store files to your application and compile it</li>
<li>Deploy the application to the device</li>
<li>At runtime, copy the reference store files from the application directory to Isolated</li>
</ol>
</div></blockquote>
<p>Storage</p>
<blockquote>
<div><ol class="arabic simple">
<li>Access the copied store from your code</li>
</ol>
</div></blockquote>
<div class="section" id="create-the-reference-store">
<h4>Create The Reference Store<a class="headerlink" href="#create-the-reference-store" title="Permalink to this headline">¶</a></h4>
<p>BrightstarDB stores are fully portable between the desktop and a mobile device through simple
file copy. You can create and update a BrightstarDB database using a .NET application on a
desktop workstation or a server and use the database files on a mobile device without the need
for any conversion.</p>
<div class="admonition note">
<p class="first admonition-title">Note</p>
<p class="last">If the database you are deploying has been through a number of update transactions you may</p>
</div>
<p>want to consider creating a coalesced copy of the database for deployment purposes.
Coalescing the database will reduce the database size by copying only the current state of
the database and removing all the historical states of the data.</p>
</div>
<div class="section" id="add-database-file-to-your-application">
<h4>Add Database File To Your Application<a class="headerlink" href="#add-database-file-to-your-application" title="Permalink to this headline">¶</a></h4>
<p>Every BrightstarDB store exists in its own folder and contains at least the following files:</p>
<blockquote>
<div><ul class="simple">
<li>master.bs</li>
<li>data.bs</li>
<li>resources.bs</li>
<li>transactionheaders.bs</li>
<li>transactions.bs</li>
</ul>
</div></blockquote>
<p>For normal operation you only need to add the master.bs, resources.bs and data.bs files to
your solution. The transactionheaders.bs and transactions.bs files are required only if your
application will need to replay the transactions that built the database.</p>
<p>To add the reference database to your application</p>
<blockquote>
<div><ol class="arabic simple">
<li>With Visual Studio, create a project for the Windows Phone application that consumes the</li>
</ol>
</div></blockquote>
<p>reference store.</p>
<blockquote>
<div><ol class="arabic simple">
<li>From the Project menu of the application, select Add Existing Item.</li>
<li>From the Add Existing Item menu, select the master.bs file for the BrightstarDB store</li>
</ol>
</div></blockquote>
<p>that you want to add, then click Add. This will add the local file to the project.</p>
<blockquote>
<div><ol class="arabic simple">
<li>In Solution Explorer, right-click the local file and set the file properties so that the</li>
</ol>
</div></blockquote>
<p>file is built as Content and always copied to the output directory (Copy always).</p>
<blockquote>
<div><ol class="arabic simple">
<li>Repeat steps 3 and 4 for the data.bs file and resources.bs file</li>
<li>Optionally repeat steps 3 and 4 for transactionheaders.bs and transactions.bs</li>
</ol>
</div></blockquote>
<div class="admonition note">
<p class="first admonition-title">Note</p>
<p class="last">It is good practice to put the BrightstarDB data files you are copying into a folder under</p>
</div>
<p>your project. If you want to deploy multiple reference databases, you will have to put the
files for each store in a separate folder to avoid name clashes. The folders you define in
your project will be mirrored in the installation directory when the application is deployed.</p>
</div>
<div class="section" id="deploy-application">
<h4>Deploy Application<a class="headerlink" href="#deploy-application" title="Permalink to this headline">¶</a></h4>
<p>Compile and deploy your application as normal. The store files you have copied will be
available in the installation directory of the application (under the folders that you created
in the project if applicable).</p>
</div>
<div class="section" id="copy-database-files-to-isolated-storage">
<h4>Copy Database Files To Isolated Storage<a class="headerlink" href="#copy-database-files-to-isolated-storage" title="Permalink to this headline">¶</a></h4>
<p>BrightstarDB on a mobile device will only access stores from a named directory in the
application&#8217;s Isolated Storage. It is therefore necessary when your application starts up to
ensure that the data is copied or moved to Isolated Storage. Each BrightstarDB store you
deploy must be in its own named directory, and those directories must in turn be in a named
directory under the Isolated Storage root folder. These directory names are important as they
form the values in the connection string you provide to BrightstarDB. The directory structure
used by the sample application is shown below:</p>
<div class="highlight-python"><pre>IsolatedStorageFile Root
|
+-brightstar    &lt;-- the storesDirectory value in the connection string, create a sub
  |                 create one sub-directory for each store you want to access
  |
  +-dining      &lt;-- the storeName value in the connection string,                     only</pre>
</div>
<p>the files for a single store should go in here</p>
<p>The precise way you choose to deploy or update the BrightstarDB store files is up to you, but
the simplest method (as shown in the sample code) is to check for the presence of the store
and if it is not there, copy the files from the application installation directory to Isolated
Storage. The code to do this in the sample can be found in the App() constructor in the
App.xaml.cs file:</p>
<div class="highlight-python"><pre>if (!BrightstarDbDeploymentHelper.StoreExists("brightstar", "dining"))
{
    BrightstarDbDeploymentHelper.CopyStore("data", "brightstar", "dining");
}</pre>
</div>
<p>The helper class can also be found in the sample project and has the following methods:</p>
<div class="highlight-python"><pre>public static class BrightstarDbDeploymentHelper
{
    public static bool StoreExists(string storeDirectoryName, string storeName)
    {
        IsolatedStorageFile iso = IsolatedStorageFile.GetUserStoreForApplication();
        return iso.DirectoryExists(storeDirectoryName + "\\\\" + storeName) &amp;&amp;
               iso.FileExists(storeDirectoryName + "\\\\" + storeName + "\\\\master.bs") &amp;&amp;
               iso.FileExists(storeDirectoryName + "\\\\" + storeName + "\\\\resources.bs") &amp;&amp;
               iso.FileExists(storeDirectoryName + "\\\\" + storeName + "\\\\data.bs");
    }


    public static void CopyStore(string resourceFolderPath, string storeDirectoryName,</pre>
</div>
<dl class="docutils">
<dt>string storeName)</dt>
<dd><dl class="first docutils">
<dt>{</dt>
<dd>IsolatedStorageFile iso = IsolatedStorageFile.GetUserStoreForApplication();
CopyStoreFile(iso, &#8220;data.bs&#8221;, resourceFolderPath, storeDirectoryName, storeName);
CopyStoreFile(iso, &#8220;master.bs&#8221;, resourceFolderPath, storeDirectoryName, storeName);
CopyStoreFile(iso, &#8220;resources.bs&#8221;, resourceFolderPath, storeDirectoryName, storeName);</dd>
</dl>
<p>}</p>
<p class="last">private static void CopyStoreFile(IsolatedStorageFile iso, string fileName, string</p>
</dd>
<dt>resourceFolderPath,</dt>
<dd><blockquote class="first">
<div>string storeDirectoryName, string storeName)</div></blockquote>
<dl class="last docutils">
<dt>{</dt>
<dd><p class="first">if (!iso.DirectoryExists(storeDirectoryName))
{</p>
<blockquote>
<div>iso.CreateDirectory(storeDirectoryName);</div></blockquote>
<p>}
if (!iso.DirectoryExists(storeDirectoryName + &#8220;\\&#8221; + storeName))
{</p>
<blockquote>
<div>iso.CreateDirectory(storeDirectoryName + &#8220;\\&#8221; + storeName);</div></blockquote>
<p>}</p>
<p>// Create a stream for the file in the installation folder.
var appResource =</p>
<blockquote>
<div><dl class="docutils">
<dt>Application.GetResourceStream(</dt>
<dd>new Uri(resourceFolderPath + &#8220;\\&#8221; + fileName, UriKind.Relative));</dd>
</dl>
</div></blockquote>
<p>if (appResource != null)
{</p>
<blockquote class="last">
<div><p>using (Stream input = appResource.Stream)
{</p>
<blockquote>
<div><p>// Create a stream for the new file in isolated storage.
using (</p>
<blockquote>
<div><dl class="docutils">
<dt>IsolatedStorageFileStream output =</dt>
<dd>iso.CreateFile(storeDirectoryName + &#8220;\\&#8221; + storeName + &#8220;\\&#8221; +</dd>
</dl>
</div></blockquote>
</div></blockquote>
</div></blockquote>
</dd>
</dl>
</dd>
<dt>fileName))</dt>
<dd><blockquote class="first">
<div><blockquote>
<div><blockquote>
<div><blockquote>
<div><dl class="docutils">
<dt>{</dt>
<dd><p class="first">// Initialize the buffer.
var readBuffer = new byte[4096];
int bytesRead = -1;
// Copy the file from the installation folder to isolated storage.
while ((bytesRead = input.Read(readBuffer, 0, readBuffer.Length)) &gt; 0)
{</p>
<blockquote>
<div>output.Write(readBuffer, 0, bytesRead);</div></blockquote>
<p class="last">}</p>
</dd>
</dl>
<p>}</p>
</div></blockquote>
<p>}</p>
</div></blockquote>
<p>}
else
{</p>
<blockquote>
<div><p>// There is no application resource for this file, so create it as an empty file</p>
<p>iso.CreateFile(storeDirectoryName + &#8220;\\&#8221; + storeName + &#8220;\\&#8221; + fileName).Close();</p>
</div></blockquote>
<p>}</p>
</div></blockquote>
<p>}</p>
</div></blockquote>
<p class="last">}</p>
</dd>
</dl>
</div>
<div class="section" id="access-reference-database-files">
<h4>Access Reference Database Files<a class="headerlink" href="#access-reference-database-files" title="Permalink to this headline">¶</a></h4>
<p>Once deployed to Isolated Storage, the BrightstarDB store can be accessed as normal. You can
use the RDF API, DataObjects API or EntityFramework to access the data depending on your
application requirements. The connection string used to access the store is as follows:</p>
<div class="highlight-python"><pre>type=embedded;storesDirectory={path to directory containing store</pre>
</div>
<p>directories};storeName={name of store directory}</p>
<p>With our sample application, the store is contained in a directory named &#8220;dining&#8221;, which is
itself contained in a directory named &#8220;brightstar&#8221;, so the full connection string is</p>
<div class="highlight-python"><div class="highlight"><pre><span class="nb">type</span><span class="o">=</span><span class="n">embedded</span><span class="p">;</span><span class="n">storesDirectory</span><span class="o">=</span><span class="n">brightstar</span><span class="p">;</span><span class="n">storeName</span><span class="o">=</span><span class="n">dining</span>
</pre></div>
</div>
<p>When the sample application runs, you should see a listing of top restaurants generated from a
LINQ query against the EntityFramework.</p>
</div>
</div>
</div>
<div class="section" id="admin-api">
<span id="id41"></span><h2>Admin API<a class="headerlink" href="#admin-api" title="Permalink to this headline">¶</a></h2>
<p>In addition to the APIs already covered for updating and querying stores, there are a number
of useful administration APIs also provided by BrightstarDB. A Visual Studio solution file
containing some sample applications that use these APIs can be found in
[INSTALLDIR]/Samples/StoreAdmin.</p>
<div class="section" id="managing-commit-points">
<h3>Managing Commit Points<a class="headerlink" href="#managing-commit-points" title="Permalink to this headline">¶</a></h3>
<div class="admonition note">
<p class="first admonition-title">Note</p>
<p class="last">Commit Points are a feature that is only available with the Append-Only store persistence</p>
</div>
<p>type. If you are accessing a store that uses the Rewrite persistence type, operations on a
Commit Points are not supported and will raise a BrightstarClientException if an attempt is
made to query against or revert to a previous Commit Point.</p>
<p>Each time a transaction is committed to a BrightstarDB store, a new commit point is written.
Unlike a traditional database log file, a commit point provides a complete snapshot of the
state of the BrightstarDB store immediately after the commit took place. This means that it is
possible to query the BrightstarDB store as it existed at some previous point in time. It is
also possible to revert the store to a previous commit point, but in keeping with the
BrightstarDB architecture, this operation doesn&#8217;t actually delete the commit points that
followed, but instead makes a new commit point which duplicates the commit point selected for
the revert.</p>
<p><strong>To Retrieve a List of Commit Points</strong></p>
<p>The method to retrieve a list of commit points from a store is GetCommitPoints() on the
IBrightstarService interface. There are two versions of this method. The first takes a store
name and skip and take parameters to define a subrange of commit points to retrieve, the
second adds a date/time range in the form of two date time parameters to allow more specific
selection of a particular commit point range. The code below shows an example of using the
first of these methods:</p>
<div class="highlight-python"><pre>// Create a client - the connection string used is configured in the App.config file.
var client = BrightstarService.GetClient();
foreach(var commitPointInfo in client.GetCommitPoints(storeName, 0, 10))
{
    // Do something with each commit point
}</pre>
</div>
<p>To avoid operations that return potentially very large results sets, the server will not
return more than 100 commit points at a time, attempting to set the take parameter higher than
100 will result in an ArgumentException being raised.</p>
<p>The structures returned by the GetCommitPoints() method implement the ICommitPointInfo
interface, this interface provides access to the following properties:</p>
<blockquote>
<div><ul class="simple">
<li>StoreName - the name of the store that the commit point is associated with</li>
<li>Id - the commit point identifier. This identifier is unique amongst all commit points in</li>
</ul>
</div></blockquote>
<p>the same store.</p>
<blockquote>
<div><ul class="simple">
<li>CommitTime - the UTC date/time when the commit was made</li>
<li>JobId - the GUID identifier of the transaction job that resulted in the commit. The value</li>
</ul>
</div></blockquote>
<p>of this property may be Guid.Empty for operations that were not associated with a
transaction job (e.g initial store creation).</p>
</div>
<div class="section" id="querying-a-commit-point">
<h3>Querying A Commit Point<a class="headerlink" href="#querying-a-commit-point" title="Permalink to this headline">¶</a></h3>
<p>To execute a SPARQL query against a particular commit point of a store, use the overload of
the ExecuteQuery method that takes an ICommitPointInfo parameter rather than a store name
string parameter:</p>
<div class="highlight-python"><pre>var resultsStream = client.ExecuteQuery(commitPointInfo, sparqlQuery);</pre>
</div>
<p>The resulting stream can be processed in exactly the same way as if you had queried the
current state of the store.</p>
</div>
<div class="section" id="reverting-the-store">
<h3>Reverting The Store<a class="headerlink" href="#reverting-the-store" title="Permalink to this headline">¶</a></h3>
<p>Reverting the store takes a copy of an old commit point and pushes it to the top of the commit
point list for the store. Queries and updates are then applied to the store as normal, and the
data modified by commit points since the reverted one is effectively hidden.</p>
<p>This operation does not delete the commit points added since the reverted one, those commit
points are still there as long as a Coalesce operation is not performed, meaning that it is
possible to &#8220;re-revert&#8221; the store to its state before the revert was applied. The method to
revert a store is also on the IBrightstarService interface and is shown below;</p>
<div class="highlight-python"><pre>var client = BrightstarService.GetClient();
ICommitPointInfo commitPointInfo = ... ; // Code to get the commit point we want to revert to
client.RevertToCommitPoint(storeName, commitPointInfo); // Reverts the store</pre>
</div>
</div>
<div class="section" id="consolidate-the-store">
<h3>Consolidate The Store<a class="headerlink" href="#consolidate-the-store" title="Permalink to this headline">¶</a></h3>
<p>Over time the size of the BrightstarDB store will grow. Each separate commit adds new data to
the store, even if the commit deletes triples from the store the commit itself will extend the
store file. The ConsolidateStore operation enables the BrightstarDB store to be compressed,
removing all commit point history. The operation rewrites the store data file to a shadow file
and then replaces the existing data file with the new compressed data file and updates the
master file. The consolidate operation blocks new writers, but allows readers to continue
accessing the data file up until the shadow file is prepared. The code required to start a
consolidate operation is shown below:</p>
<div class="highlight-python"><pre>var client = BrightstarService.GetClient();
var consolidateJob = client.ConsolidateStore(storeName);</pre>
</div>
<p>This method submits the consolidate operation to the store as a long-running job. Because this
operation may take some time to complete the call does not block, but instead returns an
IJobInfo structure which can be used to monitor the job. The code below shows a typical loop
for monitoring the consolidate job:</p>
<div class="highlight-python"><pre>while (!(consolidateJob.JobCompletedOk || consolidateJob.JobCompletedWithErrors))
{
    System.Threading.Thread.Sleep(500);
    consolidateJob = client.GetJobInfo(storeName, consolidateJob.JobId);
}</pre>
</div>
</div>
</div>
<div class="section" id="api-documentation">
<span id="id42"></span><h2>API Documentation<a class="headerlink" href="#api-documentation" title="Permalink to this headline">¶</a></h2>
<p>The full set of classes and methods available can be found in the <a class="reference external" href="http://brightstardb.com/documentation/API/index.html">BrightstarDB API Docs</a>
online or in the BrightstarDB_API.chm file that can be found in the Docs directory of your
installation.</p>
</div>
<div class="section" id="redistributing-brightstardb">
<span id="id43"></span><h2>Redistributing BrightstarDB<a class="headerlink" href="#redistributing-brightstardb" title="Permalink to this headline">¶</a></h2>
<p>In this case, redistributing BrightstarDB means distributing any application that you develop
that makes use of the BrightstarDB libraries. Your BrightstarDB license includes royalty-free
redistribution as long as the following rules are followed:</p>
<blockquote>
<div><ol class="arabic simple">
<li>You may only redistribute the DLLs that are found in the [INSTALLDIR]\SDK directory.</li>
</ol>
</div></blockquote>
<p>Other binaries and DLLS may not be redistributed.</p>
<blockquote>
<div><ol class="arabic simple">
<li>You may not redistribute BrightstarDB as part of an application that replicates the</li>
</ol>
</div></blockquote>
<p>functionality of any BrightstarDB application (even if that application is not included in
the package that you purchased from us).</p>
<blockquote>
<div><ol class="arabic simple">
<li>You must take steps to ensure that your licensee ID and license key are protected from</li>
</ol>
</div></blockquote>
<p>exposure through introspection or reverse engineering of your application. This condition
can be satisfied by obfuscating your distributed application (or at least that part of the
application that contains your licensee ID and license key) in such a way that these strings
are robustly encrypted in the final assembly. You should also note that if the application
you are distributing uses an HTTP, TCP or Named Pipe connection to a BrightstarDB server,
you do not need to include your license information in the assembly at all.</p>
<blockquote>
<div><ol class="arabic simple">
<li>You may not resell BrightstarDB Server or BrightstarDB Enterprise - if you develop an</li>
</ol>
</div></blockquote>
<p>application that connects to a BrightstarDB server, your clients must purchase server
licenses directly from BrightstarDB Limited.</p>
</div>
</div>


          </div>
        </div>
      </div>
      <div class="sphinxsidebar">
        <div class="sphinxsidebarwrapper">
  <h3><a href="index.html">Table Of Contents</a></h3>
  <ul>
<li><a class="reference internal" href="#">Developing With BrightstarDB</a><ul>
<li><a class="reference internal" href="#developer-quick-start">Developer Quick Start</a><ul>
<li><a class="reference internal" href="#create-new-project">Create New Project</a></li>
<li><a class="reference internal" href="#create-the-model">Create the Model</a></li>
<li><a class="reference internal" href="#generating-the-context-and-classes">Generating the Context and Classes</a></li>
<li><a class="reference internal" href="#using-the-context">Using the Context</a></li>
<li><a class="reference internal" href="#optimistic-locking">Optimistic Locking</a></li>
<li><a class="reference internal" href="#server-side-caching">Server Side Caching</a></li>
<li><a class="reference internal" href="#what-next">What Next?</a></li>
</ul>
</li>
<li><a class="reference internal" href="#connection-strings">Connection Strings</a></li>
<li><a class="reference internal" href="#store-persistence-types">Store Persistence Types</a><ul>
<li><a class="reference internal" href="#append-only">Append-Only</a></li>
<li><a class="reference internal" href="#rewritable">Rewritable</a></li>
<li><a class="reference internal" href="#specifying-the-store-persistence-type">Specifying the Store Persistence Type</a></li>
</ul>
</li>
<li><a class="reference internal" href="#running-the-brightstardb-samples">Running The BrightstarDB Samples</a></li>
<li><a class="reference internal" href="#entity-framework">Entity Framework</a><ul>
<li><a class="reference internal" href="#basics">Basics</a></li>
<li><a class="reference internal" href="#annotations">Annotations</a><ul>
<li><a class="reference internal" href="#typeidentifierprefix-attribute">TypeIdentifierPrefix Attribute</a></li>
<li><a class="reference internal" href="#entity-attribute">Entity Attribute</a></li>
<li><a class="reference internal" href="#identity-property">Identity Property</a></li>
<li><a class="reference internal" href="#identifier-attribute">Identifier Attribute</a></li>
<li><a class="reference internal" href="#property-inclusion">Property Inclusion</a></li>
<li><a class="reference internal" href="#inverse-property-attribute">Inverse Property Attribute</a></li>
<li><a class="reference internal" href="#namespace-declaration-attribute">Namespace Declaration Attribute</a></li>
<li><a class="reference internal" href="#property-type-attribute">Property Type Attribute</a></li>
<li><a class="reference internal" href="#inverse-property-type-attribute">Inverse Property Type Attribute</a></li>
<li><a class="reference internal" href="#additional-custom-attributes">Additional Custom Attributes</a></li>
</ul>
</li>
<li><a class="reference internal" href="#patterns">Patterns</a><ul>
<li><a class="reference internal" href="#one-to-one">One-to-One</a></li>
<li><a class="reference internal" href="#one-to-many">One-to-Many</a></li>
<li><a class="reference internal" href="#many-to-many">Many-to-Many</a></li>
<li><a class="reference internal" href="#reflexive-relationship">Reflexive relationship</a></li>
</ul>
</li>
<li><a class="reference internal" href="#behaviour">Behaviour</a></li>
<li><a class="reference internal" href="#optimistic-locking-in-ef">Optimistic Locking</a><ul>
<li><a class="reference internal" href="#enabling-optimistic-locking">Enabling Optimistic Locking</a></li>
<li><a class="reference internal" href="#handling-optimistic-locking-errors">Handling Optimistic Locking Errors</a></li>
</ul>
</li>
<li><a class="reference internal" href="#linq-restrictions">LINQ Restrictions</a><ul>
<li><a class="reference internal" href="#supported-linq-operators">Supported LINQ Operators</a></li>
<li><a class="reference internal" href="#supported-class-methods-and-properties">Supported Class Methods and Properties</a></li>
</ul>
</li>
<li><a class="reference internal" href="#odata">OData</a><ul>
<li><a class="reference internal" href="#odata-restrictions">OData Restrictions</a></li>
</ul>
</li>
<li><a class="reference internal" href="#savingchanges-event">SavingChanges Event</a></li>
<li><a class="reference internal" href="#inotifypropertychanged-and-inotifycollectionchanged-support">INotifyPropertyChanged and INotifyCollectionChanged Support</a></li>
</ul>
</li>
<li><a class="reference internal" href="#entity-framework-samples">Entity Framework Samples</a><ul>
<li><a class="reference internal" href="#tweetbox">Tweetbox</a><ul>
<li><a class="reference internal" href="#overview">Overview</a></li>
<li><a class="reference internal" href="#the-interfaces">The Interfaces</a></li>
<li><a class="reference internal" href="#initialising-the-brightstardb-context">Initialising the BrightstarDB Context</a></li>
<li><a class="reference internal" href="#creating-a-new-user-entity">Creating a new User entity</a></li>
<li><a class="reference internal" href="#relationships-between-entities">Relationships between entities</a></li>
<li><a class="reference internal" href="#fast-creation-persistence-and-indexing-of-data">Fast creation, persistence and indexing of data</a></li>
</ul>
</li>
<li><a class="reference internal" href="#mvc-nerd-dinner">MVC Nerd Dinner</a><ul>
<li><a class="reference internal" href="#creating-the-basic-data-model">Creating The Basic Data Model</a><ul>
<li><a class="reference internal" href="#creating-the-asp-net-mvc4-application">Creating the ASP.NET MVC4 Application.</a></li>
<li><a class="reference internal" href="#running-the-application">Running the application</a></li>
</ul>
</li>
<li><a class="reference internal" href="#creating-mvc-controllers-and-views">Creating MVC Controllers And Views</a><ul>
<li><a class="reference internal" href="#create-the-home-controller">Create the Home Controller</a></li>
<li><a class="reference internal" href="#adding-views">Adding views</a></li>
<li><a class="reference internal" href="#review-site">Review Site</a></li>
<li><a class="reference internal" href="#create-the-addattendee-action">Create the AddAttendee Action</a></li>
</ul>
</li>
<li><a class="reference internal" href="#applying-model-changes">Applying Model Changes</a></li>
<li><a class="reference internal" href="#adding-a-custom-membership-provider">Adding a Custom Membership Provider</a><ul>
<li><a class="reference internal" href="#adding-the-custom-membership-provider-and-login-entity">Adding the Custom Membership Provider and login Entity</a></li>
<li><a class="reference internal" href="#configuring-the-application-to-use-the-brightstar-membership-provider">Configuring the application to use the Brightstar Membership Provider</a></li>
<li><a class="reference internal" href="#adding-functionality-to-the-custom-membership-provider">Adding functionality to the Custom Membership Provider</a></li>
<li><a class="reference internal" href="#extending-the-mvc-application">Extending the MVC application</a></li>
</ul>
</li>
<li><a class="reference internal" href="#adding-a-custom-role-provider">Adding a Custom Role Provider</a><ul>
<li><a class="reference internal" href="#adding-the-custom-role-provider">Adding the Custom Role Provider</a></li>
<li><a class="reference internal" href="#id20">Configuring the application to use the Brightstar Membership Provider</a></li>
<li><a class="reference internal" href="#adding-functionality-to-the-custom-role-provider">Adding functionality to the Custom Role Provider</a></li>
<li><a class="reference internal" href="#adding-secure-sections-to-the-website">Adding Secure Sections to the Website</a></li>
<li><a class="reference internal" href="#id21">Running the Application</a></li>
</ul>
</li>
<li><a class="reference internal" href="#adding-linked-data-support">Adding Linked Data Support</a><ul>
<li><a class="reference internal" href="#create-a-sparql-action">Create a SPARQL Action</a></li>
<li><a class="reference internal" href="#creating-an-odata-provider">Creating an OData Provider</a></li>
</ul>
</li>
<li><a class="reference internal" href="#consuming-odata-in-powerpivot">Consuming OData in PowerPivot</a></li>
</ul>
</li>
<li><a class="reference internal" href="#mapping-to-existing-rdf-data">Mapping to Existing RDF Data</a><ul>
<li><a class="reference internal" href="#the-following-foaf-rdf-triples-are-added-to-the-data-store">The following FOAF RDF triples are added to the data store.</a></li>
<li><a class="reference internal" href="#defining-mappings">Defining Mappings</a></li>
<li><a class="reference internal" href="#example">Example</a></li>
</ul>
</li>
</ul>
</li>
<li><a class="reference internal" href="#data-object-layer">Data Object Layer</a><ul>
<li><a class="reference internal" href="#creating-a-data-object-context">Creating a Data Object Context</a></li>
<li><a class="reference internal" href="#creating-a-store">Creating a Store</a></li>
<li><a class="reference internal" href="#deleting-a-store">Deleting a Store</a></li>
<li><a class="reference internal" href="#creating-data-objects">Creating data objects</a></li>
<li><a class="reference internal" href="#adding-information-to-data-objects">Adding information to data objects</a></li>
<li><a class="reference internal" href="#retrieving-data-objects">Retrieving Data Objects</a></li>
<li><a class="reference internal" href="#deleting-data-objects">Deleting Data Objects</a></li>
<li><a class="reference internal" href="#namespace-mappings">Namespace Mappings</a></li>
<li><a class="reference internal" href="#querying-data-using-sparql">Querying data using SPARQL</a></li>
<li><a class="reference internal" href="#binding-sparql-results-to-data-objects">Binding SPARQL Results To Data Objects</a></li>
<li><a class="reference internal" href="#sample-program">Sample Program</a><ul>
<li><a class="reference internal" href="#creating-the-context">Creating the context</a></li>
<li><a class="reference internal" href="#creating-the-store">Creating the store</a></li>
<li><a class="reference internal" href="#id27">Namespace Mappings</a></li>
<li><a class="reference internal" href="#id28">Optimistic Locking</a></li>
<li><a class="reference internal" href="#skills">Skills</a></li>
<li><a class="reference internal" href="#people">People</a></li>
<li><a class="reference internal" href="#properties">Properties</a></li>
<li><a class="reference internal" href="#save-changes">Save Changes</a></li>
<li><a class="reference internal" href="#querying-the-data">Querying the data</a></li>
<li><a class="reference internal" href="#binding-data-objects-with-sparql">Binding Data Objects With SPARQL</a></li>
<li><a class="reference internal" href="#deleting-objects">Deleting Objects</a></li>
</ul>
</li>
<li><a class="reference internal" href="#optimistic-locking-in-the-data-object-layer">Optimistic Locking in the Data Object Layer</a></li>
</ul>
</li>
<li><a class="reference internal" href="#dynamic-api">Dynamic API</a><ul>
<li><a class="reference internal" href="#dynamic-context">Dynamic Context</a></li>
<li><a class="reference internal" href="#dynamic-object">Dynamic Object</a></li>
<li><a class="reference internal" href="#saving-changes">Saving Changes</a></li>
<li><a class="reference internal" href="#loading-data">Loading Data</a></li>
<li><a class="reference internal" href="#id30">Sample Program</a></li>
</ul>
</li>
<li><a class="reference internal" href="#rdf-client-api">RDF Client API</a><ul>
<li><a class="reference internal" href="#creating-a-client">Creating a client</a></li>
<li><a class="reference internal" href="#id35">Creating a Store</a></li>
<li><a class="reference internal" href="#id36">Deleting a Store</a></li>
<li><a class="reference internal" href="#adding-data">Adding data</a></li>
<li><a class="reference internal" href="#id37">Querying data using SPARQL</a></li>
<li><a class="reference internal" href="#update-data-using-sparql">Update data using SPARQL</a></li>
<li><a class="reference internal" href="#using-extension-methods">Using extension methods</a></li>
<li><a class="reference internal" href="#deleting-data">Deleting data</a></li>
<li><a class="reference internal" href="#data-types">Data Types</a></li>
<li><a class="reference internal" href="#conditional-updates">Conditional Updates</a></li>
<li><a class="reference internal" href="#data-imports">Data Imports</a></li>
<li><a class="reference internal" href="#introduction-to-n-triples">Introduction To N-Triples</a></li>
<li><a class="reference internal" href="#introduction-to-sparql">Introduction To SPARQL</a></li>
</ul>
</li>
<li><a class="reference internal" href="#developing-for-windows-phone">Developing for Windows Phone</a><ul>
<li><a class="reference internal" href="#data-storage-and-connection-strings">Data Storage And Connection Strings</a></li>
<li><a class="reference internal" href="#sdk-libraries">SDK Libraries</a></li>
<li><a class="reference internal" href="#development-considerations">Development Considerations</a></li>
<li><a class="reference internal" href="#deploying-a-reference-store">Deploying a Reference Store</a><ul>
<li><a class="reference internal" href="#create-the-reference-store">Create The Reference Store</a></li>
<li><a class="reference internal" href="#add-database-file-to-your-application">Add Database File To Your Application</a></li>
<li><a class="reference internal" href="#deploy-application">Deploy Application</a></li>
<li><a class="reference internal" href="#copy-database-files-to-isolated-storage">Copy Database Files To Isolated Storage</a></li>
<li><a class="reference internal" href="#access-reference-database-files">Access Reference Database Files</a></li>
</ul>
</li>
</ul>
</li>
<li><a class="reference internal" href="#admin-api">Admin API</a><ul>
<li><a class="reference internal" href="#managing-commit-points">Managing Commit Points</a></li>
<li><a class="reference internal" href="#querying-a-commit-point">Querying A Commit Point</a></li>
<li><a class="reference internal" href="#reverting-the-store">Reverting The Store</a></li>
<li><a class="reference internal" href="#consolidate-the-store">Consolidate The Store</a></li>
</ul>
</li>
<li><a class="reference internal" href="#api-documentation">API Documentation</a></li>
<li><a class="reference internal" href="#redistributing-brightstardb">Redistributing BrightstarDB</a></li>
</ul>
</li>
</ul>

  <h4>Previous topic</h4>
  <p class="topless"><a href="Supported_RDF_Syntaxes.html"
                        title="previous chapter">Supported RDF Syntaxes</a></p>
  <h4>Next topic</h4>
  <p class="topless"><a href="Running_BrightstarDB.html"
                        title="next chapter">BrightstarDB Configuration Options</a></p>
  <h3>This Page</h3>
  <ul class="this-page-menu">
    <li><a href="_sources/Developing_With_BrightstarDB2.txt"
           rel="nofollow">Show Source</a></li>
  </ul>
<div id="searchbox" style="display: none">
  <h3>Quick search</h3>
    <form class="search" action="search.html" method="get">
      <input type="text" name="q" />
      <input type="submit" value="Go" />
      <input type="hidden" name="check_keywords" value="yes" />
      <input type="hidden" name="area" value="default" />
    </form>
    <p class="searchtip" style="font-size: 90%">
    Enter search terms or a module, class or function name.
    </p>
</div>
<script type="text/javascript">$('#searchbox').show(0);</script>
        </div>
      </div>
      <div class="clearer"></div>
    </div>
    <div class="related">
      <h3>Navigation</h3>
      <ul>
        <li class="right" style="margin-right: 10px">
          <a href="genindex.html" title="General Index"
             >index</a></li>
        <li class="right" >
          <a href="Running_BrightstarDB.html" title="BrightstarDB Configuration Options"
             >next</a> |</li>
        <li class="right" >
          <a href="Supported_RDF_Syntaxes.html" title="Supported RDF Syntaxes"
             >previous</a> |</li>
        <li><a href="index.html">BrightstarDB 1.3pre1 documentation</a> &raquo;</li> 
      </ul>
    </div>
    <div class="footer">
        &copy; Copyright 2013, Kal Ahmed, Graham Moore.
      Created using <a href="http://sphinx-doc.org/">Sphinx</a> 1.2b1.
    </div>
  </body>
</html>
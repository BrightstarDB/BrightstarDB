image: Visual Studio 2017
version: 1.0.{build}

environment:
  NoPortable: True
  
install:
  - choco install gitversion.portable -pre -y
  
before_build:
    - dotnet restore src/core/core.sln

build_script:
    - gitversion /l console /output buildserver /updateassemblyinfo
    - dotnet build -c Release src/core/core.sln

test_script:
    - dotnet test -c Release --no-restore --no-build --logger "trx;LogFileName=BrightstarDB.InternalTests.Results.xml" src/core/BrightstarDB.InternalTests

after_test:
    - ps: |
        $wc = New-Object 'System.Net.WebClient'
        $wc.UploadFile("https://ci.appveyor.com/api/testresults/mstest/$($env:APPVEYOR_JOB_ID)", (Resolve-Path .\BrightstarDB.InternalTests.Results.xml))
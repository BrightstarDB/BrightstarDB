image: Visual Studio 2017

install:
  - choco install gitversion.portable -pre -y
  
before_build:
    - dotnet --version
    - dotnet restore src/core/core.sln

build_script:
    - gitversion /l console /output buildserver /updateassemblyinfo
    - dotnet build -c Release src/core/core.sln

test_script:
    - nunit3-console src/core/BrightstarDB.InternalTests/BrightstarDB.InternalTests.csproj --framework=net451 --result=BrightstarDB.InternalTests.Results.net451.xml;format=AppVeyor
    - nunit3-console src/core/BrightstarDB.InternalTests/BrightstarDB.InternalTests.csproj --framework=netcoreapp1.0 --result=BrightstarDB.InternalTests.Results.netcoreapp1.xml;format=AppVeyor

#on_finish:
#    - ps: |
#        $wc = New-Object 'System.Net.WebClient'
#        $filenames = Get-ChildItem -Path ".\src\core" -Recurse -Include *.trx
#        foreach ($f in $filenames) {
#            $wc.UploadFile("https://ci.appveyor.com/api/testresults/mstest/$($env:APPVEYOR_JOB_ID)", $f.FullName)
#        } 